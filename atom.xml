<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>奇姆的博客</title>
  
  
  <link href="https://aliatry.com/atom.xml" rel="self"/>
  
  <link href="https://aliatry.com/"/>
  <updated>2020-12-26T08:05:15.654Z</updated>
  <id>https://aliatry.com/</id>
  
  <author>
    <name>Chim</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>lsof Linux安装</title>
    <link href="https://aliatry.com/2019/10/15/lsof-Linux%E5%AE%89%E8%A3%85/"/>
    <id>https://aliatry.com/2019/10/15/lsof-Linux%E5%AE%89%E8%A3%85/</id>
    <published>2019-10-15T05:29:06.000Z</published>
    <updated>2020-12-26T08:05:15.654Z</updated>
    
    <content type="html"><![CDATA[<h2 id="yum-install-lsof"><a href="#yum-install-lsof" class="headerlink" title="yum install lsof"></a>yum install lsof</h2><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">[root@aliatry ~]# yum install lsof</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Determining fastest mirrors</span><br><span class="line">base                                                                                                                                              | 3.6 kB  00:00:00     </span><br><span class="line">epel                                                                                                                                              | 5.3 kB  00:00:00     </span><br><span class="line">extras                                                                                                                                            | 2.9 kB  00:00:00     </span><br><span class="line">mysql-connectors-community                                                                                                                        | 2.5 kB  00:00:00     </span><br><span class="line">mysql-tools-community                                                                                                                             | 2.5 kB  00:00:00     </span><br><span class="line">mysql57-community                                                                                                                                 | 2.5 kB  00:00:00     </span><br><span class="line">updates                                                                                                                                           | 2.9 kB  00:00:00     </span><br><span class="line">(1&#x2F;9): base&#x2F;7&#x2F;x86_64&#x2F;group_gz                                                                                                                     | 165 kB  00:00:00     </span><br><span class="line">(2&#x2F;9): extras&#x2F;7&#x2F;x86_64&#x2F;primary_db                                                                                                                 | 152 kB  00:00:00     </span><br><span class="line">(3&#x2F;9): epel&#x2F;x86_64&#x2F;updateinfo                                                                                                                     | 1.0 MB  00:00:00     </span><br><span class="line">(4&#x2F;9): base&#x2F;7&#x2F;x86_64&#x2F;primary_db                                                                                                                   | 6.0 MB  00:00:00     </span><br><span class="line">(5&#x2F;9): updates&#x2F;7&#x2F;x86_64&#x2F;primary_db                                                                                                                | 1.9 MB  00:00:00     </span><br><span class="line">(6&#x2F;9): mysql-connectors-community&#x2F;x86_64&#x2F;primary_db                                                                                               |  48 kB  00:00:00     </span><br><span class="line">(7&#x2F;9): epel&#x2F;x86_64&#x2F;primary_db                                                                                                                     | 6.9 MB  00:00:00     </span><br><span class="line">(8&#x2F;9): mysql-tools-community&#x2F;x86_64&#x2F;primary_db                                                                                                    |  66 kB  00:00:00     </span><br><span class="line">(9&#x2F;9): mysql57-community&#x2F;x86_64&#x2F;primary_db                                                                                                        | 190 kB  00:00:00     </span><br><span class="line">Resolving Dependencies</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package lsof.x86_64 0:4.87-6.el7 will be installed</span><br><span class="line">--&gt; Finished Dependency Resolution</span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"> Package                               Arch                                    Version                                       Repository                             Size</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Installing:</span><br><span class="line"> lsof                                  x86_64                                  4.87-6.el7                                    base                                  331 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Install  1 Package</span><br><span class="line"></span><br><span class="line">Total download size: 331 k</span><br><span class="line">Installed size: 927 k</span><br><span class="line">Is this ok [y&#x2F;d&#x2F;N]: y</span><br><span class="line">Downloading packages:</span><br><span class="line">lsof-4.87-6.el7.x86_64.rpm                                                                                                                        | 331 kB  00:00:00     </span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : lsof-4.87-6.el7.x86_64                                                                                                                                1&#x2F;1</span><br><span class="line">  Verifying  : lsof-4.87-6.el7.x86_64                                                                                                                                1&#x2F;1</span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  lsof.x86_64 0:4.87-6.el7                                                                                                                                               </span><br><span class="line"></span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;yum-install-lsof&quot;&gt;&lt;a href=&quot;#yum-install-lsof&quot; class=&quot;headerlink&quot; title=&quot;yum install lsof&quot;&gt;&lt;/a&gt;yum install lsof&lt;/h2&gt;</summary>
    
    
    
    <category term="linux" scheme="https://aliatry.com/categories/linux/"/>
    
    
    <category term="linux" scheme="https://aliatry.com/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>hexo部署私人服务器</title>
    <link href="https://aliatry.com/2019/10/15/hexo%E9%83%A8%E7%BD%B2%E7%A7%81%E4%BA%BA%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    <id>https://aliatry.com/2019/10/15/hexo%E9%83%A8%E7%BD%B2%E7%A7%81%E4%BA%BA%E6%9C%8D%E5%8A%A1%E5%99%A8/</id>
    <published>2019-10-15T03:16:14.000Z</published>
    <updated>2021-01-20T08:40:39.927Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、开始"><a href="#一、开始" class="headerlink" title="一、开始"></a>一、开始</h2><h3 id="配置本地-node-环境"><a href="#配置本地-node-环境" class="headerlink" title="配置本地 node 环境"></a>配置本地 node 环境</h3><ol><li><p><code>node</code>下载 <a href="https://nodejs.org/zh-cn/download/">官网下载</a>，可以的话推荐使用 <code>nvm</code> 安装</p></li><li><p>安装记得把目录改到其他盘，这里我具体是在 <code>D:\programming\nodejs</code></p></li></ol><a id="more"></a><!-- ![node更换路径](https://raw.githubusercontent.com/lawler61/hexo-to-server/master/hexo-to-server/node-path.jpg) --><p>打开<code>cmd</code>查看<code>node</code>安装情况</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br><span class="line">npm -v</span><br></pre></td></tr></table></figure><ol start="3"><li>配置全局环境</li></ol><p>进入安装目录，创建文件夹<code>node_global</code>和<code>node_cache</code> 并执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm config set prefix &quot;D:\programming\nodejs\node_global&quot;</span><br><span class="line">npm config set cache &quot;D:\programming\nodejs\node_cache&quot;</span><br></pre></td></tr></table></figure><p>环境配置：新增环境变量<code>NODE_PATH</code>和添加<code>Path</code>，两个值都为 <code>D:\programming\nodejs\node_global</code></p><!-- ![node更换路径](https://raw.githubusercontent.com/lawler61/hexo-to-server/master/hexo-to-server/env-node.jpg) --><!-- ![node更换路径](https://raw.githubusercontent.com/lawler61/hexo-to-server/master/hexo-to-server/env-path.jpg) --><ol start="4"><li>安装<code>hexo-cli</code></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i hexo-cli -g</span><br><span class="line">hexo</span><br></pre></td></tr></table></figure><p>如果显示下面情况，恭喜你成功全局模块调用</p><!-- ![node更换路径](https://raw.githubusercontent.com/lawler61/hexo-to-server/master/hexo-to-server/test-hexo.jpg) --><ol start="5"><li><p>如果出现<code>命令未找到，或不是可执行程序</code>，别着急！<strong>先仔细重复 3-4 步</strong>，一般是能够给解决的，如果实在是不能解决，往后看</p></li><li><p>随便找个地方初始化文件，执行如下命令：</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir hexo-blog</span><br><span class="line">cd hexo-blog &amp;&amp; npm init -y</span><br></pre></td></tr></table></figure><p>现在有 3 种解决方法，<strong>任选其一</strong></p><ul><li>法 1：检查全局目录是否的<code>hexo</code>模块，执行如下命令：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D:\programming\nodejs\node_global\hexo</span><br></pre></td></tr></table></figure><ul><li>法 2：如果觉得每次加前缀麻烦，使用<code>link</code>命令链接</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm link hexo</span><br></pre></td></tr></table></figure><p>package.json 中新建脚本如下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run hexo</span><br></pre></td></tr></table></figure><!-- ![新建npm脚本](https://raw.githubusercontent.com/lawler61/hexo-to-server/master/hexo-to-server/npm-script.jpg) --><ul><li>法 3：你还可以直接在<code>hexo-blog</code>中下载</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm i hexo-cli</span><br><span class="line"><span class="meta">#</span><span class="bash"> 还是要在package.json中新建脚本</span></span><br><span class="line">npm run hexo</span><br></pre></td></tr></table></figure><h3 id="初始化hexo项目"><a href="#初始化hexo项目" class="headerlink" title="初始化hexo项目"></a>初始化<code>hexo</code>项目</h3><ol><li>如果是按照上一节步骤 4 过来的，则在<code>hexo-blog</code>文件下初始化</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo init myblog &amp;&amp; cd myblog</span><br><span class="line">npm i</span><br></pre></td></tr></table></figure><ol start="2"><li>下载主题</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/iissnan/hexo-theme-next themes/next</span><br></pre></td></tr></table></figure><p>在<strong>本地配置文件</strong>中设置<code>theme</code>属性</p><!-- ![添加next主题](https://raw.githubusercontent.com/lawler61/hexo-to-server/master/hexo-to-server/hexo-theme.jpg) --><ol start="3"><li>本地执行<code>hexo</code>项目，添加<code>start</code>脚本</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br></pre></td></tr></table></figure><!-- ![新建npm-start脚本](https://raw.githubusercontent.com/lawler61/hexo-to-server/master/hexo-to-server/npm-script-start.jpg) --><p>打开 <a href="http://localhost:4000/">http://localhost:4000</a> 验证效果吧</p><h3 id="git环境搭建"><a href="#git环境搭建" class="headerlink" title="git环境搭建"></a><code>git</code>环境搭建</h3><ol><li><p><code>git</code>安装：<a href="https://git-scm.com/downloads">官网下载</a></p></li><li><p>生成<code>ssh</code>认证，执行如下命令</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;yourname&quot;</span><br><span class="line">git config --global user.email youremail@example.com</span><br><span class="line">ssh-keygen -t rsa -C &quot;youremail@example.com&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 禁用自动转换，这个不设置后面上传时会出现警告</span></span><br><span class="line">git config --global core.autocrlf false</span><br></pre></td></tr></table></figure><!-- ![git警告](https://raw.githubusercontent.com/lawler61/hexo-to-server/master/hexo-to-server/git-warning.jpg) --><p>最后获取到的<code>ssh</code>认证在<code>C:\Users\yourname\.ssh</code>中</p><hr><h2 id="三、服务器配置"><a href="#三、服务器配置" class="headerlink" title="三、服务器配置"></a>三、服务器配置</h2><h3 id="搭建远程Git私库"><a href="#搭建远程Git私库" class="headerlink" title="搭建远程Git私库"></a>搭建远程<code>Git</code>私库</h3><ol><li><p>登录到远程服务器，推荐使用<code>Xshell 5</code></p></li><li><p>安装 git</p></li></ol><p>CentOS</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 如无，则安装</span></span><br><span class="line">git --version</span><br><span class="line">yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel perl-devel</span><br><span class="line">yum install -y git</span><br></pre></td></tr></table></figure><p>Ubuntu</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 如无，则安装</span></span><br><span class="line">git --version</span><br><span class="line">sudo apt-get update</span><br><span class="line">apt install git</span><br></pre></td></tr></table></figure><ol start="3"><li>创建用户并配置其仓库</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">useradd git</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置密码</span></span><br><span class="line">passwd git</span><br><span class="line"><span class="meta">#</span><span class="bash"> 这步很重要，不切换用户后面会很麻烦</span></span><br><span class="line">su git</span><br><span class="line">cd /home/git/</span><br><span class="line"><span class="meta">#</span><span class="bash"> 项目存在的真实目录</span></span><br><span class="line">mkdir -p projects/blog</span><br><span class="line">mkdir repos &amp;&amp; cd repos</span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建一个裸露的仓库</span></span><br><span class="line">git init --bare blog.git</span><br><span class="line">cd blog.git/hooks</span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建 hook 钩子函数，输入了内容如下</span></span><br><span class="line">vi post-receive</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">git --work-tree=/home/git/projects/blog --git-dir=/home/git/repos/blog.git checkout -f</span><br></pre></td></tr></table></figure><p>添加完毕后修改权限</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">chmod +x post-receive</span><br><span class="line"><span class="meta">#</span><span class="bash"> 退出到 root 登录</span></span><br><span class="line">exit</span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加权限</span></span><br><span class="line">chown -R git:git /home/git/repos/blog.git</span><br></pre></td></tr></table></figure><ol start="4"><li>测试<code>git仓库</code>是否可用，另找空白文件夹</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone git@server_ip:/home/git/repos/blog.git</span><br></pre></td></tr></table></figure><p>如果能把空仓库拉下来，就说明 git 仓库搭建成功了</p><!-- ![git仓库测试](https://raw.githubusercontent.com/lawler61/hexo-to-server/master/hexo-to-server/git-clone.jpg) --><ol start="5"><li>建立<code>ssh</code>信任关系，在<strong>本地电脑</strong></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id -i C:/Users/yourname/.ssh/id_rsa.pub git@server_ip</span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试能否登录</span></span><br><span class="line">ssh git@server_ip</span><br></pre></td></tr></table></figure><p><strong>注</strong>：此时的 ssh 登录 git 用户不需要密码！否则就<strong>有错</strong>，请仔细重复步骤 3-5</p><ol start="6"><li>为了安全起见禁用 git 用户的 shell 登录权限，从而只能用 git clone，git push 等登录</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看 git-shell 是否在登录方式里面</span></span><br><span class="line">cat /etc/shells</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看是否安装</span></span><br><span class="line">which git-shell</span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加上2步显示出来的路劲，通常在 /usr/bin/git-shell</span></span><br><span class="line">vi /etc/shells</span><br></pre></td></tr></table></figure><p>修改<code>/etc/passwd</code>中的权限</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将原来的</span></span><br><span class="line">git:x:1001:1001::/home/git:/bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改为</span></span><br><span class="line">git:x:1001:1001:,,,:/home/git:/usr/bin/git-shell</span><br></pre></td></tr></table></figure><h3 id="搭建nginx服务器"><a href="#搭建nginx服务器" class="headerlink" title="搭建nginx服务器"></a>搭建<code>nginx</code>服务器</h3><ol><li>下载并安装<code>nginx</code></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/src</span><br><span class="line">wget http://nginx.org/download/nginx-1.15.2.tar.gz</span><br><span class="line">tar xzvf nginx-1.15.2.tar.gz</span><br><span class="line">cd nginx-1.15.2</span><br></pre></td></tr></table></figure><p>Ubuntu系统需要的依赖库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install build-essential</span><br><span class="line">sudo apt-get install libtool</span><br><span class="line">sudo apt-get install libpcre3 libpcre3-dev</span><br><span class="line">sudo apt-get install zlib1g-dev</span><br><span class="line">sudo apt-get install openssl</span><br><span class="line">sudo apt-get install libssl-dev</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 如果后面还想要配置 SSL 协议，就执行后面一句！</span></span><br><span class="line">./configure</span><br><span class="line">./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module --with-file-aio --with-http_realip_module</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="meta">#</span><span class="bash"> 为 nginx 取别名，后面可直接用。用户登出失效，可以修改新增到 `~/.bashrc` 文件</span></span><br><span class="line">alias nginx=&#x27;/usr/local/nginx/sbin/nginx&#x27;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alias nginx=&#x27;/usr/local/nginx/sbin/nginx&#x27;</span><br></pre></td></tr></table></figure><ol start="2"><li>配置<code>nginx</code>文件</li></ol><p>先启动是否安装成功</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 直接来！浏览器查看 server_ip，默认是 80 端口</span></span><br><span class="line">nginx</span><br></pre></td></tr></table></figure><p>修改配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">nginx -s stop // 先停止nginx</span><br><span class="line">cd /usr/local/nginx/conf</span><br><span class="line">vi nginx.conf</span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改 root 解析路径，如下图</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 同时将 user 改为 root 如下图，不然nginx无法访问 /home/git/projects/blog</span></span><br><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure><p>http配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">user  root;</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">#error_log  logs&#x2F;error.log;</span><br><span class="line">#error_log  logs&#x2F;error.log  notice;</span><br><span class="line">#error_log  logs&#x2F;error.log  info;</span><br><span class="line"></span><br><span class="line">#pid        logs&#x2F;nginx.pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application&#x2F;octet-stream;</span><br><span class="line"></span><br><span class="line">    #log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span><br><span class="line">    #                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span><br><span class="line">    #                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span><br><span class="line"></span><br><span class="line">    #access_log  logs&#x2F;access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #gzip  on;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        #charset koi8-r;</span><br><span class="line"></span><br><span class="line">        #access_log  logs&#x2F;host.access.log  main;</span><br><span class="line"></span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">            root   &#x2F;home&#x2F;git&#x2F;projects&#x2F;blog;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        #error_page  404              &#x2F;404.html;</span><br><span class="line"></span><br><span class="line">        # redirect server error pages to the static page &#x2F;50x.html</span><br><span class="line">        #</span><br><span class="line">        error_page   500 502 503 504  &#x2F;50x.html;</span><br><span class="line">        location &#x3D; &#x2F;50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    proxy_pass   http:&#x2F;&#x2F;127.0.0.1;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    root           html;</span><br><span class="line">        #    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">        #    fastcgi_index  index.php;</span><br><span class="line">        #    fastcgi_param  SCRIPT_FILENAME  &#x2F;scripts$fastcgi_script_name;</span><br><span class="line">        #    include        fastcgi_params;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        # deny access to .htaccess files, if Apache&#39;s document root</span><br><span class="line">        # concurs with nginx&#39;s one</span><br><span class="line">        #</span><br><span class="line">        #location ~ &#x2F;\.ht &#123;</span><br><span class="line">        #    deny  all;</span><br><span class="line">        #&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # another virtual host using mix of IP-, name-, and port-based configuration</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    #    listen       8000;</span><br><span class="line">    #    listen       somename:8080;</span><br><span class="line">    #    server_name  somename  alias  another.alias;</span><br><span class="line"></span><br><span class="line">    #    location &#x2F; &#123;</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # HTTPS server</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    #    listen       443 ssl;</span><br><span class="line">    #    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    #    ssl_certificate      cert.pem;</span><br><span class="line">    #    ssl_certificate_key  cert.key;</span><br><span class="line"></span><br><span class="line">    #    ssl_session_cache    shared:SSL:1m;</span><br><span class="line">    #    ssl_session_timeout  5m;</span><br><span class="line"></span><br><span class="line">    #    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">    #    ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line">    #    location &#x2F; &#123;</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>https配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">user  root;</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">#error_log  logs&#x2F;error.log;</span><br><span class="line">#error_log  logs&#x2F;error.log  notice;</span><br><span class="line">#error_log  logs&#x2F;error.log  info;</span><br><span class="line"></span><br><span class="line">#pid        logs&#x2F;nginx.pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application&#x2F;octet-stream;</span><br><span class="line"></span><br><span class="line">    #log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span><br><span class="line">    #                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span><br><span class="line">    #                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span><br><span class="line"></span><br><span class="line">    #access_log  logs&#x2F;access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #gzip  on;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen        80;</span><br><span class="line">        server_name   aliatry.com;</span><br><span class="line"></span><br><span class="line">        rewrite       ^&#x2F;(.*) https:&#x2F;&#x2F;$host$1 permanent;</span><br><span class="line"></span><br><span class="line">        #charset koi8-r;</span><br><span class="line"></span><br><span class="line">        #access_log  logs&#x2F;host.access.log  main;</span><br><span class="line"></span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">            #root   &#x2F;home&#x2F;git&#x2F;projects&#x2F;blog;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page  404              &#x2F;404.html;</span><br><span class="line"></span><br><span class="line">        # redirect server error pages to the static page &#x2F;50x.html</span><br><span class="line">        #</span><br><span class="line">        error_page   500 502 503 504  &#x2F;50x.html;</span><br><span class="line">        location &#x3D; &#x2F;50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    proxy_pass   http:&#x2F;&#x2F;127.0.0.1;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ &#123;</span><br><span class="line">        #    root           html;</span><br><span class="line">        #    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">        #    fastcgi_index  index.php;</span><br><span class="line">        #    fastcgi_param  SCRIPT_FILENAME  &#x2F;scripts$fastcgi_script_name;</span><br><span class="line">        #    include        fastcgi_params;</span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        # deny access to .htaccess files, if Apache&#39;s document root</span><br><span class="line">        # concurs with nginx&#39;s one</span><br><span class="line">        #</span><br><span class="line">        #location ~ &#x2F;\.ht &#123;</span><br><span class="line">        #    deny  all;</span><br><span class="line">        #&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # another virtual host using mix of IP-, name-, and port-based configuration</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    #    listen       8000;</span><br><span class="line">    #    listen       somename:8080;</span><br><span class="line">    #    server_name  somename  alias  another.alias;</span><br><span class="line"></span><br><span class="line">    #    location &#x2F; &#123;</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # HTTPS server</span><br><span class="line">    #</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       443 ssl;</span><br><span class="line">        server_name  aliatry.com;</span><br><span class="line"></span><br><span class="line">        ssl_certificate      cert.pem;</span><br><span class="line">        ssl_certificate_key  cert.key;</span><br><span class="line"></span><br><span class="line">    #    ssl_session_cache    shared:SSL:1m;</span><br><span class="line">        ssl_session_timeout  5m;</span><br><span class="line"></span><br><span class="line">        ssl_ciphers  ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class="line">        ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line">        ssl_protocols     TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line"></span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">            root   &#x2F;home&#x2F;git&#x2F;projects&#x2F;blog;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- ![修改nginx配置](https://raw.githubusercontent.com/lawler61/hexo-to-server/master/hexo-to-server/nginx-conf.jpg) --><!-- ![修改nginx user](https://raw.githubusercontent.com/lawler61/hexo-to-server/master/hexo-to-server/nginx-user.jpg) --><hr><h2 id="四、发布"><a href="#四、发布" class="headerlink" title="四、发布"></a>四、发布</h2><p>至此我们就把本地和服务器的环境全部搭建完成，现在利用 hexo 配置文件进行链接</p><h3 id="配置-config-yml文件"><a href="#配置-config-yml文件" class="headerlink" title="配置_config.yml文件"></a>配置<code>_config.yml</code>文件</h3><ol><li>编辑 <code>_config.yml</code> 的 deploy 属性</li></ol><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br><span class="line">  <span class="attr">repository:</span> </span><br><span class="line">    <span class="attr">server:</span> <span class="string">git@server_ip:/home/git/repos/blog.git</span></span><br></pre></td></tr></table></figure><!-- ![编辑本地deploy](https://raw.githubusercontent.com/lawler61/hexo-to-server/master/hexo-to-server/config-deploy.jpg) --><ol start="2"><li>在 package.json 中添加 npm 脚本</li></ol><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;deploy&quot;: &quot;hexo clean &amp;&amp; hexo g -d&quot;,</span><br><span class="line">  &quot;start&quot;: &quot;hexo clean &amp;&amp; hexo g &amp;&amp; hexo s&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><ol start="3"><li>链接！这下在本地调试就用<code>npm start</code>，调试好了就上传到服务器，美滋滋~快通过你的服务器 ip 访问吧</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run deploy</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;一、开始&quot;&gt;&lt;a href=&quot;#一、开始&quot; class=&quot;headerlink&quot; title=&quot;一、开始&quot;&gt;&lt;/a&gt;一、开始&lt;/h2&gt;&lt;h3 id=&quot;配置本地-node-环境&quot;&gt;&lt;a href=&quot;#配置本地-node-环境&quot; class=&quot;headerlink&quot; title=&quot;配置本地 node 环境&quot;&gt;&lt;/a&gt;配置本地 node 环境&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;node&lt;/code&gt;下载 &lt;a href=&quot;https://nodejs.org/zh-cn/download/&quot;&gt;官网下载&lt;/a&gt;，可以的话推荐使用 &lt;code&gt;nvm&lt;/code&gt; 安装&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;安装记得把目录改到其他盘，这里我具体是在 &lt;code&gt;D:\programming\nodejs&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;</summary>
    
    
    
    <category term="hexo" scheme="https://aliatry.com/categories/hexo/"/>
    
    <category term="部署" scheme="https://aliatry.com/categories/hexo/%E9%83%A8%E7%BD%B2/"/>
    
    
    <category term="hexo" scheme="https://aliatry.com/tags/hexo/"/>
    
    <category term="部署" scheme="https://aliatry.com/tags/%E9%83%A8%E7%BD%B2/"/>
    
    <category term="Nginx" scheme="https://aliatry.com/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title>HttpUtils 阿里云市场 api网关请求签名</title>
    <link href="https://aliatry.com/2019/09/18/HttpUtils-%E9%98%BF%E9%87%8C%E4%BA%91%E5%B8%82%E5%9C%BA-api%E7%BD%91%E5%85%B3%E8%AF%B7%E6%B1%82%E7%AD%BE%E5%90%8D/"/>
    <id>https://aliatry.com/2019/09/18/HttpUtils-%E9%98%BF%E9%87%8C%E4%BA%91%E5%B8%82%E5%9C%BA-api%E7%BD%91%E5%85%B3%E8%AF%B7%E6%B1%82%E7%AD%BE%E5%90%8D/</id>
    <published>2019-09-18T07:35:27.000Z</published>
    <updated>2019-09-18T07:50:13.018Z</updated>
    
    <content type="html"><![CDATA[<p>HttpUtils 多用于 <code>api网关请求签名</code></p><p>请求方式 : <code>Get</code> <code>Post</code> <code>Put</code> <code>Delete</code></p><a id="more"></a><h2 id="http接口请求工具类-HttpUtils-class"><a href="#http接口请求工具类-HttpUtils-class" class="headerlink" title="http接口请求工具类 HttpUtils.class"></a>http接口请求工具类 HttpUtils.class</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.lang.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.NameValuePair;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.HttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.entity.UrlEncodedFormEntity;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpDelete;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpGet;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpPost;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpPut;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.conn.ClientConnectionManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.conn.scheme.Scheme;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.conn.scheme.SchemeRegistry;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.conn.ssl.SSLSocketFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.entity.ByteArrayEntity;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.entity.StringEntity;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.DefaultHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.message.BasicNameValuePair;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.SSLContext;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.TrustManager;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.X509TrustManager;</span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyManagementException;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> java.security.cert.X509Certificate;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 重要提示如下:</span></span><br><span class="line"><span class="comment"> * HttpUtils请从</span></span><br><span class="line"><span class="comment"> * https://github.com/aliyun/api-gateway-demo-sign-java/blob/master/src/main/java/com/aliyun/api/gateway/demo/util/HttpUtils.java</span></span><br><span class="line"><span class="comment"> * 下载</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 相应的依赖请参照</span></span><br><span class="line"><span class="comment"> * https://github.com/aliyun/api-gateway-demo-sign-java/blob/master/pom.xml</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * get</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> host</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> headers</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> querys</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HttpResponse <span class="title">doGet</span><span class="params">(String host, String path, String method,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     Map&lt;String, String&gt; headers,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     Map&lt;String, String&gt; querys)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HttpClient httpClient = wrapClient(host);</span><br><span class="line"></span><br><span class="line">        HttpGet request = <span class="keyword">new</span> HttpGet(buildUrl(host, path, querys));</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; e : headers.entrySet()) &#123;</span><br><span class="line">            request.addHeader(e.getKey(), e.getValue());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> httpClient.execute(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * post form</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> host</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> headers</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> querys</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bodys</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HttpResponse <span class="title">doPost</span><span class="params">(String host, String path, String method,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      Map&lt;String, String&gt; headers,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      Map&lt;String, String&gt; querys,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      Map&lt;String, String&gt; bodys)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HttpClient httpClient = wrapClient(host);</span><br><span class="line"></span><br><span class="line">        HttpPost request = <span class="keyword">new</span> HttpPost(buildUrl(host, path, querys));</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; e : headers.entrySet()) &#123;</span><br><span class="line">            request.addHeader(e.getKey(), e.getValue());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (bodys != <span class="keyword">null</span>) &#123;</span><br><span class="line">            List&lt;NameValuePair&gt; nameValuePairList = <span class="keyword">new</span> ArrayList&lt;NameValuePair&gt;();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (String key : bodys.keySet()) &#123;</span><br><span class="line">                nameValuePairList.add(<span class="keyword">new</span> BasicNameValuePair(key, bodys.get(key)));</span><br><span class="line">            &#125;</span><br><span class="line">            UrlEncodedFormEntity formEntity = <span class="keyword">new</span> UrlEncodedFormEntity(nameValuePairList, <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">            formEntity.setContentType(<span class="string">&quot;application/x-www-form-urlencoded; charset=UTF-8&quot;</span>);</span><br><span class="line">            request.setEntity(formEntity);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> httpClient.execute(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Post String</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> host</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> headers</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> querys</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> body</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HttpResponse <span class="title">doPost</span><span class="params">(String host, String path, String method,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      Map&lt;String, String&gt; headers,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      Map&lt;String, String&gt; querys,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      String body)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HttpClient httpClient = wrapClient(host);</span><br><span class="line"></span><br><span class="line">        HttpPost request = <span class="keyword">new</span> HttpPost(buildUrl(host, path, querys));</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; e : headers.entrySet()) &#123;</span><br><span class="line">            request.addHeader(e.getKey(), e.getValue());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(body)) &#123;</span><br><span class="line">            request.setEntity(<span class="keyword">new</span> StringEntity(body, <span class="string">&quot;utf-8&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> httpClient.execute(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Post stream</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> host</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> headers</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> querys</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> body</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HttpResponse <span class="title">doPost</span><span class="params">(String host, String path, String method,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      Map&lt;String, String&gt; headers,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      Map&lt;String, String&gt; querys,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      <span class="keyword">byte</span>[] body)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HttpClient httpClient = wrapClient(host);</span><br><span class="line"></span><br><span class="line">        HttpPost request = <span class="keyword">new</span> HttpPost(buildUrl(host, path, querys));</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; e : headers.entrySet()) &#123;</span><br><span class="line">            request.addHeader(e.getKey(), e.getValue());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (body != <span class="keyword">null</span>) &#123;</span><br><span class="line">            request.setEntity(<span class="keyword">new</span> ByteArrayEntity(body));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> httpClient.execute(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Put String</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> host</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> headers</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> querys</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> body</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HttpResponse <span class="title">doPut</span><span class="params">(String host, String path, String method,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     Map&lt;String, String&gt; headers,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     Map&lt;String, String&gt; querys,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     String body)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HttpClient httpClient = wrapClient(host);</span><br><span class="line"></span><br><span class="line">        HttpPut request = <span class="keyword">new</span> HttpPut(buildUrl(host, path, querys));</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; e : headers.entrySet()) &#123;</span><br><span class="line">            request.addHeader(e.getKey(), e.getValue());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(body)) &#123;</span><br><span class="line">            request.setEntity(<span class="keyword">new</span> StringEntity(body, <span class="string">&quot;utf-8&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> httpClient.execute(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Put stream</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> host</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> headers</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> querys</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> body</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HttpResponse <span class="title">doPut</span><span class="params">(String host, String path, String method,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     Map&lt;String, String&gt; headers,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     Map&lt;String, String&gt; querys,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     <span class="keyword">byte</span>[] body)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HttpClient httpClient = wrapClient(host);</span><br><span class="line"></span><br><span class="line">        HttpPut request = <span class="keyword">new</span> HttpPut(buildUrl(host, path, querys));</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; e : headers.entrySet()) &#123;</span><br><span class="line">            request.addHeader(e.getKey(), e.getValue());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (body != <span class="keyword">null</span>) &#123;</span><br><span class="line">            request.setEntity(<span class="keyword">new</span> ByteArrayEntity(body));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> httpClient.execute(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Delete</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> host</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> headers</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> querys</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HttpResponse <span class="title">doDelete</span><span class="params">(String host, String path, String method,</span></span></span><br><span class="line"><span class="function"><span class="params">                                        Map&lt;String, String&gt; headers,</span></span></span><br><span class="line"><span class="function"><span class="params">                                        Map&lt;String, String&gt; querys)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HttpClient httpClient = wrapClient(host);</span><br><span class="line"></span><br><span class="line">        HttpDelete request = <span class="keyword">new</span> HttpDelete(buildUrl(host, path, querys));</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; e : headers.entrySet()) &#123;</span><br><span class="line">            request.addHeader(e.getKey(), e.getValue());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> httpClient.execute(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">buildUrl</span><span class="params">(String host, String path, Map&lt;String, String&gt; querys)</span> <span class="keyword">throws</span> UnsupportedEncodingException </span>&#123;</span><br><span class="line">        StringBuilder sbUrl = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        sbUrl.append(host);</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isBlank(path)) &#123;</span><br><span class="line">            sbUrl.append(path);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != querys) &#123;</span><br><span class="line">            StringBuilder sbQuery = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; query : querys.entrySet()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="number">0</span> &lt; sbQuery.length()) &#123;</span><br><span class="line">                    sbQuery.append(<span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (StringUtils.isBlank(query.getKey()) &amp;&amp; !StringUtils.isBlank(query.getValue())) &#123;</span><br><span class="line">                    sbQuery.append(query.getValue());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (!StringUtils.isBlank(query.getKey())) &#123;</span><br><span class="line">                    sbQuery.append(query.getKey());</span><br><span class="line">                    <span class="keyword">if</span> (!StringUtils.isBlank(query.getValue())) &#123;</span><br><span class="line">                        sbQuery.append(<span class="string">&quot;=&quot;</span>);</span><br><span class="line">                        sbQuery.append(URLEncoder.encode(query.getValue(), <span class="string">&quot;utf-8&quot;</span>));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="number">0</span> &lt; sbQuery.length()) &#123;</span><br><span class="line">                sbUrl.append(<span class="string">&quot;?&quot;</span>).append(sbQuery);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sbUrl.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> HttpClient <span class="title">wrapClient</span><span class="params">(String host)</span> </span>&#123;</span><br><span class="line">        HttpClient httpClient = <span class="keyword">new</span> DefaultHttpClient();</span><br><span class="line">        <span class="keyword">if</span> (host.startsWith(<span class="string">&quot;https://&quot;</span>)) &#123;</span><br><span class="line">            sslClient(httpClient);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> httpClient;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sslClient</span><span class="params">(HttpClient httpClient)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            SSLContext ctx = SSLContext.getInstance(<span class="string">&quot;TLS&quot;</span>);</span><br><span class="line">            X509TrustManager tm = <span class="keyword">new</span> X509TrustManager() &#123;</span><br><span class="line">                <span class="keyword">public</span> X509Certificate[] getAcceptedIssuers() &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkClientTrusted</span><span class="params">(X509Certificate[] xcs, String str)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkServerTrusted</span><span class="params">(X509Certificate[] xcs, String str)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            ctx.init(<span class="keyword">null</span>, <span class="keyword">new</span> TrustManager[]&#123;tm&#125;, <span class="keyword">null</span>);</span><br><span class="line">            SSLSocketFactory ssf = <span class="keyword">new</span> SSLSocketFactory(ctx);</span><br><span class="line">            ssf.setHostnameVerifier(SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);</span><br><span class="line">            ClientConnectionManager ccm = httpClient.getConnectionManager();</span><br><span class="line">            SchemeRegistry registry = ccm.getSchemeRegistry();</span><br><span class="line">            registry.register(<span class="keyword">new</span> Scheme(<span class="string">&quot;https&quot;</span>, <span class="number">443</span>, ssf));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (KeyManagementException ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(ex);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="相应的依赖请参照"><a href="#相应的依赖请参照" class="headerlink" title="相应的依赖请参照"></a>相应的依赖请参照</h2><ul><li><a href="https://github.com/aliyun/api-gateway-demo-sign-java/blob/master/pom.xml">https://github.com/aliyun/api-gateway-demo-sign-java/blob/master/pom.xml</a></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun.api.gateway<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>java.demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.15<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpcore<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-lang<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.eclipse.jetty<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jetty-util<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>9.3.7.v20160115<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;HttpUtils 多用于 &lt;code&gt;api网关请求签名&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;请求方式 : &lt;code&gt;Get&lt;/code&gt; &lt;code&gt;Post&lt;/code&gt; &lt;code&gt;Put&lt;/code&gt; &lt;code&gt;Delete&lt;/code&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="http" scheme="https://aliatry.com/categories/http/"/>
    
    <category term="api网关请求" scheme="https://aliatry.com/categories/http/api%E7%BD%91%E5%85%B3%E8%AF%B7%E6%B1%82/"/>
    
    
    <category term="HttpUtils" scheme="https://aliatry.com/tags/HttpUtils/"/>
    
    <category term="http" scheme="https://aliatry.com/tags/http/"/>
    
    <category term="接口请求" scheme="https://aliatry.com/tags/%E6%8E%A5%E5%8F%A3%E8%AF%B7%E6%B1%82/"/>
    
    <category term="工具类" scheme="https://aliatry.com/tags/%E5%B7%A5%E5%85%B7%E7%B1%BB/"/>
    
    <category term="api网关请求" scheme="https://aliatry.com/tags/api%E7%BD%91%E5%85%B3%E8%AF%B7%E6%B1%82/"/>
    
  </entry>
  
  <entry>
    <title>springcloud feign 多文件上传</title>
    <link href="https://aliatry.com/2019/06/05/springcloud-feign-%E5%A4%9A%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
    <id>https://aliatry.com/2019/06/05/springcloud-feign-%E5%A4%9A%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/</id>
    <published>2019-06-05T09:02:58.000Z</published>
    <updated>2020-12-28T08:02:45.966Z</updated>
    
    <content type="html"><![CDATA[<h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><p>第三方调用的我的接口,上传若干个文件,我用 <code>MultiPartFile[]</code> 数组接收,之后我调用其他服务的接口,把文件发送过去,统一保存</p><p>目前存在的问题就是,当你使用 <code>feign</code> 传递 <code>MultipartFile</code> 对象时,接收方无法解析,所以需要重写 <code>feign</code> 的 <code>Encoder</code> ,让它支持 <code>MultipartFile</code> 类型以及 <code>MultipartFile[]</code> 数组类型</p><h2 id="异常输出"><a href="#异常输出" class="headerlink" title="异常输出"></a>异常输出</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">com.fasterxml.jackson.databind.exc.InvalidDefinitionException: No serializer found for class java.io.FileDescriptor and no properties discovered to create BeanSerializer (to avoid exception, disable SerializationFeature.FAIL_ON_EMPTY_BEANS) (through reference chain: org.springframework.web.multipart.support.StandardMultipartHttpServletRequest$StandardMultipartFile[0]-&gt;org.springframework.web.multipart.support.StandardMultipartHttpServletRequest$StandardMultipartFile[&quot;inputStream&quot;]-&gt;java.io.FileInputStream[&quot;fd&quot;])</span><br></pre></td></tr></table></figure><h2 id="Maven引入jar包"><a href="#Maven引入jar包" class="headerlink" title="Maven引入jar包"></a>Maven引入jar包</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 支持feign传递MultipartFile --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.github.openfeign.form<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>feign-form<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.github.openfeign.form<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>feign-form-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="SpringMultipartEncoder-类-重写-FormEncoder-使得-feign-可以支持文件传输"><a href="#SpringMultipartEncoder-类-重写-FormEncoder-使得-feign-可以支持文件传输" class="headerlink" title="SpringMultipartEncoder 类 - 重写 FormEncoder 使得 feign 可以支持文件传输"></a><code>SpringMultipartEncoder</code> 类 - 重写 <code>FormEncoder</code> 使得 <code>feign</code> 可以支持文件传输</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> feign.RequestTemplate;</span><br><span class="line"><span class="keyword">import</span> feign.codec.EncodeException;</span><br><span class="line"><span class="keyword">import</span> feign.codec.Encoder;</span><br><span class="line"><span class="keyword">import</span> feign.form.ContentType;</span><br><span class="line"><span class="keyword">import</span> feign.form.FormEncoder;</span><br><span class="line"><span class="keyword">import</span> feign.form.MultipartFormContentProcessor;</span><br><span class="line"><span class="keyword">import</span> feign.form.spring.SpringManyMultipartFilesWriter;</span><br><span class="line"><span class="keyword">import</span> feign.form.spring.SpringSingleMultipartFileWriter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Type;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 支持feign传递MultipartFile</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringMultipartEncoder</span> <span class="keyword">extends</span> <span class="title">FormEncoder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Constructor with the default Feign&#x27;s encoder as a delegate.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SpringMultipartEncoder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="keyword">new</span> Default());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Constructor with specified delegate encoder.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> delegate delegate encoder, if this encoder couldn&#x27;t encode object.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SpringMultipartEncoder</span><span class="params">(Encoder delegate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(delegate);</span><br><span class="line"></span><br><span class="line">        MultipartFormContentProcessor processor = (MultipartFormContentProcessor) getContentProcessor(ContentType.MULTIPART);</span><br><span class="line">        processor.addWriter(<span class="keyword">new</span> SpringSingleMultipartFileWriter());</span><br><span class="line">        processor.addWriter(<span class="keyword">new</span> SpringManyMultipartFilesWriter());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">encode</span><span class="params">(Object object, Type bodyType, RequestTemplate template)</span> <span class="keyword">throws</span> EncodeException </span>&#123;</span><br><span class="line">        <span class="comment">// 单MultipartFile判断</span></span><br><span class="line">        <span class="keyword">if</span> (bodyType.equals(MultipartFile.class)) &#123;</span><br><span class="line">            MultipartFile file = (MultipartFile) object;</span><br><span class="line">            Map data = Collections.singletonMap(file.getName(), object);</span><br><span class="line">            <span class="keyword">super</span>.encode(data, MAP_STRING_WILDCARD, template);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (bodyType.equals(MultipartFile[].class)) &#123;</span><br><span class="line">            <span class="comment">// MultipartFile数组处理</span></span><br><span class="line">            MultipartFile[] file = (MultipartFile[]) object;</span><br><span class="line">            <span class="keyword">if</span> (file != <span class="keyword">null</span>) &#123;</span><br><span class="line">                Map data = Collections.singletonMap(file.length == <span class="number">0</span> ? <span class="string">&quot;&quot;</span> : file[<span class="number">0</span>].getName(), object);</span><br><span class="line">                <span class="keyword">super</span>.encode(data, MAP_STRING_WILDCARD, template);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 其他类型调用父类默认处理方法</span></span><br><span class="line">        <span class="keyword">super</span>.encode(object, bodyType, template);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="FeignMultipartSupportConfig-类-配置-Encoder-注入-messageConverters"><a href="#FeignMultipartSupportConfig-类-配置-Encoder-注入-messageConverters" class="headerlink" title="FeignMultipartSupportConfig 类 - 配置 Encoder 注入 messageConverters"></a><code>FeignMultipartSupportConfig</code> 类 - 配置 <code>Encoder</code> 注入 <code>messageConverters</code></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> feign.codec.Encoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.ObjectFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.http.HttpMessageConverters;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.support.SpringEncoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FeignMultipartSupportConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//    @Bean</span></span><br><span class="line"><span class="comment">//    public Encoder feignEncoder(ObjectFactory&lt;HttpMessageConverters&gt; messageConverters) &#123;</span></span><br><span class="line"><span class="comment">//        return new SpringMultipartEncoder(new SpringEncoder(messageConverters));</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ObjectFactory&lt;HttpMessageConverters&gt; messageConverters;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Encoder <span class="title">feignEncoder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SpringMultipartEncoder(<span class="keyword">new</span> SpringEncoder(messageConverters));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="消费者的文件服务客户端-FileClient-类-FeignClient"><a href="#消费者的文件服务客户端-FileClient-类-FeignClient" class="headerlink" title="消费者的文件服务客户端 FileClient 类 - FeignClient"></a>消费者的文件服务客户端 <code>FileClient</code> 类 - FeignClient</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文件存储客户端</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@FeignClient(name = &quot;file-service&quot;, configuration = SpringMultipartEncoder.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">FileClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 上传文件存储对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> files</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> firstKey</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(value = &quot;/api/file/upload&quot;, consumes = MediaType.MULTIPART_FORM_DATA_VALUE, produces = MediaType.APPLICATION_JSON_VALUE)</span></span><br><span class="line">    <span class="function">List&lt;String&gt; <span class="title">upload</span><span class="params">(<span class="meta">@RequestPart(value = &quot;files&quot;)</span> MultipartFile[] files, <span class="meta">@RequestParam(&quot;firstKey&quot;)</span> String firstKey)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="上面有个-SpringMultipartEncoder-类-这个是我们重写刚才导入jar包中的-FormEncoder-以支持任意数量文件上传-同时这里用-RequestPart-注意不能用-RequestParam-如果用-RequestParam-被调用的服务方会出现如下错误"><a href="#上面有个-SpringMultipartEncoder-类-这个是我们重写刚才导入jar包中的-FormEncoder-以支持任意数量文件上传-同时这里用-RequestPart-注意不能用-RequestParam-如果用-RequestParam-被调用的服务方会出现如下错误" class="headerlink" title="上面有个 SpringMultipartEncoder 类,这个是我们重写刚才导入jar包中的 FormEncoder ,以支持任意数量文件上传,同时这里用 @RequestPart ,注意不能用 @RequestParam,如果用 @RequestParam ,被调用的服务方会出现如下错误"></a>上面有个 <code>SpringMultipartEncoder</code> 类,这个是我们重写刚才导入jar包中的 <code>FormEncoder</code> ,以支持任意数量文件上传,同时这里用 <em><code>@RequestPart</code></em> ,注意不能用 <em><code>@RequestParam</code></em>,如果用 <em><code>@RequestParam</code></em> ,被调用的服务方会出现如下错误</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Caused by: org.apache.commons.fileupload.FileUploadException: the request was rejected because no multipart boundary was found</span><br></pre></td></tr></table></figure><ul><li><h4 id="RequestParam-适用于-name-valueString-类型的请求域"><a href="#RequestParam-适用于-name-valueString-类型的请求域" class="headerlink" title="@RequestParam 适用于 name-valueString 类型的请求域"></a><code>@RequestParam</code> 适用于 <code>name-valueString</code> 类型的请求域</h4></li><li><h4 id="RequestPart-适用于复杂的请求域-JSON-XML"><a href="#RequestPart-适用于复杂的请求域-JSON-XML" class="headerlink" title="@RequestPart 适用于复杂的请求域 (JSON,XML)"></a><code>@RequestPart</code> 适用于复杂的请求域 (JSON,XML)</h4></li></ul><h2 id="消费者的文件服务控制层"><a href="#消费者的文件服务控制层" class="headerlink" title="消费者的文件服务控制层"></a>消费者的文件服务控制层</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> FileClient fileClient;  <span class="comment">// 消费者的文件服务客户端</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 上传文件存储对象</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> files</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> firstKey</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;file/v1/upload&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">fileUpload</span><span class="params">(<span class="meta">@RequestParam(&quot;files&quot;)</span> MultipartFile[] files, String firstKey)</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; strings = fileClient.upload(files, firstKey);</span><br><span class="line">    <span class="keyword">return</span> strings;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="生产者的文件服务控制层"><a href="#生产者的文件服务控制层" class="headerlink" title="生产者的文件服务控制层"></a>生产者的文件服务控制层</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 上传文件存储对象</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> files</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> firstKey</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/api/file/upload&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">upload</span><span class="params">(<span class="meta">@RequestParam(&quot;files&quot;)</span> MultipartFile[] files, <span class="meta">@RequestParam(&quot;firstKey&quot;)</span> String firstKey)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;应用场景&quot;&gt;&lt;a href=&quot;#应用场景&quot; class=&quot;headerlink&quot; title=&quot;应用场景&quot;&gt;&lt;/a&gt;应用场景&lt;/h2&gt;&lt;p&gt;第三方调用的我的接口,上传若干个文件,我用 &lt;code&gt;MultiPartFile[]&lt;/code&gt; 数组接收,之后我调用其他服务的接口,把文件发送过去,统一保存&lt;/p&gt;
&lt;p&gt;目前存在的问题就是,当你使用 &lt;code&gt;feign&lt;/code&gt; 传递 &lt;code&gt;MultipartFile&lt;/code&gt; 对象时,接收方无法解析,所以需要重写 &lt;code&gt;feign&lt;/code&gt; 的 &lt;code&gt;Encoder&lt;/code&gt; ,让它支持 &lt;code&gt;MultipartFile&lt;/code&gt; 类型以及 &lt;code&gt;MultipartFile[]&lt;/code&gt; 数组类型&lt;/p&gt;
&lt;h2 id=&quot;异常输出&quot;&gt;&lt;a href=&quot;#异常输出&quot; class=&quot;headerlink&quot; title=&quot;异常输出&quot;&gt;&lt;/a&gt;异常输出&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;com.fasterxml.jackson.databind.exc.InvalidDefinitionException: No serializer found for class java.io.FileDescriptor and no properties discovered to create BeanSerializer (to avoid exception, disable SerializationFeature.FAIL_ON_EMPTY_BEANS) (through reference chain: org.springframework.web.multipart.support.StandardMultipartHttpServletRequest$StandardMultipartFile[0]-&amp;gt;org.springframework.web.multipart.support.StandardMultipartHttpServletRequest$StandardMultipartFile[&amp;quot;inputStream&amp;quot;]-&amp;gt;java.io.FileInputStream[&amp;quot;fd&amp;quot;])&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;Maven引入jar包&quot;&gt;&lt;a href=&quot;#Maven引入jar包&quot; class=&quot;headerlink&quot; title=&quot;Maven引入jar包&quot;&gt;&lt;/a&gt;Maven引入jar包&lt;/h2&gt;&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&amp;lt;!-- 支持feign传递MultipartFile --&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;io.github.openfeign.form&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;feign-form&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;3.3.0&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;io.github.openfeign.form&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;feign-form-spring&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;3.3.0&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="springcloud" scheme="https://aliatry.com/categories/springcloud/"/>
    
    <category term="feign" scheme="https://aliatry.com/categories/springcloud/feign/"/>
    
    <category term="MultiPartFile" scheme="https://aliatry.com/categories/springcloud/feign/MultiPartFile/"/>
    
    
    <category term="springcloud" scheme="https://aliatry.com/tags/springcloud/"/>
    
    <category term="feign" scheme="https://aliatry.com/tags/feign/"/>
    
    <category term="MultiPartFile" scheme="https://aliatry.com/tags/MultiPartFile/"/>
    
  </entry>
  
  <entry>
    <title>Java的Excel读写-easyExcel方法封装</title>
    <link href="https://aliatry.com/2019/05/20/Java%E7%9A%84Excel%E8%AF%BB%E5%86%99-easyExcel%E6%96%B9%E6%B3%95%E5%B0%81%E8%A3%85/"/>
    <id>https://aliatry.com/2019/05/20/Java%E7%9A%84Excel%E8%AF%BB%E5%86%99-easyExcel%E6%96%B9%E6%B3%95%E5%B0%81%E8%A3%85/</id>
    <published>2019-05-20T09:42:11.000Z</published>
    <updated>2019-10-12T06:03:54.001Z</updated>
    
    <content type="html"><![CDATA[<h2 id="JAVA解析的Excel工具easyexcel"><a href="#JAVA解析的Excel工具easyexcel" class="headerlink" title="JAVA解析的Excel工具easyexcel"></a><a href="https://github.com/alibaba/easyexcel">JAVA解析的Excel工具easyexcel</a></h2><p>Java解析，生成Excel比较有名的框架有Apache poi，jxl。但他们都存在一个严重的问题就是非常的耗内存，poi有一套SAX模式的API可以一定程度的解决一些内存溢出的问题，但POI还是有一些缺陷，比如07版Excel解压缩以及解压后存储都是在内存中完成的，内存消耗依然很大.easyexcel重写了poi对07版Excel的解析，能够原本一个3M的excel用POI sax依然需要100M左右内存降低到KB级别，并且再大的Excel中不会出现内存溢出，03版依赖POI的萨克斯模式。在上层做了模型转换的封装，让使用者更加简单方便</p><h3 id="Maven依赖"><a href="#Maven依赖" class="headerlink" title="Maven依赖"></a>Maven依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/easyexcel --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easyexcel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="GitHub源码"><a href="#GitHub源码" class="headerlink" title="GitHub源码"></a><a href="https://github.com/admin-SIMON/easyexcel-encapsulation">GitHub源码</a></h3><p>请自行下载源码,访问 <a href="http://localhost/readExcelWithSheets"><code>localhost/readExcelWithSheets</code></a> 下载文件后自行用 <a href="https://www.getpostman.com/downloads/"><code>Postman</code></a> 测试</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;JAVA解析的Excel工具easyexcel&quot;&gt;&lt;a href=&quot;#JAVA解析的Excel工具easyexcel&quot; class=&quot;headerlink&quot; title=&quot;JAVA解析的Excel工具easyexcel&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://github.com/alibaba/easyexcel&quot;&gt;JAVA解析的Excel工具easyexcel&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Java解析，生成Excel比较有名的框架有Apache poi，jxl。但他们都存在一个严重的问题就是非常的耗内存，poi有一套SAX模式的API可以一定程度的解决一些内存溢出的问题，但POI还是有一些缺陷，比如07版Excel解压缩以及解压后存储都是在内存中完成的，内存消耗依然很大.easyexcel重写了poi对07版Excel的解析，能够原本一个3M的excel用POI sax依然需要100M左右内存降低到KB级别，并且再大的Excel中不会出现内存溢出，03版依赖POI的萨克斯模式。在上层做了模型转换的封装，让使用者更加简单方便&lt;/p&gt;
&lt;h3 id=&quot;Maven依赖&quot;&gt;&lt;a href=&quot;#Maven依赖&quot; class=&quot;headerlink&quot; title=&quot;Maven依赖&quot;&gt;&lt;/a&gt;Maven依赖&lt;/h3&gt;&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;&amp;lt;!-- https://mvnrepository.com/artifact/com.alibaba/easyexcel --&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;com.alibaba&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;easyexcel&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;1.1.1&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;version&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="easyExcel" scheme="https://aliatry.com/categories/easyExcel/"/>
    
    
    <category term="easyExcel" scheme="https://aliatry.com/tags/easyExcel/"/>
    
    <category term="Excel" scheme="https://aliatry.com/tags/Excel/"/>
    
  </entry>
  
  <entry>
    <title>微信提现-企业付款到零钱</title>
    <link href="https://aliatry.com/2019/05/17/%E5%BE%AE%E4%BF%A1%E6%8F%90%E7%8E%B0-%E4%BC%81%E4%B8%9A%E4%BB%98%E6%AC%BE%E5%88%B0%E9%9B%B6%E9%92%B1/"/>
    <id>https://aliatry.com/2019/05/17/%E5%BE%AE%E4%BF%A1%E6%8F%90%E7%8E%B0-%E4%BC%81%E4%B8%9A%E4%BB%98%E6%AC%BE%E5%88%B0%E9%9B%B6%E9%92%B1/</id>
    <published>2019-05-17T02:30:37.000Z</published>
    <updated>2019-09-11T10:30:40.294Z</updated>
    
    <content type="html"><![CDATA[<h1 id="微信提现-企业付款到零钱"><a href="#微信提现-企业付款到零钱" class="headerlink" title="微信提现-企业付款到零钱"></a>微信提现-企业付款到零钱</h1><h2 id="p12证书下载"><a href="#p12证书下载" class="headerlink" title="p12证书下载"></a>p12证书下载</h2><ul><li><p><a href="https://pay.weixin.qq.com/wiki/doc/api/tools/mch_pay.php?chapter=14_1">企业付款到零钱API</a></p></li><li><p><a href="https://pay.weixin.qq.com/">apiclient_cert.p12证书:微信商户平台 – 账户设置 – API安全 – 证书中下载</a></p></li></ul><a id="more"></a><h2 id="开发环境-参数准备"><a href="#开发环境-参数准备" class="headerlink" title="开发环境/参数准备"></a>开发环境/参数准备</h2><ul><li><p>SpringBoot2.0框架 （仅限本例，其他框架自行解决，原理相同）</p></li><li><p>APP_ID （公众账号appid）</p></li><li><p>MCH_ID（商户号）</p></li><li><p>API_SECRET（API密钥）</p></li></ul><h2 id="pom-xml相关jar包-插件引入"><a href="#pom-xml相关jar包-插件引入" class="headerlink" title="pom.xml相关jar包/插件引入"></a>pom.xml相关jar包/插件引入</h2><ul><li>xml相关jar包引入（微信接口要求以xml格式传参）<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- xml --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.sf.kxml<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kxml2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>xmlpull<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xmlpull<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li>maven过滤证书转码<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-resources-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 过滤后缀为p12/crt/pem/pfx不需要转码的证书文件 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">nonFilteredFileExtensions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">nonFilteredFileExtension</span>&gt;</span>p12<span class="tag">&lt;/<span class="name">nonFilteredFileExtension</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">nonFilteredFileExtension</span>&gt;</span>crt<span class="tag">&lt;/<span class="name">nonFilteredFileExtension</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">nonFilteredFileExtension</span>&gt;</span>pem<span class="tag">&lt;/<span class="name">nonFilteredFileExtension</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">nonFilteredFileExtension</span>&gt;</span>pfx<span class="tag">&lt;/<span class="name">nonFilteredFileExtension</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">nonFilteredFileExtensions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li>将下载好的证书放在 <code>src/main/resources</code></li></ul><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><ul><li>HttpUtils（企业付款http请求工具）</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zero.aliatry.utils.withdrawal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.NameValuePair;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.config.RequestConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.entity.UrlEncodedFormEntity;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpGet;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpPost;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.conn.ssl.SSLConnectionSocketFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.entity.StringEntity;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.HttpClients;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.message.BasicNameValuePair;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.ssl.SSLContexts;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.util.EntityUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.ClassPathResource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.Resource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.SSLContext;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyStore;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Map.Entry;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 企业付款http请求工具</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_CHARSET = <span class="string">&quot;UTF-8&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CONNECT_TIME_OUT = <span class="number">5000</span>; <span class="comment">//链接超时时间3秒</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> RequestConfig REQUEST_CONFIG = RequestConfig.custom().setConnectTimeout(CONNECT_TIME_OUT).build();</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> SSLContext wx_ssl_context = <span class="keyword">null</span>; <span class="comment">//微信支付ssl证书</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String MCH_ID  = <span class="string">&quot;1000000000&quot;</span>;<span class="comment">//证书密码默认是商户号</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span>&#123;</span><br><span class="line">Resource resource = <span class="keyword">new</span> ClassPathResource(<span class="string">&quot;apiclient_cert.p12&quot;</span>);<span class="comment">//该证书名字最好改为别人猜不到的</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">KeyStore keystore = KeyStore.getInstance(<span class="string">&quot;PKCS12&quot;</span>);</span><br><span class="line"><span class="keyword">char</span>[] keyPassword = MCH_ID.toCharArray(); <span class="comment">//证书密码</span></span><br><span class="line">keystore.load(resource.getInputStream(), keyPassword);</span><br><span class="line">wx_ssl_context = SSLContexts.custom().loadKeyMaterial(keystore, keyPassword).build();</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 功能描述: get 请求</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> url 请求地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params 参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> headers headers参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 请求失败返回null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">get</span><span class="params">(String url, Map&lt;String, String&gt; params, Map&lt;String, String&gt; headers)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">CloseableHttpClient httpClient = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (params != <span class="keyword">null</span> &amp;&amp; !params.isEmpty()) &#123;</span><br><span class="line">StringBuffer param = <span class="keyword">new</span> StringBuffer();</span><br><span class="line"><span class="keyword">boolean</span> flag = <span class="keyword">true</span>; <span class="comment">// 是否开始</span></span><br><span class="line"><span class="keyword">for</span> (Entry&lt;String, String&gt; entry : params.entrySet()) &#123;</span><br><span class="line"><span class="keyword">if</span> (flag) &#123;</span><br><span class="line">param.append(<span class="string">&quot;?&quot;</span>);</span><br><span class="line">flag = <span class="keyword">false</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">param.append(<span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">param.append(entry.getKey()).append(<span class="string">&quot;=&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">param.append(URLEncoder.encode(entry.getValue(), DEFAULT_CHARSET));</span><br><span class="line">&#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line"><span class="comment">//编码失败</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">url += param.toString();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">String body = <span class="keyword">null</span>;</span><br><span class="line">CloseableHttpResponse response = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">httpClient = HttpClients.custom().setDefaultRequestConfig(REQUEST_CONFIG).build();</span><br><span class="line">HttpGet httpGet = <span class="keyword">new</span> HttpGet(url);</span><br><span class="line">response = httpClient.execute(httpGet);</span><br><span class="line">body = EntityUtils.toString(response.getEntity(), DEFAULT_CHARSET);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (response != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">response.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (httpClient != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">httpClient.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> body;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 功能描述: get 请求</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> url 请求地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 请求失败返回null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">get</span><span class="params">(String url)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> get(url, <span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 功能描述: get 请求</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> url 请求地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params 参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 请求失败返回null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">get</span><span class="params">(String url, Map&lt;String, String&gt; params)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> get(url, params, <span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 功能描述: post 请求</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> url 请求地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params 参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 请求失败返回null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">post</span><span class="params">(String url, Map&lt;String, String&gt; params)</span> </span>&#123;</span><br><span class="line">CloseableHttpClient httpClient = <span class="keyword">null</span>;</span><br><span class="line">HttpPost httpPost = <span class="keyword">new</span> HttpPost(url);</span><br><span class="line">List&lt;NameValuePair&gt; nameValuePairs = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="keyword">if</span> (params != <span class="keyword">null</span> &amp;&amp; !params.isEmpty()) &#123;</span><br><span class="line"><span class="keyword">for</span> (Entry&lt;String, String&gt; entry : params.entrySet()) &#123;</span><br><span class="line">nameValuePairs.add(<span class="keyword">new</span> BasicNameValuePair(entry.getKey(), entry.getValue()));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">String body = <span class="keyword">null</span>;</span><br><span class="line">CloseableHttpResponse response = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">httpClient = HttpClients.custom().setDefaultRequestConfig(REQUEST_CONFIG).build();</span><br><span class="line">httpPost.setEntity(<span class="keyword">new</span> UrlEncodedFormEntity(nameValuePairs, DEFAULT_CHARSET));</span><br><span class="line">response = httpClient.execute(httpPost);</span><br><span class="line">body = EntityUtils.toString(response.getEntity(), DEFAULT_CHARSET);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (response != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">response.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (httpClient != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">httpClient.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> body;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 功能描述: post 请求</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> url 请求地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> s 参数xml</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 请求失败返回null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">post</span><span class="params">(String url, String s)</span> </span>&#123;</span><br><span class="line">CloseableHttpClient httpClient = <span class="keyword">null</span>;</span><br><span class="line">HttpPost httpPost = <span class="keyword">new</span> HttpPost(url);</span><br><span class="line">String body = <span class="keyword">null</span>;</span><br><span class="line">CloseableHttpResponse response = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">httpClient = HttpClients.custom().setDefaultRequestConfig(REQUEST_CONFIG).build();</span><br><span class="line">httpPost.setEntity(<span class="keyword">new</span> StringEntity(s, DEFAULT_CHARSET));</span><br><span class="line">response = httpClient.execute(httpPost);</span><br><span class="line">body = EntityUtils.toString(response.getEntity(), DEFAULT_CHARSET);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (response != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">response.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (httpClient != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">httpClient.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> body;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 功能描述: post https请求，服务器双向证书验证</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> url 请求地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params 参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 请求失败返回null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">posts</span><span class="params">(String url, Map&lt;String, String&gt; params)</span> </span>&#123;</span><br><span class="line">CloseableHttpClient httpClient = <span class="keyword">null</span>;</span><br><span class="line">HttpPost httpPost = <span class="keyword">new</span> HttpPost(url);</span><br><span class="line">List&lt;NameValuePair&gt; nameValuePairs = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="keyword">if</span> (params != <span class="keyword">null</span> &amp;&amp; !params.isEmpty()) &#123;</span><br><span class="line"><span class="keyword">for</span> (Entry&lt;String, String&gt; entry : params.entrySet()) &#123;</span><br><span class="line">nameValuePairs.add(<span class="keyword">new</span> BasicNameValuePair(entry.getKey(), entry.getValue()));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">String body = <span class="keyword">null</span>;</span><br><span class="line">CloseableHttpResponse response = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">httpClient = HttpClients.custom().setDefaultRequestConfig(REQUEST_CONFIG).setSSLSocketFactory(getSSLConnectionSocket()).build();</span><br><span class="line">httpPost.setEntity(<span class="keyword">new</span> UrlEncodedFormEntity(nameValuePairs, DEFAULT_CHARSET));</span><br><span class="line">response = httpClient.execute(httpPost);</span><br><span class="line">body = EntityUtils.toString(response.getEntity(), DEFAULT_CHARSET);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (response != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">response.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (httpClient != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">httpClient.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> body;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 功能描述: post https请求，服务器双向证书验证</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> url 请求地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> s 参数xml</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 请求失败返回null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">posts</span><span class="params">(String url, String s)</span> </span>&#123;</span><br><span class="line">CloseableHttpClient httpClient = <span class="keyword">null</span>;</span><br><span class="line">HttpPost httpPost = <span class="keyword">new</span> HttpPost(url);</span><br><span class="line">String body = <span class="keyword">null</span>;</span><br><span class="line">CloseableHttpResponse response = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">httpClient = HttpClients.custom().setDefaultRequestConfig(REQUEST_CONFIG).setSSLSocketFactory(getSSLConnectionSocket()).build();</span><br><span class="line">httpPost.setEntity(<span class="keyword">new</span> StringEntity(s, DEFAULT_CHARSET));</span><br><span class="line">response = httpClient.execute(httpPost);</span><br><span class="line">body = EntityUtils.toString(response.getEntity(), DEFAULT_CHARSET);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (response != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">response.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (httpClient != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">httpClient.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> body;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取ssl connection链接</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> SSLConnectionSocketFactory <span class="title">getSSLConnectionSocket</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> SSLConnectionSocketFactory(wx_ssl_context, <span class="keyword">new</span> String[] &#123;<span class="string">&quot;TLSv1&quot;</span>, <span class="string">&quot;TLSv1.1&quot;</span>, <span class="string">&quot;TLSv1.2&quot;</span>&#125;, <span class="keyword">null</span>, SSLConnectionSocketFactory.getDefaultHostnameVerifier());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>XmlUtil （xml、map转换工具）</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zero.aliatry.utils.withdrawal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.util.StringUtil;</span><br><span class="line"><span class="keyword">import</span> org.xmlpull.v1.XmlPullParser;</span><br><span class="line"><span class="keyword">import</span> org.xmlpull.v1.XmlPullParserException;</span><br><span class="line"><span class="keyword">import</span> org.xmlpull.v1.XmlPullParserFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Map.Entry;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * xml、map转换工具</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XmlUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PREFIX_XML = <span class="string">&quot;&lt;xml&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SUFFIX_XML = <span class="string">&quot;&lt;/xml&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PREFIX_CDATA = <span class="string">&quot;&lt;![CDATA[&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SUFFIX_CDATA = <span class="string">&quot;]]&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 转化成xml, 单层无嵌套</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> parm</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> isAddCDATA</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">xmlFormat</span><span class="params">(Map&lt;String, String&gt; parm, <span class="keyword">boolean</span> isAddCDATA)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">StringBuffer strbuff = <span class="keyword">new</span> StringBuffer(PREFIX_XML);</span><br><span class="line"><span class="keyword">if</span> (CollectionUtil.isNotEmpty(parm)) &#123;</span><br><span class="line"><span class="keyword">for</span> (Entry&lt;String, String&gt; entry : parm.entrySet()) &#123;</span><br><span class="line">strbuff.append(<span class="string">&quot;&lt;&quot;</span>).append(entry.getKey()).append(<span class="string">&quot;&gt;&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (isAddCDATA) &#123;</span><br><span class="line">strbuff.append(PREFIX_CDATA);</span><br><span class="line"><span class="keyword">if</span> (StringUtil.isNotEmpty(entry.getValue())) &#123;</span><br><span class="line">strbuff.append(entry.getValue());</span><br><span class="line">&#125;</span><br><span class="line">strbuff.append(SUFFIX_CDATA);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (StringUtil.isNotEmpty(entry.getValue())) &#123;</span><br><span class="line">strbuff.append(entry.getValue());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">strbuff.append(<span class="string">&quot;&lt;/&quot;</span>).append(entry.getKey()).append(<span class="string">&quot;&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> strbuff.append(SUFFIX_XML).toString();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 解析xml</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> xml</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> XmlPullParserException</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, String&gt; <span class="title">xmlParse</span><span class="params">(String xml)</span> <span class="keyword">throws</span> XmlPullParserException, IOException </span>&#123;</span><br><span class="line">Map&lt;String, String&gt; map = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (StringUtil.isNotEmpty(xml)) &#123;</span><br><span class="line">InputStream inputStream = <span class="keyword">new</span> ByteArrayInputStream(xml.getBytes());</span><br><span class="line">XmlPullParser pullParser = XmlPullParserFactory.newInstance().newPullParser();</span><br><span class="line">pullParser.setInput(inputStream, <span class="string">&quot;UTF-8&quot;</span>); <span class="comment">// 为xml设置要解析的xml数据</span></span><br><span class="line"><span class="keyword">int</span> eventType = pullParser.getEventType();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (eventType != XmlPullParser.END_DOCUMENT) &#123;</span><br><span class="line"><span class="keyword">switch</span> (eventType) &#123;</span><br><span class="line"><span class="keyword">case</span> XmlPullParser.START_DOCUMENT:</span><br><span class="line">map = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> XmlPullParser.START_TAG:</span><br><span class="line">String key = pullParser.getName();</span><br><span class="line"><span class="keyword">if</span> (key.equals(<span class="string">&quot;xml&quot;</span>))</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">String value = pullParser.nextText().trim();</span><br><span class="line">map.put(key, value);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> XmlPullParser.END_TAG:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">eventType = pullParser.next();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> map;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>PayUtil</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zero.aliatry.utils.withdrawal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.util.StringUtil;</span><br><span class="line"><span class="keyword">import</span> com.zero.aliatry.utils.ChineseCharToEnUtil;</span><br><span class="line"><span class="keyword">import</span> com.zero.aliatry.utils.DateUtil;</span><br><span class="line"><span class="keyword">import</span> com.zero.aliatry.utils.Encrypt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PayUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 生成订单号</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getTradeNo</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 自增8位数 00000001</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;TNO&quot;</span> + DateUtil.formatDate(<span class="keyword">new</span> Date(), DateUtil.TIME_STAMP_PATTERN) + <span class="string">&quot;00000001&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 退款单号</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getRefundNo</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 自增8位数 00000001</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;RNO&quot;</span> + DateUtil.formatDate(<span class="keyword">new</span> Date(), DateUtil.TIME_STAMP_PATTERN) + <span class="string">&quot;00000001&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 退款单号</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getTransferNo</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 自增8位数 00000001</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;TNO&quot;</span> + DateUtil.formatDate(<span class="keyword">new</span> Date(), DateUtil.TIME_STAMP_PATTERN) + <span class="string">&quot;00000001&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回客户端ip</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getRemoteAddrIp</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">String ip = request.getHeader(<span class="string">&quot;X-Forwarded-For&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (StringUtil.isNotEmpty(ip) &amp;&amp; !<span class="string">&quot;unKnown&quot;</span>.equalsIgnoreCase(ip)) &#123;</span><br><span class="line"><span class="comment">// 多次反向代理后会有多个ip值，第一个ip才是真实ip</span></span><br><span class="line"><span class="keyword">int</span> index = ip.indexOf(<span class="string">&quot;,&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (index != -<span class="number">1</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> ip.substring(<span class="number">0</span>, index);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> ip;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">ip = request.getHeader(<span class="string">&quot;X-Real-IP&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (StringUtil.isNotEmpty(ip) &amp;&amp; !<span class="string">&quot;unKnown&quot;</span>.equalsIgnoreCase(ip)) &#123;</span><br><span class="line"><span class="keyword">return</span> ip;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> request.getRemoteAddr();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取服务器的ip地址</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getLocalIp</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> request.getLocalAddr();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getSign</span><span class="params">(Map&lt;String, String&gt; params, String paternerKey)</span> <span class="keyword">throws</span> UnsupportedEncodingException </span>&#123;</span><br><span class="line"><span class="keyword">return</span> Encrypt.getMD5(createSign(params, <span class="keyword">false</span>) + <span class="string">&quot;&amp;key=&quot;</span> + paternerKey).toUpperCase();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 构造签名</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> encode</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> UnsupportedEncodingException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">createSign</span><span class="params">(Map&lt;String, String&gt; params, <span class="keyword">boolean</span> encode)</span> <span class="keyword">throws</span> UnsupportedEncodingException </span>&#123;</span><br><span class="line">Set&lt;String&gt; keysSet = params.keySet();</span><br><span class="line">Object[] keys = keysSet.toArray();</span><br><span class="line">Arrays.sort(keys);</span><br><span class="line">StringBuffer temp = <span class="keyword">new</span> StringBuffer();</span><br><span class="line"><span class="keyword">boolean</span> first = <span class="keyword">true</span>;</span><br><span class="line"><span class="keyword">for</span> (Object key : keys) &#123;</span><br><span class="line"><span class="keyword">if</span> (key == <span class="keyword">null</span> || StringUtil.isEmpty(params.get(key))) <span class="comment">// 参数为空不参与签名</span></span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line"><span class="keyword">if</span> (first) &#123;</span><br><span class="line">first = <span class="keyword">false</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">temp.append(<span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">temp.append(key).append(<span class="string">&quot;=&quot;</span>);</span><br><span class="line">Object value = params.get(key);</span><br><span class="line">String valueStr = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">null</span> != value) &#123;</span><br><span class="line">valueStr = value.toString();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (encode) &#123;</span><br><span class="line">temp.append(URLEncoder.encode(valueStr, <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">temp.append(valueStr);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> temp.toString();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建支付随机字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getNonceStr</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> ChineseCharToEnUtil.randomString(ChineseCharToEnUtil.LETTER_NUMBER_CHAR, <span class="number">32</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 支付时间戳</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">payTimestamp</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> Long.toString(System.currentTimeMillis() / <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>CollectionUtil</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zero.aliatry.utils.withdrawal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 集合类工具</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CollectionUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="title">CollectionUtil</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断一个集合是否为空</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function"><span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">(Collection&lt;T&gt; col)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (col == <span class="keyword">null</span> || col.isEmpty()) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断一个集合是否不为空</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function"><span class="keyword">boolean</span> <span class="title">isNotEmpty</span><span class="params">(Collection&lt;T&gt; col)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> !isEmpty(col);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断Map是否为空</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;K, V&gt; <span class="function"><span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">(Map&lt;K, V&gt; map)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (map == <span class="keyword">null</span> || map.isEmpty()) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断Map是否不为空为空</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;K, V&gt; <span class="function"><span class="keyword">boolean</span> <span class="title">isNotEmpty</span><span class="params">(Map&lt;K, V&gt; map)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> !isEmpty(map);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 去除list中的重复数据</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">removeRepeat</span><span class="params">(List&lt;T&gt; list)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (isEmpty(list)) &#123;</span><br><span class="line"><span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">List&lt;T&gt; result = <span class="keyword">new</span> ArrayList&lt;T&gt;();</span><br><span class="line"><span class="keyword">for</span> (T e : list) &#123;</span><br><span class="line"><span class="keyword">if</span> (!result.contains(e)) &#123;</span><br><span class="line">result.add(e);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将集合转换为String数组</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; String[] toArray(List&lt;T&gt; list) &#123;</span><br><span class="line"><span class="keyword">if</span> (isEmpty(list)) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">String[] result = <span class="keyword">new</span> String[list.size()];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; list.size(); i++) &#123;</span><br><span class="line">result[i] = String.valueOf(list.get(i));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>TransferController（提现相关接口）</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zero.aliatry.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.github.pagehelper.util.StringUtil;</span><br><span class="line"><span class="keyword">import</span> com.zero.aliatry.entity.WithdrawalRecord;</span><br><span class="line"><span class="keyword">import</span> com.zero.aliatry.service.WithdrawalRecord.WithdrawalRecordService;</span><br><span class="line"><span class="keyword">import</span> com.zero.aliatry.service.appUser.AppUserService;</span><br><span class="line"><span class="keyword">import</span> com.zero.aliatry.service.sysUser.SysUserService;</span><br><span class="line"><span class="keyword">import</span> com.zero.aliatry.utils.CheckParamsUtil;</span><br><span class="line"><span class="keyword">import</span> com.zero.aliatry.utils.DateUtil;</span><br><span class="line"><span class="keyword">import</span> com.zero.aliatry.utils.IpAddrUtil;</span><br><span class="line"><span class="keyword">import</span> com.zero.aliatry.utils.exception.ErrorEnum;</span><br><span class="line"><span class="keyword">import</span> com.zero.aliatry.utils.exception.Result;</span><br><span class="line"><span class="keyword">import</span> com.zero.aliatry.utils.exception.ResultUtil;</span><br><span class="line"><span class="keyword">import</span> com.zero.aliatry.utils.withdrawal.CollectionUtil;</span><br><span class="line"><span class="keyword">import</span> com.zero.aliatry.utils.withdrawal.HttpUtils;</span><br><span class="line"><span class="keyword">import</span> com.zero.aliatry.utils.withdrawal.PayUtil;</span><br><span class="line"><span class="keyword">import</span> com.zero.aliatry.utils.withdrawal.XmlUtil;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 提现相关接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/transfer&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransferController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    SysUserService sysUserService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    AppUserService appUserService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    WithdrawalRecordService withdrawalRecordService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(TransferController.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TRANSFERS_PAY = <span class="string">&quot;https://api.mch.weixin.qq.com/mmpaymkttransfers/promotion/transfers&quot;</span>; <span class="comment">// 企业付款API</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TRANSFERS_PAY_QUERY = <span class="string">&quot;https://api.mch.weixin.qq.com/mmpaymkttransfers/gettransferinfo&quot;</span>; <span class="comment">// 企业付款查询API</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String APP_ID = <span class="string">&quot;APP_ID&quot;</span>  ;<span class="comment">//公众账号appid</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String MCH_ID = <span class="string">&quot;MCH_ID&quot;</span>;<span class="comment">//商户号</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String API_SECRET = <span class="string">&quot;API_SECRET&quot;</span>;<span class="comment">//API密钥</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 企业向个人支付转账</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(value = &quot;/pay&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">transferPay</span><span class="params">(<span class="meta">@RequestBody</span> String params,HttpServletRequest request)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** =============================================接口参数校验================================================*/</span></span><br><span class="line">        JSONObject jsonObject = JSONObject.parseObject(params);<span class="comment">//解析json</span></span><br><span class="line">        <span class="comment">//校验参数是否为空</span></span><br><span class="line">        <span class="keyword">if</span>(CheckParamsUtil.isBlank(jsonObject,<span class="string">&quot;userId&quot;</span>,<span class="string">&quot;amount&quot;</span>,<span class="string">&quot;userType&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> ResultUtil.fail(ErrorEnum.ERROR_PARAM_ISBLANK);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**==============================================设置局部变量=================================================*/</span></span><br><span class="line">        String userId = jsonObject.getString(<span class="string">&quot;userId&quot;</span>);<span class="comment">//用户id</span></span><br><span class="line">        String openid = <span class="string">&quot;&quot;</span>;<span class="comment">//用户openid</span></span><br><span class="line">        Float applyMoney = jsonObject.getFloat(<span class="string">&quot;amount&quot;</span>);<span class="comment">//用户申请提现金额 0.3-5000</span></span><br><span class="line">        <span class="keyword">int</span> userType = jsonObject.getInteger(<span class="string">&quot;userType&quot;</span>);<span class="comment">//用户类型</span></span><br><span class="line">        String amount;<span class="comment">//企业付款金额</span></span><br><span class="line">        Float poundage = <span class="number">0f</span>;<span class="comment">//手续费</span></span><br><span class="line">        String desc;<span class="comment">//企业付款描述信息</span></span><br><span class="line">        String id = UUID.randomUUID().toString().replaceAll(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>);<span class="comment">//提现记录表id</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(applyMoney&lt;<span class="number">0.3</span>||applyMoney&gt;<span class="number">5000</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> ResultUtil.fail(<span class="string">&quot;00000001&quot;</span>,<span class="string">&quot;申请提现金额不符:低于最小金额0.30元或高于5000.00元&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** ======================================业务判断 1.userId是否有收款资格=====================================*/</span></span><br><span class="line">        <span class="keyword">if</span>(userType == <span class="number">1</span>)&#123;</span><br><span class="line">            openid = sysUserService.getOpenidBySysUserId(userId);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(userType == <span class="number">2</span>)&#123;</span><br><span class="line">            openid = appUserService.getOpenidByAppUserId(userId);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(openid==<span class="keyword">null</span>||openid.equals(<span class="string">&quot;&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> ResultUtil.fail(<span class="string">&quot;00000001&quot;</span>,<span class="string">&quot;该用户不可提现&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** ======================================业务判断 2.openid可提现金额校验=====================================*/</span></span><br><span class="line">        <span class="comment">/** userType==1 商家身份*/</span></span><br><span class="line">        <span class="keyword">if</span>(userType == <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="comment">//校验用户提现金额</span></span><br><span class="line">            <span class="comment">//1.提现金额&lt;=可提现金额 15%的抽成</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        Float account = <span class="number">0f</span>;</span><br><span class="line">        <span class="comment">/** userType==2 用户身份*/</span></span><br><span class="line">        <span class="keyword">if</span>(userType == <span class="number">2</span>)&#123;</span><br><span class="line">            <span class="comment">//校验用户提现金额</span></span><br><span class="line">            <span class="comment">//1.提现金额&lt;=可提现金额</span></span><br><span class="line">            account = appUserService.getAccount(userId);</span><br><span class="line">            <span class="keyword">if</span>(applyMoney&gt;account)&#123;</span><br><span class="line">                <span class="keyword">return</span> ResultUtil.fail(<span class="string">&quot;00000001&quot;</span>,<span class="string">&quot;非法操作：申请提现金额大于可提现金额&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">/** =================================业务判断 3.userId当天提现次数及当天提现金额限制==================================*/</span></span><br><span class="line">        <span class="comment">//当日提现次数 首次免手续费</span></span><br><span class="line">        List&lt;WithdrawalRecord&gt; withdrawalRecords = withdrawalRecordService.selectWithdrawalRecordOfToday(userId,openid,userType);</span><br><span class="line">        <span class="comment">//当日非初次提现</span></span><br><span class="line">        <span class="keyword">if</span>(withdrawalRecords.size()&gt;<span class="number">0</span>&amp;&amp;withdrawalRecords.size()&lt;=<span class="number">10</span>)&#123;</span><br><span class="line">            poundage = <span class="number">2f</span>;<span class="comment">//当日非初次提现，手续费为2元</span></span><br><span class="line">            desc = <span class="string">&quot;申请提现金额：&quot;</span>+applyMoney+<span class="string">&quot;元，当天已提现&quot;</span>+withdrawalRecords.size()+<span class="string">&quot;次，需扣除2元手续费&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//此处对用户当天累计提现金额可做限制</span></span><br><span class="line"><span class="comment">//            Float withdrawalAmountRequested = 0f;//用户今日累计已申请的提现额度</span></span><br><span class="line"><span class="comment">//            for(int i = 0;i &lt; withdrawalRecords.size();i++)&#123;</span></span><br><span class="line"><span class="comment">//                withdrawalAmountRequested = (withdrawalAmountRequested*1000+withdrawalRecords.get(i).getActualMoney()*1000)/1000;</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(withdrawalRecords.size()&gt;<span class="number">10</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> ResultUtil.fail(<span class="string">&quot;00000001&quot;</span>,<span class="string">&quot;该用户当天提现次数上限：微信企业付款每天最多可向同一个用户付款10次&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            desc = <span class="string">&quot;申请提现金额：&quot;</span>+applyMoney+<span class="string">&quot;元，当天首次提现免手续费&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** =================================业务判断 4.一个商户同一日付款总额限额10万元==================================*/</span></span><br><span class="line">        Float amountWithdrawn = withdrawalRecordService.selectAllWithdrawalRecordNumOfToday();<span class="comment">//商户同一日付款总额</span></span><br><span class="line">        <span class="keyword">if</span>(amountWithdrawn&gt;<span class="number">100000</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> ResultUtil.fail(<span class="string">&quot;00000001&quot;</span>,<span class="string">&quot;今日商户付款总额限额，请明天再试&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** ========================校验实际提现金额是否在微信企业付款实际允许的提现（0.3-5000）范围内=========================*/</span></span><br><span class="line">        Float actualMoney = (applyMoney*<span class="number">1000</span>-poundage*<span class="number">1000</span>)/<span class="number">1000</span>;<span class="comment">//实际提现金额</span></span><br><span class="line">        <span class="keyword">if</span>(actualMoney&lt;<span class="number">0.3</span>||actualMoney&gt;<span class="number">5000</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> ResultUtil.fail(<span class="string">&quot;00000001&quot;</span>,<span class="string">&quot;扣除手续费后的实际提现金额不符:&quot;</span>+actualMoney+<span class="string">&quot;元:低于最小金额0.30元或高于5000.00元&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        amount = Integer.parseInt((<span class="keyword">int</span>)((actualMoney)*<span class="number">10</span>)+<span class="string">&quot;&quot;</span>)*<span class="number">10</span>+<span class="string">&quot;&quot;</span>;<span class="comment">//微信企业付款金额 30-500000</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">/** ==================================================================================================================*/</span></span><br><span class="line">        <span class="comment">/** ================================================== 封装提现所需参数 ================================================*/</span></span><br><span class="line">        <span class="comment">/** ==================================================================================================================*/</span></span><br><span class="line">        Map&lt;String, String&gt; restmap = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Map&lt;String, String&gt; parm = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">            parm.put(<span class="string">&quot;mch_appid&quot;</span>, APP_ID); <span class="comment">//公众账号appid</span></span><br><span class="line">            parm.put(<span class="string">&quot;mchid&quot;</span>, MCH_ID); <span class="comment">//商户号</span></span><br><span class="line">            parm.put(<span class="string">&quot;nonce_str&quot;</span>, PayUtil.getNonceStr()); <span class="comment">//随机字符串</span></span><br><span class="line">            parm.put(<span class="string">&quot;partner_trade_no&quot;</span>, PayUtil.getTransferNo()); <span class="comment">//商户订单号</span></span><br><span class="line">            parm.put(<span class="string">&quot;openid&quot;</span>, openid); <span class="comment">//用户openid oCVr20N2YLH9VQztnkZTaCj2aYYY</span></span><br><span class="line">            parm.put(<span class="string">&quot;check_name&quot;</span>, <span class="string">&quot;NO_CHECK&quot;</span>); <span class="comment">//校验用户姓名选项 OPTION_CHECK</span></span><br><span class="line">            <span class="comment">//parm.put(&quot;re_user_name&quot;, &quot;安迪&quot;); //check_name设置为FORCE_CHECK或OPTION_CHECK，则必填</span></span><br><span class="line">            parm.put(<span class="string">&quot;amount&quot;</span>,amount); <span class="comment">//转账金额</span></span><br><span class="line">            parm.put(<span class="string">&quot;desc&quot;</span>, desc); <span class="comment">//企业付款描述信息</span></span><br><span class="line">            parm.put(<span class="string">&quot;spbill_create_ip&quot;</span>, IpAddrUtil.getIpAddr(request)); <span class="comment">//Ip地址</span></span><br><span class="line">            parm.put(<span class="string">&quot;sign&quot;</span>, PayUtil.getSign(parm, API_SECRET));</span><br><span class="line"></span><br><span class="line">            String restxml = HttpUtils.posts(TRANSFERS_PAY, XmlUtil.xmlFormat(parm, <span class="keyword">false</span>));</span><br><span class="line">            restmap = XmlUtil.xmlParse(restxml);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(e.getMessage(), e);</span><br><span class="line">            <span class="keyword">return</span> ResultUtil.fail(<span class="string">&quot;00000001&quot;</span>,<span class="string">&quot;转账发生异常&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** =================================================== 提现结果处理 ===================================================*/</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/** ============================================ 生成提现及流水记录/改变余额 ============================================*/</span></span><br><span class="line">        <span class="keyword">if</span> (CollectionUtil.isNotEmpty(restmap) &amp;&amp; <span class="string">&quot;SUCCESS&quot;</span>.equals(restmap.get(<span class="string">&quot;result_code&quot;</span>))) &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;转账成功&quot;</span>);</span><br><span class="line">            Map&lt;String, String&gt; transferMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">            transferMap.put(<span class="string">&quot;partnerTradeNo&quot;</span>, restmap.get(<span class="string">&quot;partner_trade_no&quot;</span>));<span class="comment">//商户转账订单号</span></span><br><span class="line">            transferMap.put(<span class="string">&quot;paymentNo&quot;</span>, restmap.get(<span class="string">&quot;payment_no&quot;</span>)); <span class="comment">//微信订单号</span></span><br><span class="line">            transferMap.put(<span class="string">&quot;paymentTime&quot;</span>, restmap.get(<span class="string">&quot;payment_time&quot;</span>)); <span class="comment">//微信支付成功时间</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//生成提现记录</span></span><br><span class="line">            withdrawalRecordService.insert(<span class="keyword">new</span> WithdrawalRecord(id,userType,userId,applyMoney,poundage,actualMoney,<span class="number">1</span>,restmap.get(<span class="string">&quot;partner_trade_no&quot;</span>),restmap.get(<span class="string">&quot;payment_no&quot;</span>),</span><br><span class="line">                    restmap.get(<span class="string">&quot;payment_time&quot;</span>)==<span class="keyword">null</span>?<span class="keyword">null</span>:DateUtil.strToDate(restmap.get(<span class="string">&quot;payment_time&quot;</span>),<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>),openid,desc,restmap.get(<span class="string">&quot;spbill_create_ip&quot;</span>),<span class="string">&quot;0&quot;</span>));</span><br><span class="line">            <span class="comment">//生成流水表</span></span><br><span class="line">            String waterId = UUID.randomUUID().toString().replaceAll(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">            Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">            map.put(<span class="string">&quot;id&quot;</span>,waterId);<span class="comment">//编号</span></span><br><span class="line">            map.put(<span class="string">&quot;userId&quot;</span>,userId);<span class="comment">//用户id</span></span><br><span class="line">            map.put(<span class="string">&quot;title&quot;</span>,<span class="string">&quot;提现&quot;</span>);<span class="comment">//该流水的标题</span></span><br><span class="line">            map.put(<span class="string">&quot;waterType&quot;</span>,<span class="number">2</span>);<span class="comment">//商家流水类型1.场地收入 2.提现    用户流水类型1.分销收入 2.提现 3.预订场地</span></span><br><span class="line">            map.put(<span class="string">&quot;incomeExpense&quot;</span>,<span class="number">1</span>);<span class="comment">//收入还是支出 0.收入 1.支出</span></span><br><span class="line">            map.put(<span class="string">&quot;applyMoney&quot;</span>,applyMoney);<span class="comment">//申请提现金额</span></span><br><span class="line">            map.put(<span class="string">&quot;poundage&quot;</span>,poundage);<span class="comment">//手续费</span></span><br><span class="line">            map.put(<span class="string">&quot;actualMoney&quot;</span>,actualMoney);<span class="comment">//实际金额</span></span><br><span class="line">            map.put(<span class="string">&quot;whetherToAccount&quot;</span>,<span class="number">1</span>);<span class="comment">//是否到账0.未到账1.已到账</span></span><br><span class="line">            <span class="keyword">if</span>(userType==<span class="number">1</span>)&#123;</span><br><span class="line">                sysUserService.insertUserWater(map);</span><br><span class="line">                <span class="comment">//改变用户可提现余额</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(userType==<span class="number">2</span>)&#123;</span><br><span class="line">                appUserService.insertUserWater1(map);</span><br><span class="line">                <span class="comment">//改变用户可提现余额</span></span><br><span class="line">                appUserService.updateUserAccount(userId,(account*<span class="number">1000</span>-applyMoney*<span class="number">1000</span>)/<span class="number">1000</span>);<span class="comment">//float精度问题</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> ResultUtil.success(transferMap);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** =================================================3.转账失败========================================================*/</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (CollectionUtil.isNotEmpty(restmap)) &#123;</span><br><span class="line">                logger.info(<span class="string">&quot;转账失败：&quot;</span> + restmap.get(<span class="string">&quot;err_code&quot;</span>) + <span class="string">&quot;:&quot;</span> + restmap.get(<span class="string">&quot;err_code_des&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> ResultUtil.fail(<span class="string">&quot;00000001&quot;</span>,<span class="string">&quot;转账失败&quot;</span>+restmap.get(<span class="string">&quot;err_code_des&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 企业向个人转账查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tradeno 商户转账订单号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> callback</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(value = &quot;/pay/query&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">orderPayQuery</span><span class="params">(HttpServletRequest request, HttpServletResponse response, String tradeno,</span></span></span><br><span class="line"><span class="function"><span class="params">                              String callback)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtil.isEmpty(tradeno)) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResultUtil.fail(<span class="string">&quot;00000001&quot;</span>,<span class="string">&quot;转账订单号不能为空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; restmap = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Map&lt;String, String&gt; parm = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">            parm.put(<span class="string">&quot;appid&quot;</span>, APP_ID);</span><br><span class="line">            parm.put(<span class="string">&quot;mch_id&quot;</span>, MCH_ID);</span><br><span class="line">            parm.put(<span class="string">&quot;partner_trade_no&quot;</span>, tradeno);</span><br><span class="line">            parm.put(<span class="string">&quot;nonce_str&quot;</span>, PayUtil.getNonceStr());</span><br><span class="line">            parm.put(<span class="string">&quot;sign&quot;</span>, PayUtil.getSign(parm, API_SECRET));</span><br><span class="line"></span><br><span class="line">            String restxml = HttpUtils.posts(TRANSFERS_PAY_QUERY, XmlUtil.xmlFormat(parm, <span class="keyword">true</span>));</span><br><span class="line">            restmap = XmlUtil.xmlParse(restxml);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(e.getMessage(), e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (CollectionUtil.isNotEmpty(restmap) &amp;&amp; <span class="string">&quot;SUCCESS&quot;</span>.equals(restmap.get(<span class="string">&quot;result_code&quot;</span>))) &#123;</span><br><span class="line">            <span class="comment">// 订单查询成功 处理业务逻辑</span></span><br><span class="line">            logger.info(<span class="string">&quot;订单查询：订单&quot;</span> + restmap.get(<span class="string">&quot;partner_trade_no&quot;</span>) + <span class="string">&quot;支付成功&quot;</span>);</span><br><span class="line">            Map&lt;String, String&gt; transferMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">            transferMap.put(<span class="string">&quot;partnerTradeNo&quot;</span>, restmap.get(<span class="string">&quot;partner_trade_no&quot;</span>));<span class="comment">//商户转账订单号</span></span><br><span class="line">            transferMap.put(<span class="string">&quot;openid&quot;</span>, restmap.get(<span class="string">&quot;openid&quot;</span>)); <span class="comment">//收款微信号</span></span><br><span class="line">            transferMap.put(<span class="string">&quot;paymentAmount&quot;</span>, restmap.get(<span class="string">&quot;payment_amount&quot;</span>)); <span class="comment">//转账金额</span></span><br><span class="line">            transferMap.put(<span class="string">&quot;transferTime&quot;</span>, restmap.get(<span class="string">&quot;transfer_time&quot;</span>)); <span class="comment">//转账时间</span></span><br><span class="line">            transferMap.put(<span class="string">&quot;desc&quot;</span>, restmap.get(<span class="string">&quot;desc&quot;</span>)); <span class="comment">//转账描述</span></span><br><span class="line">            <span class="keyword">return</span> ResultUtil.success(transferMap);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (CollectionUtil.isNotEmpty(restmap)) &#123;</span><br><span class="line">                logger.info(<span class="string">&quot;订单转账失败：&quot;</span> + restmap.get(<span class="string">&quot;err_code&quot;</span>) + <span class="string">&quot;:&quot;</span> + restmap.get(<span class="string">&quot;err_code_des&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> ResultUtil.fail(<span class="string">&quot;00000001&quot;</span>,<span class="string">&quot;订单转账失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;微信提现-企业付款到零钱&quot;&gt;&lt;a href=&quot;#微信提现-企业付款到零钱&quot; class=&quot;headerlink&quot; title=&quot;微信提现-企业付款到零钱&quot;&gt;&lt;/a&gt;微信提现-企业付款到零钱&lt;/h1&gt;&lt;h2 id=&quot;p12证书下载&quot;&gt;&lt;a href=&quot;#p12证书下载&quot; class=&quot;headerlink&quot; title=&quot;p12证书下载&quot;&gt;&lt;/a&gt;p12证书下载&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;https://pay.weixin.qq.com/wiki/doc/api/tools/mch_pay.php?chapter=14_1&quot;&gt;企业付款到零钱API&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;https://pay.weixin.qq.com/&quot;&gt;apiclient_cert.p12证书:微信商户平台 – 账户设置 – API安全 – 证书中下载&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="WeChat" scheme="https://aliatry.com/categories/WeChat/"/>
    
    
    <category term="WeChat" scheme="https://aliatry.com/tags/WeChat/"/>
    
  </entry>
  
  <entry>
    <title>零基础学习Mahout</title>
    <link href="https://aliatry.com/2019/05/13/%E9%9B%B6%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0Mahout/"/>
    <id>https://aliatry.com/2019/05/13/%E9%9B%B6%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0Mahout/</id>
    <published>2019-05-13T03:57:16.000Z</published>
    <updated>2021-01-07T06:07:43.652Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Mahout"><a href="#Mahout" class="headerlink" title="Mahout"></a>Mahout</h2><p><img src="https://mahout.apache.org/assets/mahout-logo-blue.svg" alt="Alt text"></p><p>Mahout 是 Apache Software Foundation（ASF） 旗下的一个开源项目，提供一些可扩展的机器学习领域经典算法的实现，旨在帮助开发人员更加方便快捷地创建智能应用程序。Mahout包含许多实现，包括聚类、分类、推荐过滤、频繁子项挖掘。此外，通过使用 Apache Hadoop 库，Mahout 可以有效地扩展到云中。</p><a id="more"></a><h2 id="安装Maven"><a href="#安装Maven" class="headerlink" title="安装Maven"></a><a href="http://maven.apache.org/">安装Maven</a></h2><p>Maven项目对象模型(POM)，可以通过一小段描述信息来管理项目的构建，报告和文档的项目管理工具软件。<br>Maven 除了以程序构建能力为特色之外，还提供高级项目管理工具。由于 Maven 的缺省构建规则有较高的可重用性，所以常常用两三行 Maven 构建脚本就可以构建简单的项目。由于 Maven 的面向项目的方法，许多 Apache Jakarta 项目发文时使用 Maven，而且公司项目采用 Maven 的比例在持续增长。<br>Maven这个单词来自于意第绪语（犹太语），意为知识的积累，最初在Jakata Turbine项目中用来简化构建过程。当时有一些项目（有各自Ant build文件），仅有细微的差别，而JAR文件都由CVS来维护。于是希望有一种标准化的方式构建项目，一个清晰的方式定义项目的组成，一个容易的方式发布项目的信息，以及一种简单的方式在多个项目中共享JARs。</p><h2 id="使用Maven构建Mahout项目"><a href="#使用Maven构建Mahout项目" class="headerlink" title="使用Maven构建Mahout项目"></a>使用Maven构建Mahout项目</h2><p>运行 <code>IntelliJ IDEA</code>，通过菜单 <code>File</code> &gt; <code>New</code> &gt; <code>Project</code> 新建项目，选择 <code>Maven</code> 勾上 <code>Create from archetype</code> 选择 <code>maven-archetype-quickstart</code> 再选择 <code>Next</code>  输入 <code>GroupId</code> 和 <code>ArtifactId</code>，可以根据自己喜好随便命名</p><p><img src="https://aliatry.oss-cn-shenzhen.aliyuncs.com/blog/20190513155946.png" alt="Alt text"></p><p><img src="https://aliatry.oss-cn-shenzhen.aliyuncs.com/blog/20190513160203.png" alt="Alt text"></p><p>剩下的全部按键盘 <code>Enter</code></p><p>工程创建完毕后，点击右下角的 <code>Enable Auto-Import</code> 开启自动导入</p><p><img src="https://aliatry.oss-cn-shenzhen.aliyuncs.com/blog/20190513164845.png" alt="Alt text"></p><p>下载完毕后，打开 <code>pom.xml</code> 替换 <code>&lt;properties&gt;</code> 和 <code>&lt;dependencies&gt;</code> 内容</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliatry.mahout<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>practice<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>practice<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mahout.version</span>&gt;</span>0.9<span class="tag">&lt;/<span class="name">mahout.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">slf4j-log4j12.version</span>&gt;</span>1.7.25<span class="tag">&lt;/<span class="name">slf4j-log4j12.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.mahout<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mahout-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mahout.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.mahout<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mahout-integration<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mahout.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.mahout<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mahout-math<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mahout.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.mahout<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mahout-examples<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mahout.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;slf4j-log4j12.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;slf4j-log4j12.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="修改-App-java"><a href="#修改-App-java" class="headerlink" title="修改 App.java"></a>修改 <code>App.java</code></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.aliatry.mahout;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.mahout.cf.taste.common.TasteException;</span><br><span class="line"><span class="keyword">import</span> org.apache.mahout.cf.taste.impl.common.LongPrimitiveIterator;</span><br><span class="line"><span class="keyword">import</span> org.apache.mahout.cf.taste.impl.model.file.FileDataModel;</span><br><span class="line"><span class="keyword">import</span> org.apache.mahout.cf.taste.impl.neighborhood.NearestNUserNeighborhood;</span><br><span class="line"><span class="keyword">import</span> org.apache.mahout.cf.taste.impl.recommender.GenericItemBasedRecommender;</span><br><span class="line"><span class="keyword">import</span> org.apache.mahout.cf.taste.impl.recommender.GenericUserBasedRecommender;</span><br><span class="line"><span class="keyword">import</span> org.apache.mahout.cf.taste.impl.similarity.EuclideanDistanceSimilarity;</span><br><span class="line"><span class="keyword">import</span> org.apache.mahout.cf.taste.impl.similarity.PearsonCorrelationSimilarity;</span><br><span class="line"><span class="keyword">import</span> org.apache.mahout.cf.taste.model.DataModel;</span><br><span class="line"><span class="keyword">import</span> org.apache.mahout.cf.taste.neighborhood.UserNeighborhood;</span><br><span class="line"><span class="keyword">import</span> org.apache.mahout.cf.taste.recommender.RecommendedItem;</span><br><span class="line"><span class="keyword">import</span> org.apache.mahout.cf.taste.recommender.Recommender;</span><br><span class="line"><span class="keyword">import</span> org.apache.mahout.cf.taste.similarity.ItemSimilarity;</span><br><span class="line"><span class="keyword">import</span> org.apache.mahout.cf.taste.similarity.UserSimilarity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Hello world!</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 初始化</span></span><br><span class="line"><span class="comment">//        initial();</span></span><br><span class="line"></span><br><span class="line">        baseUser(); <span class="comment">// 基于用户的协同过滤算法</span></span><br><span class="line">        baseItem(); <span class="comment">// 基于物品的协同过滤算法</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// TODO 基于用户的协同过滤算法</span></span><br><span class="line">        <span class="comment">// 从文件加载数据</span></span><br><span class="line">        DataModel model = <span class="keyword">new</span> FileDataModel(<span class="keyword">new</span> File(<span class="string">&quot;D:\\data.csv&quot;</span>));</span><br><span class="line">        <span class="comment">// 指定用户相似度计算方法，这里采用皮尔森相关度</span></span><br><span class="line">        UserSimilarity similarity = <span class="keyword">new</span> PearsonCorrelationSimilarity(model);</span><br><span class="line">        <span class="comment">// 指定用户邻居数量，这里为2</span></span><br><span class="line">        UserNeighborhood neighborhood = <span class="keyword">new</span> NearestNUserNeighborhood(<span class="number">2</span>, similarity, model);</span><br><span class="line">        <span class="comment">// 构建基于用户的推荐系统</span></span><br><span class="line">        Recommender recommender = <span class="keyword">new</span> GenericUserBasedRecommender(model, neighborhood, similarity);</span><br><span class="line">        <span class="comment">// 得到指定用户的推荐结果，这里是得到用户1的两个推荐</span></span><br><span class="line">        List&lt;RecommendedItem&gt; recommendations = recommender.recommend(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="comment">// 打印推荐结果</span></span><br><span class="line">        <span class="keyword">for</span> (RecommendedItem recommendation : recommendations) &#123;</span><br><span class="line">            System.out.println(recommendation);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">initial</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        FileOutputStream out = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">int</span>[][] arg = &#123;</span><br><span class="line">                    &#123;<span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>&#125;,</span><br><span class="line">                    &#123;<span class="number">0</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">0</span>&#125;,</span><br><span class="line">                    &#123;<span class="number">1</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">2</span>&#125;,</span><br><span class="line">                    &#123;<span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">0</span>&#125;,</span><br><span class="line">                    &#123;<span class="number">5</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">5</span>&#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            out = <span class="keyword">new</span> FileOutputStream(<span class="keyword">new</span> File(<span class="string">&quot;D:\\data.csv&quot;</span>));</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">7</span>; j++) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (arg[i][j] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                        String a = i + <span class="string">&quot;,&quot;</span> + j + <span class="string">&quot;,&quot;</span> + arg[i][j] + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">                        out.write(a.getBytes());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            out.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                out.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 基于用户的协同过滤算法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> TasteException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">baseUser</span><span class="params">()</span> <span class="keyword">throws</span> IOException, TasteException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> NEIGHBORHOOD_NUM = <span class="number">2</span>;   <span class="comment">//用户邻居数量</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> RECOMMENDER_NUM = <span class="number">3</span>;    <span class="comment">//推荐结果个数</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        准备数据 这里是电影评分数据</span></span><br><span class="line"><span class="comment">        数据集，其中第一列表示用户id；第二列表示商品id；第三列表示评分，评分是5分制</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        将数据加载到内存中</span></span><br><span class="line"><span class="comment">        基于文件的model，通过文件形式来读入,且此类型所需要读入的数据的格式要求很低，只需要满足每一行是用户id，物品id，用户偏好，且之间用tab或者是逗号隔开即可</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        DataModel dataModel = <span class="keyword">new</span> FileDataModel(<span class="keyword">new</span> File(<span class="string">&quot;D:\\data.csv&quot;</span>));</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        计算相似度，相似度算法有很多种，欧几里得、皮尔逊等等。</span></span><br><span class="line"><span class="comment">        基于用户的协同过滤算法，基于物品的协同过滤算法，这里使用了EuclideanDistanceSimilarity</span></span><br><span class="line"><span class="comment">        计算欧式距离，欧式距离来定义相似性，用s=1/(1+d)来表示，范围在[0,1]之间，值越大，表明d越小，距离越近，则表示相似性越大</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        UserSimilarity similarity = <span class="keyword">new</span> EuclideanDistanceSimilarity(dataModel);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        计算最近邻域，邻居有两种算法，基于固定数量的邻居和基于相似度的邻居，这里使用基于固定数量的邻居。</span></span><br><span class="line"><span class="comment">        NEIGHBORHOOD_NUM指定用户邻居数量</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        NearestNUserNeighborhood neighbor = <span class="keyword">new</span> NearestNUserNeighborhood(NEIGHBORHOOD_NUM, similarity, dataModel);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        构建推荐器，协同过滤推荐有两种，分别是基于用户的和基于物品的，这里使用基于用户的协同过滤推荐</span></span><br><span class="line"><span class="comment">        构建基于用户的推荐系统</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        Recommender r = <span class="keyword">new</span> GenericUserBasedRecommender(dataModel, neighbor, similarity);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//得到所有用户的id集合</span></span><br><span class="line">        LongPrimitiveIterator iter = dataModel.getUserIDs();</span><br><span class="line">        <span class="keyword">while</span> (iter.hasNext()) &#123;</span><br><span class="line">            <span class="keyword">long</span> uid = iter.nextLong();</span><br><span class="line">            <span class="comment">//获取推荐结果，获取指定用户指定数量的推荐结果</span></span><br><span class="line">            List&lt;RecommendedItem&gt; list = r.recommend(uid, RECOMMENDER_NUM);</span><br><span class="line">            System.out.printf(<span class="string">&quot;user : %s&quot;</span>, uid);</span><br><span class="line">            <span class="comment">//遍历推荐结果</span></span><br><span class="line">            <span class="keyword">for</span> (RecommendedItem item : list) &#123;</span><br><span class="line">                <span class="comment">//获取推荐结果和推荐度</span></span><br><span class="line">                System.out.print(item.getItemID() + <span class="string">&quot;[&quot;</span> + item.getValue() + <span class="string">&quot;] &quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 基于物品的协同过滤算法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> TasteException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">baseItem</span><span class="params">()</span> <span class="keyword">throws</span> IOException, TasteException </span>&#123;</span><br><span class="line">        DataModel dataModel = <span class="keyword">new</span> FileDataModel(<span class="keyword">new</span> File(<span class="string">&quot;D:\\data.csv&quot;</span>));</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        计算相似度，相似度算法有很多种，欧几里得、皮尔逊等等。</span></span><br><span class="line"><span class="comment">        这里使用的是皮尔逊PearsonCorrelationSimilarity</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        ItemSimilarity itemSimilarity = <span class="keyword">new</span> PearsonCorrelationSimilarity(dataModel);</span><br><span class="line">        <span class="comment">//构建推荐器，协同过滤推荐有两种，分别是基于用户的和基于物品的，这里使用基于物品的协同过滤推荐</span></span><br><span class="line">        GenericItemBasedRecommender recommender = <span class="keyword">new</span> GenericItemBasedRecommender(dataModel, itemSimilarity);</span><br><span class="line">        <span class="comment">//给指定用户推荐若干个与指定商品相似的商品</span></span><br><span class="line">        List&lt;RecommendedItem&gt; recommendedItemList = recommender.recommendedBecause(<span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="comment">//打印推荐的结果</span></span><br><span class="line">        System.out.println(<span class="string">&quot;根据用户1当前浏览的商品5，推荐2个相似的商品&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (RecommendedItem recommendedItem : recommendedItemList) &#123;</span><br><span class="line">            System.out.println(recommendedItem);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="控制台输出"><a href="#控制台输出" class="headerlink" title="控制台输出"></a>控制台输出</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;C:\Program Files\Java\jdk1.8.0_144\bin\java.exe&quot;</span> <span class="string">&quot;-javaagent:C:\Program Files\JetBrains\IntelliJ IDEA 2019.1\lib\idea_rt.jar=61415:C:\Program Files\JetBrains\IntelliJ IDEA 2019.1\bin&quot;</span> -Dfile.encoding=UTF-<span class="number">8</span> -classpath <span class="string">&quot;C:\Program Files\Java\jdk1.8.0_144\jre\lib\charsets.jar;C:\Program Files\Java\jdk1.8.0_144\jre\lib\deploy.jar;C:\Program Files\Java\jdk1.8.0_144\jre\lib\ext\access-bridge-64.jar;C:\Program Files\Java\jdk1.8.0_144\jre\lib\ext\cldrdata.jar;C:\Program Files\Java\jdk1.8.0_144\jre\lib\ext\dnsns.jar;C:\Program Files\Java\jdk1.8.0_144\jre\lib\ext\jaccess.jar;C:\Program Files\Java\jdk1.8.0_144\jre\lib\ext\jfxrt.jar;C:\Program Files\Java\jdk1.8.0_144\jre\lib\ext\localedata.jar;C:\Program Files\Java\jdk1.8.0_144\jre\lib\ext\nashorn.jar;C:\Program Files\Java\jdk1.8.0_144\jre\lib\ext\sunec.jar;C:\Program Files\Java\jdk1.8.0_144\jre\lib\ext\sunjce_provider.jar;C:\Program Files\Java\jdk1.8.0_144\jre\lib\ext\sunmscapi.jar;C:\Program Files\Java\jdk1.8.0_144\jre\lib\ext\sunpkcs11.jar;C:\Program Files\Java\jdk1.8.0_144\jre\lib\ext\zipfs.jar;C:\Program Files\Java\jdk1.8.0_144\jre\lib\javaws.jar;C:\Program Files\Java\jdk1.8.0_144\jre\lib\jce.jar;C:\Program Files\Java\jdk1.8.0_144\jre\lib\jfr.jar;C:\Program Files\Java\jdk1.8.0_144\jre\lib\jfxswt.jar;C:\Program Files\Java\jdk1.8.0_144\jre\lib\jsse.jar;C:\Program Files\Java\jdk1.8.0_144\jre\lib\management-agent.jar;C:\Program Files\Java\jdk1.8.0_144\jre\lib\plugin.jar;C:\Program Files\Java\jdk1.8.0_144\jre\lib\resources.jar;C:\Program Files\Java\jdk1.8.0_144\jre\lib\rt.jar;D:\IdeaProjects\practice\target\classes;C:\Users\Simon\.m2\repository\org\apache\mahout\mahout-core\0.9\mahout-core-0.9.jar;C:\Users\Simon\.m2\repository\org\codehaus\jackson\jackson-core-asl\1.9.12\jackson-core-asl-1.9.12.jar;C:\Users\Simon\.m2\repository\org\codehaus\jackson\jackson-mapper-asl\1.9.12\jackson-mapper-asl-1.9.12.jar;C:\Users\Simon\.m2\repository\org\apache\commons\commons-lang3\3.1\commons-lang3-3.1.jar;C:\Users\Simon\.m2\repository\com\thoughtworks\xstream\xstream\1.4.4\xstream-1.4.4.jar;C:\Users\Simon\.m2\repository\xmlpull\xmlpull\1.1.3.1\xmlpull-1.1.3.1.jar;C:\Users\Simon\.m2\repository\xpp3\xpp3_min\1.1.4c\xpp3_min-1.1.4c.jar;C:\Users\Simon\.m2\repository\org\apache\lucene\lucene-core\4.6.1\lucene-core-4.6.1.jar;C:\Users\Simon\.m2\repository\org\apache\lucene\lucene-analyzers-common\4.6.1\lucene-analyzers-common-4.6.1.jar;C:\Users\Simon\.m2\repository\org\apache\mahout\commons\commons-cli\2.0-mahout\commons-cli-2.0-mahout.jar;C:\Users\Simon\.m2\repository\org\apache\commons\commons-math3\3.2\commons-math3-3.2.jar;C:\Users\Simon\.m2\repository\org\apache\solr\solr-commons-csv\3.5.0\solr-commons-csv-3.5.0.jar;C:\Users\Simon\.m2\repository\org\apache\hadoop\hadoop-core\1.2.1\hadoop-core-1.2.1.jar;C:\Users\Simon\.m2\repository\commons-cli\commons-cli\1.2\commons-cli-1.2.jar;C:\Users\Simon\.m2\repository\com\sun\jersey\jersey-core\1.8\jersey-core-1.8.jar;C:\Users\Simon\.m2\repository\com\sun\jersey\jersey-json\1.8\jersey-json-1.8.jar;C:\Users\Simon\.m2\repository\org\codehaus\jettison\jettison\1.1\jettison-1.1.jar;C:\Users\Simon\.m2\repository\stax\stax-api\1.0.1\stax-api-1.0.1.jar;C:\Users\Simon\.m2\repository\com\sun\xml\bind\jaxb-impl\2.2.3-1\jaxb-impl-2.2.3-1.jar;C:\Users\Simon\.m2\repository\javax\xml\bind\jaxb-api\2.2.2\jaxb-api-2.2.2.jar;C:\Users\Simon\.m2\repository\javax\xml\stream\stax-api\1.0-2\stax-api-1.0-2.jar;C:\Users\Simon\.m2\repository\javax\activation\activation\1.1\activation-1.1.jar;C:\Users\Simon\.m2\repository\org\codehaus\jackson\jackson-jaxrs\1.7.1\jackson-jaxrs-1.7.1.jar;C:\Users\Simon\.m2\repository\org\codehaus\jackson\jackson-xc\1.7.1\jackson-xc-1.7.1.jar;C:\Users\Simon\.m2\repository\com\sun\jersey\jersey-server\1.8\jersey-server-1.8.jar;C:\Users\Simon\.m2\repository\asm\asm\3.1\asm-3.1.jar;C:\Users\Simon\.m2\repository\commons-httpclient\commons-httpclient\3.0.1\commons-httpclient-3.0.1.jar;C:\Users\Simon\.m2\repository\commons-logging\commons-logging\1.0.3\commons-logging-1.0.3.jar;C:\Users\Simon\.m2\repository\commons-codec\commons-codec\1.4\commons-codec-1.4.jar;C:\Users\Simon\.m2\repository\org\apache\commons\commons-math\2.1\commons-math-2.1.jar;C:\Users\Simon\.m2\repository\commons-configuration\commons-configuration\1.6\commons-configuration-1.6.jar;C:\Users\Simon\.m2\repository\commons-collections\commons-collections\3.2.1\commons-collections-3.2.1.jar;C:\Users\Simon\.m2\repository\commons-lang\commons-lang\2.4\commons-lang-2.4.jar;C:\Users\Simon\.m2\repository\commons-digester\commons-digester\1.8\commons-digester-1.8.jar;C:\Users\Simon\.m2\repository\commons-beanutils\commons-beanutils\1.7.0\commons-beanutils-1.7.0.jar;C:\Users\Simon\.m2\repository\commons-beanutils\commons-beanutils-core\1.8.0\commons-beanutils-core-1.8.0.jar;C:\Users\Simon\.m2\repository\commons-net\commons-net\1.4.1\commons-net-1.4.1.jar;C:\Users\Simon\.m2\repository\commons-el\commons-el\1.0\commons-el-1.0.jar;C:\Users\Simon\.m2\repository\org\apache\mahout\mahout-integration\0.9\mahout-integration-0.9.jar;C:\Users\Simon\.m2\repository\commons-io\commons-io\2.4\commons-io-2.4.jar;C:\Users\Simon\.m2\repository\org\apache\mahout\mahout-math\0.9\mahout-math-0.9.jar;C:\Users\Simon\.m2\repository\com\google\guava\guava\16.0\guava-16.0.jar;C:\Users\Simon\.m2\repository\org\apache\mahout\mahout-examples\0.9\mahout-examples-0.9.jar;C:\Users\Simon\.m2\repository\org\apache\lucene\lucene-benchmark\4.6.1\lucene-benchmark-4.6.1.jar;C:\Users\Simon\.m2\repository\org\apache\lucene\lucene-highlighter\4.6.1\lucene-highlighter-4.6.1.jar;C:\Users\Simon\.m2\repository\org\apache\lucene\lucene-queries\4.6.1\lucene-queries-4.6.1.jar;C:\Users\Simon\.m2\repository\org\apache\lucene\lucene-memory\4.6.1\lucene-memory-4.6.1.jar;C:\Users\Simon\.m2\repository\org\apache\lucene\lucene-queryparser\4.6.1\lucene-queryparser-4.6.1.jar;C:\Users\Simon\.m2\repository\org\apache\lucene\lucene-sandbox\4.6.1\lucene-sandbox-4.6.1.jar;C:\Users\Simon\.m2\repository\jakarta-regexp\jakarta-regexp\1.4\jakarta-regexp-1.4.jar;C:\Users\Simon\.m2\repository\org\apache\lucene\lucene-facet\4.6.1\lucene-facet-4.6.1.jar;C:\Users\Simon\.m2\repository\org\apache\lucene\lucene-spatial\4.6.1\lucene-spatial-4.6.1.jar;C:\Users\Simon\.m2\repository\com\spatial4j\spatial4j\0.3\spatial4j-0.3.jar;C:\Users\Simon\.m2\repository\com\ibm\icu\icu4j\49.1\icu4j-49.1.jar;C:\Users\Simon\.m2\repository\net\sourceforge\nekohtml\nekohtml\1.9.17\nekohtml-1.9.17.jar;C:\Users\Simon\.m2\repository\org\apache\commons\commons-compress\1.4.1\commons-compress-1.4.1.jar;C:\Users\Simon\.m2\repository\xerces\xercesImpl\2.9.1\xercesImpl-2.9.1.jar;C:\Users\Simon\.m2\repository\org\slf4j\slf4j-log4j12\1.7.25\slf4j-log4j12-1.7.25.jar;C:\Users\Simon\.m2\repository\log4j\log4j\1.2.17\log4j-1.2.17.jar;C:\Users\Simon\.m2\repository\org\slf4j\slf4j-api\1.7.25\slf4j-api-1.7.25.jar&quot;</span> com.aliatry.mahout.App</span><br><span class="line"><span class="number">19</span>/<span class="number">05</span>/<span class="number">13</span> <span class="number">17</span>:<span class="number">36</span>:<span class="number">19</span> INFO file.FileDataModel: Creating FileDataModel <span class="keyword">for</span> file D:\data.csv</span><br><span class="line"><span class="number">19</span>/<span class="number">05</span>/<span class="number">13</span> <span class="number">17</span>:<span class="number">36</span>:<span class="number">19</span> INFO file.FileDataModel: Reading file info...</span><br><span class="line"><span class="number">19</span>/<span class="number">05</span>/<span class="number">13</span> <span class="number">17</span>:<span class="number">36</span>:<span class="number">19</span> INFO file.FileDataModel: Read lines: <span class="number">24</span></span><br><span class="line"><span class="number">19</span>/<span class="number">05</span>/<span class="number">13</span> <span class="number">17</span>:<span class="number">36</span>:<span class="number">19</span> INFO model.GenericDataModel: Processed <span class="number">5</span> users</span><br><span class="line">user : <span class="number">0</span></span><br><span class="line">user : <span class="number">16</span>[<span class="number">3.6425023</span>] <span class="number">0</span>[<span class="number">3.1900032</span>] <span class="number">3</span>[<span class="number">2.3574977</span>]</span><br><span class="line">user : <span class="number">21</span>[<span class="number">1.0</span>]</span><br><span class="line">user : <span class="number">35</span>[<span class="number">5.0</span>] <span class="number">6</span>[<span class="number">3.457395</span>]</span><br><span class="line">user : <span class="number">42</span>[<span class="number">4.0</span>] <span class="number">4</span>[<span class="number">3.145341</span>]</span><br><span class="line"><span class="number">19</span>/<span class="number">05</span>/<span class="number">13</span> <span class="number">17</span>:<span class="number">36</span>:<span class="number">19</span> INFO file.FileDataModel: Creating FileDataModel <span class="keyword">for</span> file D:\data.csv</span><br><span class="line"><span class="number">19</span>/<span class="number">05</span>/<span class="number">13</span> <span class="number">17</span>:<span class="number">36</span>:<span class="number">19</span> INFO file.FileDataModel: Reading file info...</span><br><span class="line"><span class="number">19</span>/<span class="number">05</span>/<span class="number">13</span> <span class="number">17</span>:<span class="number">36</span>:<span class="number">19</span> INFO file.FileDataModel: Read lines: <span class="number">24</span></span><br><span class="line"><span class="number">19</span>/<span class="number">05</span>/<span class="number">13</span> <span class="number">17</span>:<span class="number">36</span>:<span class="number">19</span> INFO model.GenericDataModel: Processed <span class="number">5</span> users</span><br><span class="line">根据用户<span class="number">1</span>当前浏览的商品<span class="number">5</span>，推荐<span class="number">2</span>个相似的商品</span><br><span class="line">RecommendedItem[item:<span class="number">2</span>, value:<span class="number">2.0</span>]</span><br><span class="line">RecommendedItem[item:<span class="number">1</span>, value:<span class="number">0.0</span>]</span><br><span class="line"><span class="number">19</span>/<span class="number">05</span>/<span class="number">13</span> <span class="number">17</span>:<span class="number">36</span>:<span class="number">19</span> INFO file.FileDataModel: Creating FileDataModel <span class="keyword">for</span> file D:\data.csv</span><br><span class="line"><span class="number">19</span>/<span class="number">05</span>/<span class="number">13</span> <span class="number">17</span>:<span class="number">36</span>:<span class="number">19</span> INFO file.FileDataModel: Reading file info...</span><br><span class="line"><span class="number">19</span>/<span class="number">05</span>/<span class="number">13</span> <span class="number">17</span>:<span class="number">36</span>:<span class="number">19</span> INFO file.FileDataModel: Read lines: <span class="number">24</span></span><br><span class="line"><span class="number">19</span>/<span class="number">05</span>/<span class="number">13</span> <span class="number">17</span>:<span class="number">36</span>:<span class="number">19</span> INFO model.GenericDataModel: Processed <span class="number">5</span> users</span><br><span class="line">RecommendedItem[item:<span class="number">3</span>, value:<span class="number">3.5</span>]</span><br><span class="line">RecommendedItem[item:<span class="number">4</span>, value:<span class="number">3.0</span>]</span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure><h2 id="项目GitHub地址"><a href="#项目GitHub地址" class="headerlink" title="项目GitHub地址"></a><a href="https://github.com/admin-SIMON/mahout">项目GitHub地址</a></h2>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Mahout&quot;&gt;&lt;a href=&quot;#Mahout&quot; class=&quot;headerlink&quot; title=&quot;Mahout&quot;&gt;&lt;/a&gt;Mahout&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;https://mahout.apache.org/assets/mahout-logo-blue.svg&quot; alt=&quot;Alt text&quot;&gt;&lt;/p&gt;
&lt;p&gt;Mahout 是 Apache Software Foundation（ASF） 旗下的一个开源项目，提供一些可扩展的机器学习领域经典算法的实现，旨在帮助开发人员更加方便快捷地创建智能应用程序。Mahout包含许多实现，包括聚类、分类、推荐过滤、频繁子项挖掘。此外，通过使用 Apache Hadoop 库，Mahout 可以有效地扩展到云中。&lt;/p&gt;</summary>
    
    
    
    <category term="Mahout" scheme="https://aliatry.com/categories/Mahout/"/>
    
    
    <category term="机器学习" scheme="https://aliatry.com/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="Mahout" scheme="https://aliatry.com/tags/Mahout/"/>
    
    <category term="Hadoop" scheme="https://aliatry.com/tags/Hadoop/"/>
    
  </entry>
  
  <entry>
    <title>源码安装RocketMQ4.X可视化控制台</title>
    <link href="https://aliatry.com/2019/05/06/%E6%BA%90%E7%A0%81%E5%AE%89%E8%A3%85RocketMQ4-X%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8E%A7%E5%88%B6%E5%8F%B0/"/>
    <id>https://aliatry.com/2019/05/06/%E6%BA%90%E7%A0%81%E5%AE%89%E8%A3%85RocketMQ4-X%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8E%A7%E5%88%B6%E5%8F%B0/</id>
    <published>2019-05-06T08:47:04.000Z</published>
    <updated>2019-10-12T06:13:40.641Z</updated>
    
    <content type="html"><![CDATA[<h2 id="RocketMQ可视化控制台中文文档"><a href="#RocketMQ可视化控制台中文文档" class="headerlink" title="RocketMQ可视化控制台中文文档"></a><a href="https://github.com/apache/rocketmq-externals/blob/master/rocketmq-console/doc/1_0_0/UserGuide_CN.md">RocketMQ可视化控制台中文文档</a></h2><h2 id="下载源码"><a href="#下载源码" class="headerlink" title="下载源码"></a>下载源码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;github.com&#x2F;apache&#x2F;rocketmq-externals&#x2F;archive&#x2F;master.zip</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">unzip master.zip</span><br><span class="line">cd rocketmq-externals-master&#x2F;rocketmq-console&#x2F;</span><br></pre></td></tr></table></figure><h2 id="编译打包"><a href="#编译打包" class="headerlink" title="编译打包"></a>编译打包</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean package -Dmaven.test.skip&#x3D;true</span><br></pre></td></tr></table></figure><h2 id="target目录-通过java-jar的方式运行-启动后是8080端口"><a href="#target目录-通过java-jar的方式运行-启动后是8080端口" class="headerlink" title="target目录 通过java -jar的方式运行 启动后是8080端口"></a>target目录 通过java -jar的方式运行 启动后是8080端口</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup java -jar .&#x2F;target&#x2F;rocketmq-console-ng-1.0.1.jar &amp;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;RocketMQ可视化控制台中文文档&quot;&gt;&lt;a href=&quot;#RocketMQ可视化控制台中文文档&quot; class=&quot;headerlink&quot; title=&quot;RocketMQ可视化控制台中文文档&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://github.com/apache/rocketmq-externals/blob/master/rocketmq-console/doc/1_0_0/UserGuide_CN.md&quot;&gt;RocketMQ可视化控制台中文文档&lt;/a&gt;&lt;/h2&gt;&lt;h2 id=&quot;下载源码&quot;&gt;&lt;a href=&quot;#下载源码&quot; class=&quot;headerlink&quot; title=&quot;下载源码&quot;&gt;&lt;/a&gt;下载源码&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;wget https:&amp;#x2F;&amp;#x2F;github.com&amp;#x2F;apache&amp;#x2F;rocketmq-externals&amp;#x2F;archive&amp;#x2F;master.zip&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="RocketMQ" scheme="https://aliatry.com/categories/RocketMQ/"/>
    
    <category term="可视化控制台" scheme="https://aliatry.com/categories/RocketMQ/%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8E%A7%E5%88%B6%E5%8F%B0/"/>
    
    
    <category term="RocketMQ" scheme="https://aliatry.com/tags/RocketMQ/"/>
    
    <category term="可视化控制台" scheme="https://aliatry.com/tags/%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8E%A7%E5%88%B6%E5%8F%B0/"/>
    
  </entry>
  
  <entry>
    <title>Java标签使用</title>
    <link href="https://aliatry.com/2019/05/06/Java%E6%A0%87%E7%AD%BE%E4%BD%BF%E7%94%A8/"/>
    <id>https://aliatry.com/2019/05/06/Java%E6%A0%87%E7%AD%BE%E4%BD%BF%E7%94%A8/</id>
    <published>2019-05-06T06:42:55.000Z</published>
    <updated>2019-05-06T06:49:28.277Z</updated>
    
    <content type="html"><![CDATA[<p>Java 中的标签是为循环设计的，是为了在多重循环中方便的使用break 和coutinue 。</p><p>以下实例当在循环中使用 break 或 continue 循环时跳到指定的标签处</p><a id="more"></a><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String strSearch = <span class="string">&quot;This is the string in which you have to search for a substring.&quot;</span>;</span><br><span class="line">        String substring = <span class="string">&quot;substring&quot;</span>;</span><br><span class="line">        <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">int</span> max = strSearch.length() - substring.length();</span><br><span class="line">        testlbl:</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= max; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> length = substring.length();</span><br><span class="line">            <span class="keyword">int</span> j = i;</span><br><span class="line">            <span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> (length-- != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span>(strSearch.charAt(j++) != substring.charAt(k++))&#123;</span><br><span class="line">                    <span class="keyword">continue</span> testlbl;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            found = <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">break</span> testlbl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (found) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;发现子字符串。&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;字符串中没有发现子字符串。&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上代码运行输出结果为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">发现子字符串。</span><br></pre></td></tr></table></figure><p>break + 标签, 跳出循环, 并到标签处, 下次不再进入循环</p><p>continue + 标签, 跳出循环, 从标签处继续执行, 可继续进入循环条件</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;Java 中的标签是为循环设计的，是为了在多重循环中方便的使用break 和coutinue 。&lt;/p&gt;
&lt;p&gt;以下实例当在循环中使用 break 或 continue 循环时跳到指定的标签处&lt;/p&gt;</summary>
    
    
    
    <category term="java" scheme="https://aliatry.com/categories/java/"/>
    
    <category term="标签" scheme="https://aliatry.com/categories/java/%E6%A0%87%E7%AD%BE/"/>
    
    
    <category term="java" scheme="https://aliatry.com/tags/java/"/>
    
    <category term="标签" scheme="https://aliatry.com/tags/%E6%A0%87%E7%AD%BE/"/>
    
  </entry>
  
  <entry>
    <title>centOS安装maven</title>
    <link href="https://aliatry.com/2019/05/05/centOS%E5%AE%89%E8%A3%85maven/"/>
    <id>https://aliatry.com/2019/05/05/centOS%E5%AE%89%E8%A3%85maven/</id>
    <published>2019-05-05T06:35:44.000Z</published>
    <updated>2019-10-12T06:00:34.343Z</updated>
    
    <content type="html"><![CDATA[<h2 id="centOS安装maven"><a href="#centOS安装maven" class="headerlink" title="centOS安装maven"></a>centOS安装maven</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;archive.apache.org&#x2F;dist&#x2F;maven&#x2F;maven-3&#x2F;3.3.9&#x2F;binaries&#x2F;apache-maven-3.3.9-bin.tar.gz</span><br><span class="line">tar zxf apache-maven-3.3.9-bin.tar.gz</span><br><span class="line">vim &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="前提安装jdk8"><a href="#前提安装jdk8" class="headerlink" title="前提安装jdk8"></a>前提安装jdk8</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;software&#x2F;jdk8</span><br><span class="line">export MAVEN_HOME&#x3D;&#x2F;usr&#x2F;local&#x2F;software&#x2F;apache-maven-3.3.9</span><br><span class="line">export JAVA_BIN&#x3D;&#x2F;usr&#x2F;local&#x2F;software&#x2F;jdk8</span><br><span class="line">export PATH&#x3D;$PATH:$JAVA_HOME&#x2F;bin:$MAVEN_HOME&#x2F;bin</span><br><span class="line">export CLASSPATH&#x3D;.:$JAVA_HOME&#x2F;lib&#x2F;dt.jar:$JAVA_HOME&#x2F;lib&#x2F;tools.jar</span><br><span class="line">export JAVA_HOME MAVEN_HOME JAVA_BIN PATH CLASSPATH</span><br></pre></td></tr></table></figure><h3 id="环境变量立即生效"><a href="#环境变量立即生效" class="headerlink" title="环境变量立即生效"></a>环境变量立即生效</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure><h2 id="查看版本号"><a href="#查看版本号" class="headerlink" title="查看版本号"></a>查看版本号</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mvn -v</span><br><span class="line">Apache Maven 3.3.9 (bb52d8502b132ec0a5a3f4c09453c07478323dc5; 2015-11-11T00:41:47+08:00)</span><br><span class="line">Maven home: &#x2F;usr&#x2F;local&#x2F;software&#x2F;apache-maven-3.3.9</span><br><span class="line">Java version: 1.8.0_141, vendor: Oracle Corporation</span><br><span class="line">Java home: &#x2F;usr&#x2F;local&#x2F;software&#x2F;jdk8&#x2F;jre</span><br><span class="line">Default locale: en_US, platform encoding: UTF-8</span><br><span class="line">OS name: &quot;linux&quot;, version: &quot;3.10.0-862.14.4.el7.x86_64&quot;, arch: &quot;amd64&quot;, family: &quot;unix&quot;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;centOS安装maven&quot;&gt;&lt;a href=&quot;#centOS安装maven&quot; class=&quot;headerlink&quot; title=&quot;centOS安装maven&quot;&gt;&lt;/a&gt;centOS安装maven&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;wget https:&amp;#x2F;&amp;#x2F;archive.apache.org&amp;#x2F;dist&amp;#x2F;maven&amp;#x2F;maven-3&amp;#x2F;3.3.9&amp;#x2F;binaries&amp;#x2F;apache-maven-3.3.9-bin.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tar zxf apache-maven-3.3.9-bin.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;vim &amp;#x2F;etc&amp;#x2F;profile&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="linux" scheme="https://aliatry.com/categories/linux/"/>
    
    <category term="maven" scheme="https://aliatry.com/categories/linux/maven/"/>
    
    
    <category term="linux" scheme="https://aliatry.com/tags/linux/"/>
    
    <category term="wget" scheme="https://aliatry.com/tags/wget/"/>
    
    <category term="maven" scheme="https://aliatry.com/tags/maven/"/>
    
    <category term="centOS" scheme="https://aliatry.com/tags/centOS/"/>
    
  </entry>
  
  <entry>
    <title>RocketMQ4.x本地源码部署</title>
    <link href="https://aliatry.com/2019/05/05/RocketMQ4-x%E6%9C%AC%E5%9C%B0%E6%BA%90%E7%A0%81%E9%83%A8%E7%BD%B2/"/>
    <id>https://aliatry.com/2019/05/05/RocketMQ4-x%E6%9C%AC%E5%9C%B0%E6%BA%90%E7%A0%81%E9%83%A8%E7%BD%B2/</id>
    <published>2019-05-05T02:27:53.000Z</published>
    <updated>2019-05-06T07:07:53.968Z</updated>
    
    <content type="html"><![CDATA[<h2 id="安装前提条件-推荐"><a href="#安装前提条件-推荐" class="headerlink" title="安装前提条件(推荐)"></a>安装前提条件(推荐)</h2><p>64bit OS/Linux/Unix/Mac/(Windows不兼容)</p><p>64bit JDK 1.8+</p><h2 id="快速开始"><a href="#快速开始" class="headerlink" title="快速开始"></a><a href="http://rocketmq.apache.org/docs/quick-start/">快速开始</a></h2><p>本快速入门指南是在本地计算机上设置RocketMQ消息传递系统以发送和接收消息的详细说明。</p><h2 id="下载安装包"><a href="#下载安装包" class="headerlink" title="下载安装包"></a>下载安装包</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;mirror.bit.edu.cn&#x2F;apache&#x2F;rocketmq&#x2F;4.4.0&#x2F;rocketmq-all-4.4.0-source-release.zip</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="解压并编译"><a href="#解压并编译" class="headerlink" title="解压并编译"></a>解压并编译</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">unzip rocketmq-all-4.4.0-source-release.zip</span><br><span class="line">cd rocketmq-all-4.4.0&#x2F;</span><br><span class="line">mvn -Prelease-all -DskipTests clean install -U</span><br><span class="line">cd distribution&#x2F;target&#x2F;apache-rocketmq</span><br></pre></td></tr></table></figure><p>最终路径 <code>distribution/target/apache-rocketmq</code></p><h2 id="启动nameServer"><a href="#启动nameServer" class="headerlink" title="启动nameServer"></a>启动nameServer</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup sh bin&#x2F;mqnamesrv &amp;</span><br></pre></td></tr></table></figure><h2 id="查看日志"><a href="#查看日志" class="headerlink" title="查看日志"></a>查看日志</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -f nohup.out</span><br></pre></td></tr></table></figure><p>结尾为 <code>The Name Server boot success. serializeType=JSON</code> 说明启动成功</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Java <span class="title">HotSpot</span><span class="params">(TM)</span> 64-Bit Server VM warning: Using the DefNew young collector with the CMS collector is deprecated and will likely be removed in a future release</span></span><br><span class="line"><span class="function">Java <span class="title">HotSpot</span><span class="params">(TM)</span> 64-Bit Server VM warning: UseCMSCompactAtFullCollection is deprecated and will likely be removed in a future release.</span></span><br><span class="line"><span class="function">The Name Server boot success. serializeType</span>=JSON</span><br></pre></td></tr></table></figure><h1 id="部署问题"><a href="#部署问题" class="headerlink" title="部署问题"></a>部署问题</h1><h2 id="Please-set-the-JAVA-HOME-variable-in-your-environment-We-need-java-x64"><a href="#Please-set-the-JAVA-HOME-variable-in-your-environment-We-need-java-x64" class="headerlink" title="Please set the JAVA_HOME variable in your environment, We need java(x64)"></a>Please set the JAVA_HOME variable in your environment, We need java(x64)</h2><p>解决: 本地需要配置 <code>JAVA_HOME</code> 环境变量</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo $JAVA_HOME</span><br><span class="line">/usr/local/software/jdk8</span><br></pre></td></tr></table></figure><p>Linux系统jdk配置见 <code>linux下使用wget下载jdk8</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/local/software/jdk8</span><br><span class="line">export MAVEN_HOME=/usr/local/software/apache-maven-<span class="number">3.3</span><span class="number">.9</span></span><br><span class="line">export JAVA_BIN=/usr/local/software/jdk8</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin:$MAVEN_HOME/bin</span><br><span class="line">export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line">export JAVA_HOME MAVEN_HOME JAVA_BIN PATH CLASSPATH</span><br></pre></td></tr></table></figure><h2 id="启动broker"><a href="#启动broker" class="headerlink" title="启动broker"></a>启动broker</h2><p><code>-n</code> 指定 <code>nameserver</code> 地址, <code>nameserver</code>服务端口号为 <code>9876</code>, <code>broker</code> 默认端口号 <code>10911</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup sh bin/mqbroker -n localhost:<span class="number">9876</span> &amp;</span><br></pre></td></tr></table></figure><h2 id="RocketMQ的broker启动失败解决"><a href="#RocketMQ的broker启动失败解决" class="headerlink" title="RocketMQ的broker启动失败解决"></a>RocketMQ的broker启动失败解决</h2><p>进入 <code>bin</code> 目录 <code>apache-rocketmq/bin</code></p><h3 id="修改runbroker-sh"><a href="#修改runbroker-sh" class="headerlink" title="修改runbroker.sh"></a>修改runbroker.sh</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim runbroker.sh</span><br></pre></td></tr></table></figure><p>将第一个JAVA_OPT改成</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JAVA_OPT=<span class="string">&quot;$&#123;JAVA_OPT&#125; -server -Xms256m -Xmx256m -Xmn128m&quot;</span></span><br></pre></td></tr></table></figure><h3 id="修改runserver-sh"><a href="#修改runserver-sh" class="headerlink" title="修改runserver.sh"></a>修改runserver.sh</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim runserver.sh</span><br></pre></td></tr></table></figure><p>将第一个JAVA_OPT改成</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JAVA_OPT=<span class="string">&quot;$&#123;JAVA_OPT&#125; -server -Xms128m -Xmx256m -Xmn256m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m&quot;</span></span><br></pre></td></tr></table></figure><h2 id="关闭-broker-nameserver-执行的命令"><a href="#关闭-broker-nameserver-执行的命令" class="headerlink" title="关闭 broker nameserver 执行的命令"></a>关闭 broker nameserver 执行的命令</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sh bin/mqshutdown broker</span><br><span class="line">sh bin/mqshutdown namesrv</span><br></pre></td></tr></table></figure><h2 id="使用jps查看进程"><a href="#使用jps查看进程" class="headerlink" title="使用jps查看进程"></a>使用jps查看进程</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jps</span><br></pre></td></tr></table></figure><h2 id="验证是否成功"><a href="#验证是否成功" class="headerlink" title="验证是否成功"></a>验证是否成功</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 设置名称服务地址</span><br><span class="line">export NAMESRV_ADDR&#x3D;localhost:9876</span><br><span class="line"></span><br><span class="line"># 投递消息</span><br><span class="line">sh bin&#x2F;tools.sh org.apache.rocketmq.example.quickstart.Producer</span><br><span class="line"></span><br><span class="line"># 消费消息</span><br><span class="line">sh bin&#x2F;tools.sh org.apache.rocketmq.example.quickstart.Consumer</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;安装前提条件-推荐&quot;&gt;&lt;a href=&quot;#安装前提条件-推荐&quot; class=&quot;headerlink&quot; title=&quot;安装前提条件(推荐)&quot;&gt;&lt;/a&gt;安装前提条件(推荐)&lt;/h2&gt;&lt;p&gt;64bit OS/Linux/Unix/Mac/(Windows不兼容)&lt;/p&gt;
&lt;p&gt;64bit JDK 1.8+&lt;/p&gt;
&lt;h2 id=&quot;快速开始&quot;&gt;&lt;a href=&quot;#快速开始&quot; class=&quot;headerlink&quot; title=&quot;快速开始&quot;&gt;&lt;/a&gt;&lt;a href=&quot;http://rocketmq.apache.org/docs/quick-start/&quot;&gt;快速开始&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;本快速入门指南是在本地计算机上设置RocketMQ消息传递系统以发送和接收消息的详细说明。&lt;/p&gt;
&lt;h2 id=&quot;下载安装包&quot;&gt;&lt;a href=&quot;#下载安装包&quot; class=&quot;headerlink&quot; title=&quot;下载安装包&quot;&gt;&lt;/a&gt;下载安装包&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;wget http:&amp;#x2F;&amp;#x2F;mirror.bit.edu.cn&amp;#x2F;apache&amp;#x2F;rocketmq&amp;#x2F;4.4.0&amp;#x2F;rocketmq-all-4.4.0-source-release.zip&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="消息队列" scheme="https://aliatry.com/categories/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
    
    <category term="RocketMQ" scheme="https://aliatry.com/categories/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RocketMQ/"/>
    
    
    <category term="wget" scheme="https://aliatry.com/tags/wget/"/>
    
    <category term="RocketMQ" scheme="https://aliatry.com/tags/RocketMQ/"/>
    
    <category term="消息队列" scheme="https://aliatry.com/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
    
  </entry>
  
  <entry>
    <title>Scheduled 定时任务</title>
    <link href="https://aliatry.com/2019/03/27/Scheduled-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/"/>
    <id>https://aliatry.com/2019/03/27/Scheduled-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/</id>
    <published>2019-03-27T06:40:14.000Z</published>
    <updated>2019-10-12T06:07:32.003Z</updated>
    
    <content type="html"><![CDATA[<h2 id="启动类-添加-EnableScheduling-注解"><a href="#启动类-添加-EnableScheduling-注解" class="headerlink" title="启动类 添加 EnableScheduling 注解"></a>启动类 添加 EnableScheduling 注解</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableScheduling</span>   <span class="comment">// 定时任务</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(ScheduApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="服务层-添加-Component-和-Scheduled-注解"><a href="#服务层-添加-Component-和-Scheduled-注解" class="headerlink" title="服务层 添加 Component 和 Scheduled 注解"></a>服务层 添加 Component 和 Scheduled 注解</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduledServiceImpl</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0 0/25 2 * * ? *&quot;)</span> <span class="comment">// 凌晨2:00-2:59开始,每二十五分钟执行一次</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printSay</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;This is a say method!&quot;</span> + <span class="keyword">new</span> Date());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="在线Cron表达式生成器-1"><a href="#在线Cron表达式生成器-1" class="headerlink" title="[在线Cron表达式生成器] 1"></a>[在线Cron表达式生成器] <a href="http://cron.qqe2.com/">1</a></h2><h2 id="规则"><a href="#规则" class="headerlink" title="规则"></a>规则</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">字段　　允许值　　允许的特殊字符 </span><br><span class="line">秒     　 0-59 　　　　, - * &#x2F; </span><br><span class="line">分     　 0-59　　　　 , - * &#x2F; </span><br><span class="line">小时      0-23 　　　　, - * &#x2F; </span><br><span class="line">日期      1-31 　　　　, - * ? &#x2F; L W C </span><br><span class="line">月份      1-12 　　　　, - * &#x2F; </span><br><span class="line">星期      1-7 　　　　  , - * ? &#x2F; L C # </span><br><span class="line">年     1970-2099 　　, - * &#x2F;</span><br></pre></td></tr></table></figure><p>星期(1-7)可对应(SUN，MON，TUE，WED，THU，FRI，SAT)</p><h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><p><code>0/5 * * * * ?</code> 每5秒执行一次</p><p><code>*</code>字符被用来指定所有的值。如：<code>*</code>在分钟的字段域里表示<code>每分钟</code>。 <br><code>?</code>字符只在日期域和星期域中使用。它被用来指定<code>非明确的值</code>。当你需要通过在这两个域中的一个来指定一些东西的时候，它是有用的。看下面的例子你就会明白。 <br>月份中的日期和星期中的日期这两个元素时互斥的一起应该通过设置一个问号来表明不想设置那个字段。</p><p><code>-</code>字符被用来指定一个范围。如：<code>10-12</code>在小时域意味着<code>10点、11点、12点</code>。</p><p><code>,</code>字符被用来指定另外的值。如：<code>MON,WED,FRI</code>在星期域里表示<code>星期一、星期三、星期五</code>。</p><p><code>/</code>字符用于指定增量。如：<code>0/15</code>在秒域意思是每分钟的0，15，30和45秒。<code>5/15</code>在分钟域表示每小时的5，20，35和50。 符号<code>*</code>在<code>/</code>前面（如：<code>*/10</code>）等价于0在<code>/</code>前面（如：0/10）。记住一条本质：表达式的每个数值域都是一个有最大值和最小值的集合，如： 秒域和分钟域的集合是0-59，日期域是1-31，月份域是1-12。字符<code>/</code>可以帮助你在每个字符域中取相应的数值。如：<code>7/6</code>在月份域的时候只 有当7月的时候才会触发，并不是表示每个6月。</p><p>L是‘last’的省略写法可以表示day-of-month和day-of-week域，但在两个字段中的意思不同，例如day-of- month域中表示一个月的最后一天。如果在day-of-week域表示‘7’或者‘SAT’，如果在day-of-week域中前面加上数字，它表示 一个月的最后几天，例如‘6L’就表示一个月的最后一个星期五。</p><p>字符<code>W</code>只允许日期域出现。这个字符用于指定日期的最近工作日。例如：如果你在日期域中写 <code>15W</code>，表示：这个月15号最近的工作日。所以，如果15号是周六，则任务会在14号触发。如果15好是周日，则任务会在周一也就是16号触发。如果 是在日期域填写<code>1W</code>即使1号是周六，那么任务也只会在下周一，也就是3号触发，<code>W</code>字符指定的最近工作日是不能够跨月份的。字符<code>W</code>只能配合一个 单独的数值使用，不能够是一个数字段，如：1-15W是错误的。</p><p><code>L</code>和<code>W</code>可以在日期域中联合使用，LW表示这个月最后一周的工作日。</p><p>字符<code>#</code>只允许在星期域中出现。这个字符用于指定本月的某某天。例如：<code>6#3</code>表示本月第三周的星期五（6表示星期五，3表示第三周）。<code>2#1</code>表示本月第一周的星期一。<code>4#5</code>表示第五周的星期三。</p><p>字符<code>C</code>允许在日期域和星期域出现。这个字符依靠一个指定的<code>日历</code>。也就是说这个表达式的值依赖于相关的<code>日历</code>的计算结果，如果没有<code>日历</code> 关联，则等价于所有包含的<code>日历</code>。如：日期域是<code>5C</code>表示关联<code>日历</code>中第一天，或者这个月开始的第一天的后5天。星期域是<code>1C</code>表示关联<code>日历</code> 中第一天，或者星期的第一天的后1天，也就是周日的后一天（周一）。</p><h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><p><code>0 0 10,14,16 * * ?</code> 每天上午10点，下午2点，4点<br><code>0 0/30 9-17 * * ?</code>   朝九晚五工作时间内每半小时<br><code>0 0 12 ? * WED</code> 表示每个星期三中午12点 <br><code>0 0 12 * * ?</code> 每天中午12点触发 <br><code>0 15 10 ? * *</code> 每天上午10:15触发 <br><code>0 15 10 * * ?</code> 每天上午10:15触发 <br><code>0 15 10 * * ? *</code> 每天上午10:15触发 <br><code>0 15 10 * * ? 2005</code> 2005年的每天上午10:15触发 <br><code>0 * 14 * * ?</code> 在每天下午2点到下午2:59期间的每1分钟触发 <br><code>0 0/5 14 * * ?</code> 在每天下午2点到下午2:55期间的每5分钟触发 <br><code>0 0/5 14,18 * * ?</code> 在每天下午2点到2:55期间和下午6点到6:55期间的每5分钟触发 <br><code>0 0-5 14 * * ?</code> 在每天下午2点到下午2:05期间的每1分钟触发 <br><code>0 10,44 14 ? 3 WED</code> 每年三月的星期三的下午2:10和2:44触发 <br><code>0 15 10 ? * MON-FRI</code> 周一至周五的上午10:15触发 <br><code>0 15 10 15 * ?</code> 每月15日上午10:15触发 <br><code>0 15 10 L * ?</code> 每月最后一日的上午10:15触发 <br><code>0 15 10 ? * 6L</code> 每月的最后一个星期五上午10:15触发 <br><code>0 15 10 ? * 6L 2002-2005</code> 2002年至2005年的每月的最后一个星期五上午10:15触发 <br><code>0 15 10 ? * 6#3</code> 每月的第三个星期五上午10:15触发</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;启动类-添加-EnableScheduling-注解&quot;&gt;&lt;a href=&quot;#启动类-添加-EnableScheduling-注解&quot; class=&quot;headerlink&quot; title=&quot;启动类 添加 EnableScheduling 注解&quot;&gt;&lt;/a&gt;启动类 添加 EnableScheduling 注解&lt;/h2&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@SpringBootApplication&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@EnableScheduling&lt;/span&gt;   &lt;span class=&quot;comment&quot;&gt;// 定时任务&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ScheduApplication&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String[] args)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        SpringApplication.run(ScheduApplication.class, args);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="Scheduled" scheme="https://aliatry.com/categories/Scheduled/"/>
    
    
    <category term="Scheduled" scheme="https://aliatry.com/tags/Scheduled/"/>
    
    <category term="定时任务" scheme="https://aliatry.com/tags/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>SSR搭建梯子(VPS)教程</title>
    <link href="https://aliatry.com/2019/03/19/SSR%E6%90%AD%E5%BB%BA%E6%A2%AF%E5%AD%90-VPS-%E6%95%99%E7%A8%8B/"/>
    <id>https://aliatry.com/2019/03/19/SSR%E6%90%AD%E5%BB%BA%E6%A2%AF%E5%AD%90-VPS-%E6%95%99%E7%A8%8B/</id>
    <published>2019-03-19T06:04:46.000Z</published>
    <updated>2019-10-12T06:12:06.544Z</updated>
    
    <content type="html"><![CDATA[<h2 id="VPS用途"><a href="#VPS用途" class="headerlink" title="VPS用途"></a>VPS用途</h2><p>VPS虚拟服务器技术可以通过多种不同的方式灵活地分配服务器资源，每个虚拟化服务器的资源都可以有很大的不同，可以灵活的满足各种高端用户的需求。通过在一台服务器上创建10个左右的VPS主机，可以确保每一个虚拟主机的用户独享VPS资源，其运行和管理完全和独立主机相同。VPS主机可以为高端用户提供安全、可靠、高品质的主机服务。</p><a id="more"></a><h2 id="创建服务器-Vultr"><a href="#创建服务器-Vultr" class="headerlink" title="创建服务器 Vultr"></a>创建服务器 <a href="https://www.vultr.com/">Vultr</a></h2><p>登录官网自行注册,并选择支付宝充值10美金,不想充钱的可以绕道了,不用往下看了</p><h3 id="点击Server栏目"><a href="#点击Server栏目" class="headerlink" title="点击Server栏目"></a>点击Server栏目</h3><p>找到里面的 <code>+</code> 按钮 <code>Deploy New Server</code> 新增服务器 会跳转到</p><h4 id="部署新实例"><a href="#部署新实例" class="headerlink" title="部署新实例"></a><a href="https://my.vultr.com/deploy/">部署新实例</a></h4><h3 id="Server-Location"><a href="#Server-Location" class="headerlink" title="Server Location"></a>Server Location</h3><p>选择自己服务器地区</p><h3 id="Server-Type"><a href="#Server-Type" class="headerlink" title="Server Type"></a>Server Type</h3><p>服务器类型选择: CentOS 7x64</p><h3 id="Server-Size"><a href="#Server-Size" class="headerlink" title="Server Size"></a>Server Size</h3><p>这个不多说,有钱土豪的随便选,没钱的最左边最便宜的</p><h3 id="Deploy-New"><a href="#Deploy-New" class="headerlink" title="Deploy New"></a>Deploy New</h3><p>其他的都不用管,直接点击最下面的<code>Deploy New</code></p><h2 id="进入服务器"><a href="#进入服务器" class="headerlink" title="进入服务器"></a>进入服务器</h2><p>自己想办法进去Linux系统服务器,百度一堆</p><h3 id="执行安装SSR指令"><a href="#执行安装SSR指令" class="headerlink" title="执行安装SSR指令"></a>执行安装SSR指令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget --no-check-certificate https:&#x2F;&#x2F;freed.ga&#x2F;github&#x2F;shadowsocksR.sh; bash shadowsocksR.sh</span><br></pre></td></tr></table></figure><p>如提示:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget :com.m.and not found</span><br></pre></td></tr></table></figure><p>请执行:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install wget -y</span><br></pre></td></tr></table></figure><p>最后等着就行了</p><h2 id="安装SSTap"><a href="#安装SSTap" class="headerlink" title="安装SSTap"></a>安装SSTap</h2><p>SSTap是SocksCap64作者新开发的一款利用虚拟网卡实现的网络层代理。SSTap能在网络层拦截所有连接并转发给HTTP，SOCKS4，5，SHADOWSOCKS代理.<br>而无需对被代理的应用程序做任何修改或设置。它能同时转发TCP, UDP数据包。它非常适合于游戏玩家使用。享受你的游戏时光！请使用SSTap！</p><h2 id="SSR常用命令"><a href="#SSR常用命令" class="headerlink" title="SSR常用命令"></a>SSR常用命令</h2><h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;init.d&#x2F;shadowsocks start</span><br></pre></td></tr></table></figure><h3 id="停止"><a href="#停止" class="headerlink" title="停止"></a>停止</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;init.d&#x2F;shadowsocks stop</span><br></pre></td></tr></table></figure><h3 id="重启"><a href="#重启" class="headerlink" title="重启"></a>重启</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;init.d&#x2F;shadowsocks restart</span><br></pre></td></tr></table></figure><h3 id="状态"><a href="#状态" class="headerlink" title="状态"></a>状态</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;init.d&#x2F;shadowsocks status</span><br></pre></td></tr></table></figure><h2 id="SSR修改密码、配置多端口"><a href="#SSR修改密码、配置多端口" class="headerlink" title="SSR修改密码、配置多端口"></a>SSR修改密码、配置多端口</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;shadowsocks.json</span><br></pre></td></tr></table></figure><h3 id="修改后进行重启"><a href="#修改后进行重启" class="headerlink" title="修改后进行重启"></a>修改后进行重启</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;init.d&#x2F;shadowsocks restart</span><br></pre></td></tr></table></figure><h3 id="如不能联网-则关闭防火墙-逐条输入"><a href="#如不能联网-则关闭防火墙-逐条输入" class="headerlink" title="如不能联网,则关闭防火墙 逐条输入"></a>如不能联网,则关闭防火墙 <code>逐条输入</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service iptables restart</span><br><span class="line">service iptables stop</span><br><span class="line">chkconfig iptables off</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;VPS用途&quot;&gt;&lt;a href=&quot;#VPS用途&quot; class=&quot;headerlink&quot; title=&quot;VPS用途&quot;&gt;&lt;/a&gt;VPS用途&lt;/h2&gt;&lt;p&gt;VPS虚拟服务器技术可以通过多种不同的方式灵活地分配服务器资源，每个虚拟化服务器的资源都可以有很大的不同，可以灵活的满足各种高端用户的需求。通过在一台服务器上创建10个左右的VPS主机，可以确保每一个虚拟主机的用户独享VPS资源，其运行和管理完全和独立主机相同。VPS主机可以为高端用户提供安全、可靠、高品质的主机服务。&lt;/p&gt;</summary>
    
    
    
    <category term="VPN" scheme="https://aliatry.com/categories/VPN/"/>
    
    
    <category term="SSR" scheme="https://aliatry.com/tags/SSR/"/>
    
    <category term="VPN" scheme="https://aliatry.com/tags/VPN/"/>
    
    <category term="VPS" scheme="https://aliatry.com/tags/VPS/"/>
    
  </entry>
  
  <entry>
    <title>IDEA生成 Serializable 序列化 UID 的快捷键</title>
    <link href="https://aliatry.com/2019/02/20/IDEA%E7%94%9F%E6%88%90-Serializable-%E5%BA%8F%E5%88%97%E5%8C%96-UID-%E7%9A%84%E5%BF%AB%E6%8D%B7%E9%94%AE/"/>
    <id>https://aliatry.com/2019/02/20/IDEA%E7%94%9F%E6%88%90-Serializable-%E5%BA%8F%E5%88%97%E5%8C%96-UID-%E7%9A%84%E5%BF%AB%E6%8D%B7%E9%94%AE/</id>
    <published>2019-02-20T10:43:50.000Z</published>
    <updated>2019-03-05T08:42:39.533Z</updated>
    
    <content type="html"><![CDATA[<p>首先创建一个类如User, 让该类实现Serializable序列化接口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public class User implements Serializable &#123;&#125;</span><br></pre></td></tr></table></figure><p>然后在菜单选择 <code>File</code> | <code>Settings</code> | <code>Editor</code> | <code>Inspections</code></p><a id="more"></a><p>在搜索框里输入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Serializable class without &#39;serialVersionUID&#39;</span><br></pre></td></tr></table></figure><p>在搜索到的选项中勾选 <code>Serializable class without &#39;serialVersionUID&#39;</code> 点击 <code>OK</code></p><p>之后我们要将光标放到实体类的名字 <code>User</code> 上，然后 <code>Alt</code> + <code>Enter</code>(回车)</p><p>会出现 <code>Add &#39;serialVersionUID&#39; field</code> 这个选项, 然后直接回车即可</p><p>之后我们就可以看到自动生成的UID了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private static final long serialVersionUID &#x3D; 1L;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;首先创建一个类如User, 让该类实现Serializable序列化接口&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;public class User implements Serializable &amp;#123;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后在菜单选择 &lt;code&gt;File&lt;/code&gt; | &lt;code&gt;Settings&lt;/code&gt; | &lt;code&gt;Editor&lt;/code&gt; | &lt;code&gt;Inspections&lt;/code&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="idea" scheme="https://aliatry.com/categories/idea/"/>
    
    <category term="Serializable" scheme="https://aliatry.com/categories/idea/Serializable/"/>
    
    
    <category term="idea" scheme="https://aliatry.com/tags/idea/"/>
    
    <category term="Serializable" scheme="https://aliatry.com/tags/Serializable/"/>
    
    <category term="序列化" scheme="https://aliatry.com/tags/%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
    <category term="快捷键" scheme="https://aliatry.com/tags/%E5%BF%AB%E6%8D%B7%E9%94%AE/"/>
    
  </entry>
  
  <entry>
    <title>IDEA 2019 激活注册码</title>
    <link href="https://aliatry.com/2019/02/20/IDEA-2019-%E6%BF%80%E6%B4%BB%E6%B3%A8%E5%86%8C%E7%A0%81/"/>
    <id>https://aliatry.com/2019/02/20/IDEA-2019-%E6%BF%80%E6%B4%BB%E6%B3%A8%E5%86%8C%E7%A0%81/</id>
    <published>2019-02-20T06:45:05.000Z</published>
    <updated>2019-03-05T08:28:13.108Z</updated>
    
    <content type="html"><![CDATA[<p>一直使用的是修改 <code>hosts</code> 的激活方式, 但是有时候科学上网网络就炸了<br>所以重新找了一个不需要修改 <code>hosts</code> 的激活方法</p><h2 id="JetBrains全系列在线激活中心"><a href="#JetBrains全系列在线激活中心" class="headerlink" title="JetBrains全系列在线激活中心"></a><a href="https://jetlicense.nss.im/">JetBrains全系列在线激活中心</a></h2>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;一直使用的是修改 &lt;code&gt;hosts&lt;/code&gt; 的激活方式, 但是有时候科学上网网络就炸了&lt;br&gt;所以重新找了一个不需要修改 &lt;code&gt;hosts&lt;/code&gt; 的激活方法&lt;/p&gt;
&lt;h2 id=&quot;JetBrains全系列在线激活中心&quot;&gt;&lt;a href=&quot;#Jet</summary>
      
    
    
    
    <category term="idea" scheme="https://aliatry.com/categories/idea/"/>
    
    <category term="激活" scheme="https://aliatry.com/categories/idea/%E6%BF%80%E6%B4%BB/"/>
    
    <category term="注册码" scheme="https://aliatry.com/categories/idea/%E6%BF%80%E6%B4%BB/%E6%B3%A8%E5%86%8C%E7%A0%81/"/>
    
    
    <category term="idea" scheme="https://aliatry.com/tags/idea/"/>
    
    <category term="激活" scheme="https://aliatry.com/tags/%E6%BF%80%E6%B4%BB/"/>
    
    <category term="注册码" scheme="https://aliatry.com/tags/%E6%B3%A8%E5%86%8C%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>热部署在Eclipse和IDEA里面的使用</title>
    <link href="https://aliatry.com/2019/01/14/%E7%83%AD%E9%83%A8%E7%BD%B2%E5%9C%A8Eclipse%E5%92%8CIDEA%E9%87%8C%E9%9D%A2%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <id>https://aliatry.com/2019/01/14/%E7%83%AD%E9%83%A8%E7%BD%B2%E5%9C%A8Eclipse%E5%92%8CIDEA%E9%87%8C%E9%9D%A2%E7%9A%84%E4%BD%BF%E7%94%A8/</id>
    <published>2019-01-14T08:34:16.000Z</published>
    <updated>2019-03-05T08:41:06.131Z</updated>
    
    <content type="html"><![CDATA[<h2 id="热部署在Eclipse和IDEA里面的使用"><a href="#热部署在Eclipse和IDEA里面的使用" class="headerlink" title="热部署在Eclipse和IDEA里面的使用"></a>热部署在Eclipse和IDEA里面的使用</h2><p>简介：讲解热部署的使用注意事项，在eclipse里面默认开启，在IDE里面默认关闭</p><h2 id="增加依赖"><a href="#增加依赖" class="headerlink" title="增加依赖"></a>增加依赖</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="eclipse热部署默认自动开启"><a href="#eclipse热部署默认自动开启" class="headerlink" title="eclipse热部署默认自动开启"></a>eclipse热部署默认自动开启</h2><h2 id="idea里面要设置"><a href="#idea里面要设置" class="headerlink" title="idea里面要设置"></a>idea里面要设置</h2><h3 id="相关偏好里开启自动编译"><a href="#相关偏好里开启自动编译" class="headerlink" title="相关偏好里开启自动编译"></a>相关偏好里开启自动编译</h3><p><code>File</code> &gt;&gt;&gt; <code>Settings</code> &gt;&gt;&gt; <code>Build,Execution,Deployment</code> &gt;&gt;&gt; <code>Compiler</code></p><p>勾选 <code>Build project automatically</code></p><h3 id="Shift-Ctrl-Alt-，选择Registry"><a href="#Shift-Ctrl-Alt-，选择Registry" class="headerlink" title="Shift+Ctrl+Alt+/，选择Registry"></a>Shift+Ctrl+Alt+/，选择Registry</h3><p>勾选 compiler.automake.allow.when.app.running</p><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a><a href="https://www.cnblogs.com/aqsunkai/p/6690574.html">参考链接</a></h3>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;热部署在Eclipse和IDEA里面的使用&quot;&gt;&lt;a href=&quot;#热部署在Eclipse和IDEA里面的使用&quot; class=&quot;headerlink&quot; title=&quot;热部署在Eclipse和IDEA里面的使用&quot;&gt;&lt;/a&gt;热部署在Eclipse和IDEA里面的使用&lt;/h2&gt;&lt;p&gt;简介：讲解热部署的使用注意事项，在eclipse里面默认开启，在IDE里面默认关闭&lt;/p&gt;
&lt;h2 id=&quot;增加依赖&quot;&gt;&lt;a href=&quot;#增加依赖&quot; class=&quot;headerlink&quot; title=&quot;增加依赖&quot;&gt;&lt;/a&gt;增加依赖&lt;/h2&gt;&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;org.springframework.boot&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;groupId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;spring-boot-devtools&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;artifactId&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;optional&lt;/span&gt;&amp;gt;&lt;/span&gt;true&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;optional&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;dependency&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="热部署" scheme="https://aliatry.com/categories/%E7%83%AD%E9%83%A8%E7%BD%B2/"/>
    
    
    <category term="idea" scheme="https://aliatry.com/tags/idea/"/>
    
    <category term="热部署" scheme="https://aliatry.com/tags/%E7%83%AD%E9%83%A8%E7%BD%B2/"/>
    
    <category term="eclipse" scheme="https://aliatry.com/tags/eclipse/"/>
    
  </entry>
  
  <entry>
    <title>阿里云对象存储服务 springcloud服务接口</title>
    <link href="https://aliatry.com/2018/12/27/%E9%98%BF%E9%87%8C%E4%BA%91%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1-springcloud%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3/"/>
    <id>https://aliatry.com/2018/12/27/%E9%98%BF%E9%87%8C%E4%BA%91%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1-springcloud%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3/</id>
    <published>2018-12-27T04:09:59.000Z</published>
    <updated>2019-03-05T08:41:20.206Z</updated>
    
    <content type="html"><![CDATA[<h1 id="阿里云对象存储服务-springcloud服务接口"><a href="#阿里云对象存储服务-springcloud服务接口" class="headerlink" title="阿里云对象存储服务 springcloud服务接口"></a>阿里云对象存储服务 springcloud服务接口</h1><p>本文章提供的是阿里云对象存储的核心示例代码 , 具体springcloud接口服务于最下面查看 <code>示例下载</code></p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 示例说明</span><br><span class="line"> *</span><br><span class="line"> * HelloOSS是OSS Java SDK的示例程序，您可以修改endpoint、accessKeyId、accessKeySecret、bucketName后直接运行。</span><br><span class="line"> * 运行方法请参考README。</span><br><span class="line"> *</span><br><span class="line"> * 本示例中的并不包括OSS Java SDK的所有功能，详细功能及使用方法，请参看“SDK手册 &gt; Java-SDK”，</span><br><span class="line"> * 链接地址是：https:&#x2F;&#x2F;help.aliyun.com&#x2F;document_detail&#x2F;oss&#x2F;sdk&#x2F;java-sdk&#x2F;preface.html?spm&#x3D;5176.docoss&#x2F;sdk&#x2F;java-sdk&#x2F;。</span><br><span class="line"> *</span><br><span class="line"> * 调用OSS Java SDK的方法时，抛出异常表示有错误发生；没有抛出异常表示成功执行。</span><br><span class="line"> * 当错误发生时，OSS Java SDK的方法会抛出异常，异常中包括错误码、错误信息，详细请参看“SDK手册 &gt; Java-SDK &gt; 异常处理”，</span><br><span class="line"> * 链接地址是：https:&#x2F;&#x2F;help.aliyun.com&#x2F;document_detail&#x2F;oss&#x2F;sdk&#x2F;java-sdk&#x2F;exception.html?spm&#x3D;5176.docoss&#x2F;api-reference&#x2F;error-response。</span><br><span class="line"> *</span><br><span class="line"> * OSS控制台可以直观的看到您调用OSS Java SDK的结果，OSS控制台地址是：https:&#x2F;&#x2F;oss.console.aliyun.com&#x2F;index#&#x2F;。</span><br><span class="line"> * OSS控制台使用方法请参看文档中心的“控制台用户指南”， 指南的来链接地址是：https:&#x2F;&#x2F;help.aliyun.com&#x2F;document_detail&#x2F;oss&#x2F;getting-started&#x2F;get-started.html?spm&#x3D;5176.docoss&#x2F;user_guide。</span><br><span class="line"> *</span><br><span class="line"> * OSS的文档中心地址是：https:&#x2F;&#x2F;help.aliyun.com&#x2F;document_detail&#x2F;oss&#x2F;user_guide&#x2F;overview.html。</span><br><span class="line"> * OSS Java SDK的文档地址是：https:&#x2F;&#x2F;help.aliyun.com&#x2F;document_detail&#x2F;oss&#x2F;sdk&#x2F;java-sdk&#x2F;install.html?spm&#x3D;5176.docoss&#x2F;sdk&#x2F;java-sdk。</span><br><span class="line"> *</span><br><span class="line"> *&#x2F;</span><br><span class="line"></span><br><span class="line">package com.aliyun.oss.demo;</span><br><span class="line"></span><br><span class="line">import java.io.BufferedReader;</span><br><span class="line">import java.io.ByteArrayInputStream;</span><br><span class="line">import java.io.File;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.io.InputStreamReader;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">import com.aliyun.oss.ClientException;</span><br><span class="line">import com.aliyun.oss.OSSClient;</span><br><span class="line">import com.aliyun.oss.OSSException;</span><br><span class="line">import com.aliyun.oss.model.BucketInfo;</span><br><span class="line">import com.aliyun.oss.model.OSSObject;</span><br><span class="line">import com.aliyun.oss.model.OSSObjectSummary;</span><br><span class="line">import com.aliyun.oss.model.ObjectListing;</span><br><span class="line"></span><br><span class="line">import org.apache.log4j.Logger;</span><br><span class="line">import org.apache.log4j.PropertyConfigurator;</span><br><span class="line"></span><br><span class="line">public class HelloOSS &#123;</span><br><span class="line">    static Logger logger &#x3D; Logger.getLogger(HelloOSS.class);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; endpoint是访问OSS的域名。如果您已经在OSS的控制台上 创建了Bucket，请在控制台上查看域名。</span><br><span class="line">    &#x2F;&#x2F; 如果您还没有创建Bucket，endpoint选择请参看文档中心的“开发人员指南 &gt; 基本概念 &gt; 访问域名”，</span><br><span class="line">    &#x2F;&#x2F; 链接地址是：https:&#x2F;&#x2F;help.aliyun.com&#x2F;document_detail&#x2F;oss&#x2F;user_guide&#x2F;oss_concept&#x2F;endpoint.html?spm&#x3D;5176.docoss&#x2F;user_guide&#x2F;endpoint_region</span><br><span class="line">    &#x2F;&#x2F; endpoint的格式形如“http:&#x2F;&#x2F;oss-cn-hangzhou.aliyuncs.com&#x2F;”，注意http:&#x2F;&#x2F;后不带bucket名称，</span><br><span class="line">    &#x2F;&#x2F; 比如“http:&#x2F;&#x2F;bucket-name.oss-cn-hangzhou.aliyuncs.com”，是错误的endpoint，请去掉其中的“bucket-name”。</span><br><span class="line">    private static String endpoint &#x3D; &quot;http:&#x2F;&#x2F;oss-cn-hangzhou.aliyuncs.com&quot;;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; accessKeyId和accessKeySecret是OSS的访问密钥，您可以在控制台上创建和查看，</span><br><span class="line">    &#x2F;&#x2F; 创建和查看访问密钥的链接地址是：https:&#x2F;&#x2F;ak-console.aliyun.com&#x2F;#&#x2F;。</span><br><span class="line">    &#x2F;&#x2F; 注意：accessKeyId和accessKeySecret前后都没有空格，从控制台复制时请检查并去除多余的空格。</span><br><span class="line">    private static String accessKeyId &#x3D; &quot;&lt;yourAccessKeyId&gt;&quot;;</span><br><span class="line">    private static String accessKeySecret &#x3D; &quot;&lt;yourAccessKeySecret&gt;&quot;;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; Bucket用来管理所存储Object的存储空间，详细描述请参看“开发人员指南 &gt; 基本概念 &gt; OSS基本概念介绍”。</span><br><span class="line">    &#x2F;&#x2F; Bucket命名规范如下：只能包括小写字母，数字和短横线（-），必须以小写字母或者数字开头，长度必须在3-63字节之间。</span><br><span class="line">    private static String bucketName &#x3D; &quot;&lt;yourBucketName&gt;&quot;;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; Object是OSS存储数据的基本单元，称为OSS的对象，也被称为OSS的文件。详细描述请参看“开发人员指南 &gt; 基本概念 &gt; OSS基本概念介绍”。</span><br><span class="line">    &#x2F;&#x2F; Object命名规范如下：使用UTF-8编码，长度必须在1-1023字节之间，不能以“&#x2F;”或者“\”字符开头。</span><br><span class="line">    private static String firstKey &#x3D; &quot;my-first-key&quot;;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 日志配置，OSS Java SDK使用log4j记录错误信息。示例程序会在工程目录下生成“oss-demo.log”日志文件，默认日志级别是INFO。</span><br><span class="line">        &#x2F;&#x2F; 日志的配置文件是“conf&#x2F;log4j.properties”，如果您不需要日志，可以没有日志配置文件和下面的日志配置。</span><br><span class="line">        PropertyConfigurator.configure(&quot;conf&#x2F;log4j.properties&quot;);</span><br><span class="line"></span><br><span class="line">        logger.info(&quot;Started&quot;);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; 生成OSSClient，您可以指定一些参数，详见“SDK手册 &gt; Java-SDK &gt; 初始化”，</span><br><span class="line">        &#x2F;&#x2F; 链接地址是：https:&#x2F;&#x2F;help.aliyun.com&#x2F;document_detail&#x2F;oss&#x2F;sdk&#x2F;java-sdk&#x2F;init.html?spm&#x3D;5176.docoss&#x2F;sdk&#x2F;java-sdk&#x2F;get-start</span><br><span class="line">        OSSClient ossClient &#x3D; new OSSClient(endpoint, accessKeyId, accessKeySecret);</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; 判断Bucket是否存在。详细请参看“SDK手册 &gt; Java-SDK &gt; 管理Bucket”。</span><br><span class="line">            &#x2F;&#x2F; 链接地址是：https:&#x2F;&#x2F;help.aliyun.com&#x2F;document_detail&#x2F;oss&#x2F;sdk&#x2F;java-sdk&#x2F;manage_bucket.html?spm&#x3D;5176.docoss&#x2F;sdk&#x2F;java-sdk&#x2F;init</span><br><span class="line">            if (ossClient.doesBucketExist(bucketName)) &#123;</span><br><span class="line">                System.out.println(&quot;您已经创建Bucket：&quot; + bucketName + &quot;。&quot;);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                System.out.println(&quot;您的Bucket不存在，创建Bucket：&quot; + bucketName + &quot;。&quot;);</span><br><span class="line">                &#x2F;&#x2F; 创建Bucket。详细请参看“SDK手册 &gt; Java-SDK &gt; 管理Bucket”。</span><br><span class="line">                &#x2F;&#x2F; 链接地址是：https:&#x2F;&#x2F;help.aliyun.com&#x2F;document_detail&#x2F;oss&#x2F;sdk&#x2F;java-sdk&#x2F;manage_bucket.html?spm&#x3D;5176.docoss&#x2F;sdk&#x2F;java-sdk&#x2F;init</span><br><span class="line">                ossClient.createBucket(bucketName);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; 查看Bucket信息。详细请参看“SDK手册 &gt; Java-SDK &gt; 管理Bucket”。</span><br><span class="line">            &#x2F;&#x2F; 链接地址是：https:&#x2F;&#x2F;help.aliyun.com&#x2F;document_detail&#x2F;oss&#x2F;sdk&#x2F;java-sdk&#x2F;manage_bucket.html?spm&#x3D;5176.docoss&#x2F;sdk&#x2F;java-sdk&#x2F;init</span><br><span class="line">            BucketInfo info &#x3D; ossClient.getBucketInfo(bucketName);</span><br><span class="line">            System.out.println(&quot;Bucket &quot; + bucketName + &quot;的信息如下：&quot;);</span><br><span class="line">            System.out.println(&quot;\t数据中心：&quot; + info.getBucket().getLocation());</span><br><span class="line">            System.out.println(&quot;\t创建时间：&quot; + info.getBucket().getCreationDate());</span><br><span class="line">            System.out.println(&quot;\t用户标志：&quot; + info.getBucket().getOwner());</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; 把字符串存入OSS，Object的名称为firstKey。详细请参看“SDK手册 &gt; Java-SDK &gt; 上传文件”。</span><br><span class="line">            &#x2F;&#x2F; 链接地址是：https:&#x2F;&#x2F;help.aliyun.com&#x2F;document_detail&#x2F;oss&#x2F;sdk&#x2F;java-sdk&#x2F;upload_object.html?spm&#x3D;5176.docoss&#x2F;user_guide&#x2F;upload_object</span><br><span class="line">            InputStream is &#x3D; new ByteArrayInputStream(&quot;Hello OSS&quot;.getBytes());</span><br><span class="line">            ossClient.putObject(bucketName, firstKey, is);</span><br><span class="line">            System.out.println(&quot;Object：&quot; + firstKey + &quot;存入OSS成功。&quot;);</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; 下载文件。详细请参看“SDK手册 &gt; Java-SDK &gt; 下载文件”。</span><br><span class="line">            &#x2F;&#x2F; 链接地址是：https:&#x2F;&#x2F;help.aliyun.com&#x2F;document_detail&#x2F;oss&#x2F;sdk&#x2F;java-sdk&#x2F;download_object.html?spm&#x3D;5176.docoss&#x2F;sdk&#x2F;java-sdk&#x2F;manage_object</span><br><span class="line">            OSSObject ossObject &#x3D; ossClient.getObject(bucketName, firstKey);</span><br><span class="line">            InputStream inputStream &#x3D; ossObject.getObjectContent();</span><br><span class="line">            StringBuilder objectContent &#x3D; new StringBuilder();</span><br><span class="line">            BufferedReader reader &#x3D; new BufferedReader(new InputStreamReader(inputStream));</span><br><span class="line">            while (true) &#123;</span><br><span class="line">                String line &#x3D; reader.readLine();</span><br><span class="line">                if (line &#x3D;&#x3D; null)</span><br><span class="line">                    break;</span><br><span class="line">                objectContent.append(line);</span><br><span class="line">            &#125;</span><br><span class="line">            inputStream.close();</span><br><span class="line">            System.out.println(&quot;Object：&quot; + firstKey + &quot;的内容是：&quot; + objectContent);</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; 文件存储入OSS，Object的名称为fileKey。详细请参看“SDK手册 &gt; Java-SDK &gt; 上传文件”。</span><br><span class="line">            &#x2F;&#x2F; 链接地址是：https:&#x2F;&#x2F;help.aliyun.com&#x2F;document_detail&#x2F;oss&#x2F;sdk&#x2F;java-sdk&#x2F;upload_object.html?spm&#x3D;5176.docoss&#x2F;user_guide&#x2F;upload_object</span><br><span class="line">            String fileKey &#x3D; &quot;README.md&quot;;</span><br><span class="line">            ossClient.putObject(bucketName, fileKey, new File(&quot;README.md&quot;));</span><br><span class="line">            System.out.println(&quot;Object：&quot; + fileKey + &quot;存入OSS成功。&quot;);</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; 查看Bucket中的Object。详细请参看“SDK手册 &gt; Java-SDK &gt; 管理文件”。</span><br><span class="line">            &#x2F;&#x2F; 链接地址是：https:&#x2F;&#x2F;help.aliyun.com&#x2F;document_detail&#x2F;oss&#x2F;sdk&#x2F;java-sdk&#x2F;manage_object.html?spm&#x3D;5176.docoss&#x2F;sdk&#x2F;java-sdk&#x2F;manage_bucket</span><br><span class="line">            ObjectListing objectListing &#x3D; ossClient.listObjects(bucketName);</span><br><span class="line">            List&lt;OSSObjectSummary&gt; objectSummary &#x3D; objectListing.getObjectSummaries();</span><br><span class="line">            System.out.println(&quot;您有以下Object：&quot;);</span><br><span class="line">            for (OSSObjectSummary object : objectSummary) &#123;</span><br><span class="line">                System.out.println(&quot;\t&quot; + object.getKey());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; 删除Object。详细请参看“SDK手册 &gt; Java-SDK &gt; 管理文件”。</span><br><span class="line">            &#x2F;&#x2F; 链接地址是：https:&#x2F;&#x2F;help.aliyun.com&#x2F;document_detail&#x2F;oss&#x2F;sdk&#x2F;java-sdk&#x2F;manage_object.html?spm&#x3D;5176.docoss&#x2F;sdk&#x2F;java-sdk&#x2F;manage_bucket</span><br><span class="line">            ossClient.deleteObject(bucketName, firstKey);</span><br><span class="line">            System.out.println(&quot;删除Object：&quot; + firstKey + &quot;成功。&quot;);</span><br><span class="line">            ossClient.deleteObject(bucketName, fileKey);</span><br><span class="line">            System.out.println(&quot;删除Object：&quot; + fileKey + &quot;成功。&quot;);</span><br><span class="line"></span><br><span class="line">        &#125; catch (OSSException oe) &#123;</span><br><span class="line">            oe.printStackTrace();</span><br><span class="line">        &#125; catch (ClientException ce) &#123;</span><br><span class="line">            ce.printStackTrace();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            ossClient.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        logger.info(&quot;Completed&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="示例下载-1"><a href="#示例下载-1" class="headerlink" title="[示例下载] 1"></a>[示例下载] <a href="https://gitee.com/admin-simon/aliyun_oss_service">1</a></h1>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;阿里云对象存储服务-springcloud服务接口&quot;&gt;&lt;a href=&quot;#阿里云对象存储服务-springcloud服务接口&quot; class=&quot;headerlink&quot; title=&quot;阿里云对象存储服务 springcloud服务接口&quot;&gt;&lt;/a&gt;阿里云对象存储服务 springcloud服务接口&lt;/h1&gt;&lt;p&gt;本文章提供的是阿里云对象存储的核心示例代码 , 具体springcloud接口服务于最下面查看 &lt;code&gt;示例下载&lt;/code&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="阿里云" scheme="https://aliatry.com/categories/%E9%98%BF%E9%87%8C%E4%BA%91/"/>
    
    <category term="oss" scheme="https://aliatry.com/categories/%E9%98%BF%E9%87%8C%E4%BA%91/oss/"/>
    
    
    <category term="springcloud" scheme="https://aliatry.com/tags/springcloud/"/>
    
    <category term="阿里云" scheme="https://aliatry.com/tags/%E9%98%BF%E9%87%8C%E4%BA%91/"/>
    
    <category term="oss" scheme="https://aliatry.com/tags/oss/"/>
    
    <category term="对象存储" scheme="https://aliatry.com/tags/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8/"/>
    
  </entry>
  
  <entry>
    <title>Maven仓库修改阿里中央仓库</title>
    <link href="https://aliatry.com/2018/12/25/Maven%E4%BB%93%E5%BA%93%E4%BF%AE%E6%94%B9%E9%98%BF%E9%87%8C%E4%B8%AD%E5%A4%AE%E4%BB%93%E5%BA%93/"/>
    <id>https://aliatry.com/2018/12/25/Maven%E4%BB%93%E5%BA%93%E4%BF%AE%E6%94%B9%E9%98%BF%E9%87%8C%E4%B8%AD%E5%A4%AE%E4%BB%93%E5%BA%93/</id>
    <published>2018-12-25T02:20:59.000Z</published>
    <updated>2019-10-12T06:08:46.608Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Maven仓库修改阿里中央仓库"><a href="#Maven仓库修改阿里中央仓库" class="headerlink" title="Maven仓库修改阿里中央仓库"></a>Maven仓库修改阿里中央仓库</h2><h3 id="修改-conf-下的-settings-xml"><a href="#修改-conf-下的-settings-xml" class="headerlink" title="修改 conf 下的 settings.xml"></a>修改 <code>conf</code> 下的 <code>settings.xml</code></h3><a id="more"></a><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">Licensed to the Apache Software Foundation (ASF) under one</span></span><br><span class="line"><span class="comment">or more contributor license agreements.  See the NOTICE file</span></span><br><span class="line"><span class="comment">distributed with this work for additional information</span></span><br><span class="line"><span class="comment">regarding copyright ownership.  The ASF licenses this file</span></span><br><span class="line"><span class="comment">to you under the Apache License, Version 2.0 (the</span></span><br><span class="line"><span class="comment">&quot;License&quot;); you may not use this file except in compliance</span></span><br><span class="line"><span class="comment">with the License.  You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Unless required by applicable law or agreed to in writing,</span></span><br><span class="line"><span class="comment">software distributed under the License is distributed on an</span></span><br><span class="line"><span class="comment">&quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span></span><br><span class="line"><span class="comment">KIND, either express or implied.  See the License for the</span></span><br><span class="line"><span class="comment">specific language governing permissions and limitations</span></span><br><span class="line"><span class="comment">under the License.</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment"> | This is the configuration file for Maven. It can be specified at two levels:</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |  1. User Level. This settings.xml file provides configuration for a single user,</span></span><br><span class="line"><span class="comment"> |                 and is normally provided in $&#123;user.home&#125;/.m2/settings.xml.</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |                 <span class="doctag">NOTE:</span> This location can be overridden with the CLI option:</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |                 -s /path/to/user/settings.xml</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |  2. Global Level. This settings.xml file provides configuration for all Maven</span></span><br><span class="line"><span class="comment"> |                 users on a machine (assuming they&#x27;re all using the same Maven</span></span><br><span class="line"><span class="comment"> |                 installation). It&#x27;s normally provided in</span></span><br><span class="line"><span class="comment"> |                 $&#123;maven.conf&#125;/settings.xml.</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |                 <span class="doctag">NOTE:</span> This location can be overridden with the CLI option:</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |                 -gs /path/to/global/settings.xml</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> | The sections in this sample file are intended to give you a running start at</span></span><br><span class="line"><span class="comment"> | getting the most out of your Maven installation. Where appropriate, the default</span></span><br><span class="line"><span class="comment"> | values (values used when the setting is not specified) are provided.</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/SETTINGS/1.0.0&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- localRepository</span></span><br><span class="line"><span class="comment">   | The path to the local repository maven will use to store artifacts.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | Default: $&#123;user.home&#125;/.m2/repository</span></span><br><span class="line"><span class="comment">  &lt;localRepository&gt;/path/to/local/repo&lt;/localRepository&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- interactiveMode</span></span><br><span class="line"><span class="comment">   | This will determine whether maven prompts you when it needs input. If set to false,</span></span><br><span class="line"><span class="comment">   | maven will use a sensible default value, perhaps based on some other setting, for</span></span><br><span class="line"><span class="comment">   | the parameter in question.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | Default: true</span></span><br><span class="line"><span class="comment">  &lt;interactiveMode&gt;true&lt;/interactiveMode&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- offline</span></span><br><span class="line"><span class="comment">   | Determines whether maven should attempt to connect to the network when executing a build.</span></span><br><span class="line"><span class="comment">   | This will have an effect on artifact downloads, artifact deployment, and others.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | Default: false</span></span><br><span class="line"><span class="comment">  &lt;offline&gt;false&lt;/offline&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- pluginGroups</span></span><br><span class="line"><span class="comment">   | This is a list of additional group identifiers that will be searched when resolving plugins by their prefix, i.e.</span></span><br><span class="line"><span class="comment">   | when invoking a command line like &quot;mvn prefix:goal&quot;. Maven will automatically add the group identifiers</span></span><br><span class="line"><span class="comment">   | &quot;org.apache.maven.plugins&quot; and &quot;org.codehaus.mojo&quot; if these are not already contained in the list.</span></span><br><span class="line"><span class="comment">   |--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">pluginGroups</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- pluginGroup</span></span><br><span class="line"><span class="comment">     | Specifies a further group identifier to use for plugin lookup.</span></span><br><span class="line"><span class="comment">    &lt;pluginGroup&gt;com.your.plugins&lt;/pluginGroup&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">pluginGroups</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- proxies</span></span><br><span class="line"><span class="comment">   | This is a list of proxies which can be used on this machine to connect to the network.</span></span><br><span class="line"><span class="comment">   | Unless otherwise specified (by system property or command-line switch), the first proxy</span></span><br><span class="line"><span class="comment">   | specification in this list marked as active will be used.</span></span><br><span class="line"><span class="comment">   |--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">proxies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- proxy</span></span><br><span class="line"><span class="comment">     | Specification for one proxy, to be used in connecting to the network.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">    &lt;proxy&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;optional&lt;/id&gt;</span></span><br><span class="line"><span class="comment">      &lt;active&gt;true&lt;/active&gt;</span></span><br><span class="line"><span class="comment">      &lt;protocol&gt;http&lt;/protocol&gt;</span></span><br><span class="line"><span class="comment">      &lt;username&gt;proxyuser&lt;/username&gt;</span></span><br><span class="line"><span class="comment">      &lt;password&gt;proxypass&lt;/password&gt;</span></span><br><span class="line"><span class="comment">      &lt;host&gt;proxy.host.net&lt;/host&gt;</span></span><br><span class="line"><span class="comment">      &lt;port&gt;80&lt;/port&gt;</span></span><br><span class="line"><span class="comment">      &lt;nonProxyHosts&gt;local.net|some.host.com&lt;/nonProxyHosts&gt;</span></span><br><span class="line"><span class="comment">    &lt;/proxy&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">proxies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- servers</span></span><br><span class="line"><span class="comment">   | This is a list of authentication profiles, keyed by the server-id used within the system.</span></span><br><span class="line"><span class="comment">   | Authentication profiles can be used whenever maven must make a connection to a remote server.</span></span><br><span class="line"><span class="comment">   |--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- server</span></span><br><span class="line"><span class="comment">     | Specifies the authentication information to use when connecting to a particular server, identified by</span></span><br><span class="line"><span class="comment">     | a unique name within the system (referred to by the &#x27;id&#x27; attribute below).</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     | <span class="doctag">NOTE:</span> You should either specify username/password OR privateKey/passphrase, since these pairings are</span></span><br><span class="line"><span class="comment">     |       used together.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">    &lt;server&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;deploymentRepo&lt;/id&gt;</span></span><br><span class="line"><span class="comment">      &lt;username&gt;repouser&lt;/username&gt;</span></span><br><span class="line"><span class="comment">      &lt;password&gt;repopwd&lt;/password&gt;</span></span><br><span class="line"><span class="comment">    &lt;/server&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Another sample, using keys to authenticate.</span></span><br><span class="line"><span class="comment">    &lt;server&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;siteServer&lt;/id&gt;</span></span><br><span class="line"><span class="comment">      &lt;privateKey&gt;/path/to/private/key&lt;/privateKey&gt;</span></span><br><span class="line"><span class="comment">      &lt;passphrase&gt;optional; leave empty if not used.&lt;/passphrase&gt;</span></span><br><span class="line"><span class="comment">    &lt;/server&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servers</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- mirrors</span></span><br><span class="line"><span class="comment">   | This is a list of mirrors to be used in downloading artifacts from remote repositories.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | It works like this: a POM may declare a repository to use in resolving certain artifacts.</span></span><br><span class="line"><span class="comment">   | However, this repository may have problems with heavy traffic at times, so people have mirrored</span></span><br><span class="line"><span class="comment">   | it to several places.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | That repository definition will have a unique id, so we can create a mirror reference for that</span></span><br><span class="line"><span class="comment">   | repository, to be used as an alternate download site. The mirror site will be the preferred</span></span><br><span class="line"><span class="comment">   | server for that repository.</span></span><br><span class="line"><span class="comment">   |--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- mirror</span></span><br><span class="line"><span class="comment">     | Specifies a repository mirror site to use instead of a given repository. The repository that</span></span><br><span class="line"><span class="comment">     | this mirror serves has an ID that matches the mirrorOf element of this mirror. IDs are used</span></span><br><span class="line"><span class="comment">     | for inheritance and direct lookup purposes, and must be unique across the set of mirrors.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">    &lt;mirror&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;mirrorId&lt;/id&gt;</span></span><br><span class="line"><span class="comment">      &lt;mirrorOf&gt;repositoryId&lt;/mirrorOf&gt;</span></span><br><span class="line"><span class="comment">      &lt;name&gt;Human Readable Name for this Mirror.&lt;/name&gt;</span></span><br><span class="line"><span class="comment">      &lt;url&gt;http://my.repository.com/repo/path&lt;/url&gt;</span></span><br><span class="line"><span class="comment">    &lt;/mirror&gt;</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-aliyun<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>Nexus aliyun<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- profiles</span></span><br><span class="line"><span class="comment">   | This is a list of profiles which can be activated in a variety of ways, and which can modify</span></span><br><span class="line"><span class="comment">   | the build process. Profiles provided in the settings.xml are intended to provide local machine-</span></span><br><span class="line"><span class="comment">   | specific paths and repository locations which allow the build to work in the local environment.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | For example, if you have an integration testing plugin - like cactus - that needs to know where</span></span><br><span class="line"><span class="comment">   | your Tomcat instance is installed, you can provide a variable here such that the variable is</span></span><br><span class="line"><span class="comment">   | dereferenced during the build process to configure the cactus plugin.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | As noted above, profiles can be activated in a variety of ways. One way - the activeProfiles</span></span><br><span class="line"><span class="comment">   | section of this document (settings.xml) - will be discussed later. Another way essentially</span></span><br><span class="line"><span class="comment">   | relies on the detection of a system property, either matching a particular value for the property,</span></span><br><span class="line"><span class="comment">   | or merely testing its existence. Profiles can also be activated by JDK version prefix, where a</span></span><br><span class="line"><span class="comment">   | value of &#x27;1.4&#x27; might activate a profile when the build is executed on a JDK version of &#x27;1.4.2_07&#x27;.</span></span><br><span class="line"><span class="comment">   | Finally, the list of active profiles can be specified directly from the command line.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | <span class="doctag">NOTE:</span> For profiles defined in the settings.xml, you are restricted to specifying only artifact</span></span><br><span class="line"><span class="comment">   |       repositories, plugin repositories, and free-form properties to be used as configuration</span></span><br><span class="line"><span class="comment">   |       variables for plugins in the POM.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   |--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- profile</span></span><br><span class="line"><span class="comment">     | Specifies a set of introductions to the build process, to be activated using one or more of the</span></span><br><span class="line"><span class="comment">     | mechanisms described above. For inheritance purposes, and to activate profiles via &lt;activatedProfiles/&gt;</span></span><br><span class="line"><span class="comment">     | or the command line, profiles have to have an ID that is unique.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     | An encouraged best practice for profile identification is to use a consistent naming convention</span></span><br><span class="line"><span class="comment">     | for profiles, such as &#x27;env-dev&#x27;, &#x27;env-test&#x27;, &#x27;env-production&#x27;, &#x27;user-jdcasey&#x27;, &#x27;user-brett&#x27;, etc.</span></span><br><span class="line"><span class="comment">     | This will make it more intuitive to understand what the set of introduced profiles is attempting</span></span><br><span class="line"><span class="comment">     | to accomplish, particularly when you only have a list of profile id&#x27;s for debug.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     | This profile example uses the JDK version to trigger activation, and provides a JDK-specific repo.</span></span><br><span class="line"><span class="comment">    &lt;profile&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;jdk-1.4&lt;/id&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      &lt;activation&gt;</span></span><br><span class="line"><span class="comment">        &lt;jdk&gt;1.4&lt;/jdk&gt;</span></span><br><span class="line"><span class="comment">      &lt;/activation&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      &lt;repositories&gt;</span></span><br><span class="line"><span class="comment">        &lt;repository&gt;</span></span><br><span class="line"><span class="comment">          &lt;id&gt;jdk14&lt;/id&gt;</span></span><br><span class="line"><span class="comment">          &lt;name&gt;Repository for JDK 1.4 builds&lt;/name&gt;</span></span><br><span class="line"><span class="comment">          &lt;url&gt;http://www.myhost.com/maven/jdk14&lt;/url&gt;</span></span><br><span class="line"><span class="comment">          &lt;layout&gt;default&lt;/layout&gt;</span></span><br><span class="line"><span class="comment">          &lt;snapshotPolicy&gt;always&lt;/snapshotPolicy&gt;</span></span><br><span class="line"><span class="comment">        &lt;/repository&gt;</span></span><br><span class="line"><span class="comment">      &lt;/repositories&gt;</span></span><br><span class="line"><span class="comment">    &lt;/profile&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">     | Here is another profile, activated by the system property &#x27;target-env&#x27; with a value of &#x27;dev&#x27;,</span></span><br><span class="line"><span class="comment">     | which provides a specific path to the Tomcat instance. To use this, your plugin configuration</span></span><br><span class="line"><span class="comment">     | might hypothetically look like:</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     | ...</span></span><br><span class="line"><span class="comment">     | &lt;plugin&gt;</span></span><br><span class="line"><span class="comment">     |   &lt;groupId&gt;org.myco.myplugins&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">     |   &lt;artifactId&gt;myplugin&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     |   &lt;configuration&gt;</span></span><br><span class="line"><span class="comment">     |     &lt;tomcatLocation&gt;$&#123;tomcatPath&#125;&lt;/tomcatLocation&gt;</span></span><br><span class="line"><span class="comment">     |   &lt;/configuration&gt;</span></span><br><span class="line"><span class="comment">     | &lt;/plugin&gt;</span></span><br><span class="line"><span class="comment">     | ...</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     | <span class="doctag">NOTE:</span> If you just wanted to inject this configuration whenever someone set &#x27;target-env&#x27; to</span></span><br><span class="line"><span class="comment">     |       anything, you could just leave off the &lt;value/&gt; inside the activation-property.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">    &lt;profile&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;env-dev&lt;/id&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      &lt;activation&gt;</span></span><br><span class="line"><span class="comment">        &lt;property&gt;</span></span><br><span class="line"><span class="comment">          &lt;name&gt;target-env&lt;/name&gt;</span></span><br><span class="line"><span class="comment">          &lt;value&gt;dev&lt;/value&gt;</span></span><br><span class="line"><span class="comment">        &lt;/property&gt;</span></span><br><span class="line"><span class="comment">      &lt;/activation&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      &lt;properties&gt;</span></span><br><span class="line"><span class="comment">        &lt;tomcatPath&gt;/path/to/tomcat/instance&lt;/tomcatPath&gt;</span></span><br><span class="line"><span class="comment">      &lt;/properties&gt;</span></span><br><span class="line"><span class="comment">    &lt;/profile&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- activeProfiles</span></span><br><span class="line"><span class="comment">   | List of profiles that are active for all builds.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">  &lt;activeProfiles&gt;</span></span><br><span class="line"><span class="comment">    &lt;activeProfile&gt;alwaysActiveProfile&lt;/activeProfile&gt;</span></span><br><span class="line"><span class="comment">    &lt;activeProfile&gt;anotherAlwaysActiveProfile&lt;/activeProfile&gt;</span></span><br><span class="line"><span class="comment">  &lt;/activeProfiles&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Maven仓库修改阿里中央仓库&quot;&gt;&lt;a href=&quot;#Maven仓库修改阿里中央仓库&quot; class=&quot;headerlink&quot; title=&quot;Maven仓库修改阿里中央仓库&quot;&gt;&lt;/a&gt;Maven仓库修改阿里中央仓库&lt;/h2&gt;&lt;h3 id=&quot;修改-conf-下的-settings-xml&quot;&gt;&lt;a href=&quot;#修改-conf-下的-settings-xml&quot; class=&quot;headerlink&quot; title=&quot;修改 conf 下的 settings.xml&quot;&gt;&lt;/a&gt;修改 &lt;code&gt;conf&lt;/code&gt; 下的 &lt;code&gt;settings.xml&lt;/code&gt;&lt;/h3&gt;</summary>
    
    
    
    <category term="maven" scheme="https://aliatry.com/categories/maven/"/>
    
    
    <category term="maven" scheme="https://aliatry.com/tags/maven/"/>
    
    <category term="阿里" scheme="https://aliatry.com/tags/%E9%98%BF%E9%87%8C/"/>
    
  </entry>
  
  <entry>
    <title>快速部署Kibana 并配置外网可以访问</title>
    <link href="https://aliatry.com/2018/12/14/%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2Kibana-%E5%B9%B6%E9%85%8D%E7%BD%AE%E5%A4%96%E7%BD%91%E5%8F%AF%E4%BB%A5%E8%AE%BF%E9%97%AE/"/>
    <id>https://aliatry.com/2018/12/14/%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2Kibana-%E5%B9%B6%E9%85%8D%E7%BD%AE%E5%A4%96%E7%BD%91%E5%8F%AF%E4%BB%A5%E8%AE%BF%E9%97%AE/</id>
    <published>2018-12-14T12:26:58.000Z</published>
    <updated>2019-05-05T03:33:51.203Z</updated>
    
    <content type="html"><![CDATA[<h1 id="阿里云服务器部署kibana"><a href="#阿里云服务器部署kibana" class="headerlink" title="阿里云服务器部署kibana"></a>阿里云服务器部署kibana</h1><h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;artifacts.elastic.co&#x2F;downloads&#x2F;kibana&#x2F;kibana-6.5.3-linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure><h2 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf kibana-6.5.3-linux-x86_64.tar.gz</span><br></pre></td></tr></table></figure><h2 id="阿里云外网访问"><a href="#阿里云外网访问" class="headerlink" title="阿里云外网访问"></a>阿里云外网访问</h2><p>开放端口,修改配置文件 confing目录下的kibana.yml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server.host: &quot;0.0.0.0&quot;</span><br></pre></td></tr></table></figure><h2 id="守护进程后台启动"><a href="#守护进程后台启动" class="headerlink" title="守护进程后台启动"></a>守护进程后台启动</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup  XXX  &amp;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;阿里云服务器部署kibana&quot;&gt;&lt;a href=&quot;#阿里云服务器部署kibana&quot; class=&quot;headerlink&quot; title=&quot;阿里云服务器部署kibana&quot;&gt;&lt;/a&gt;阿里云服务器部署kibana&lt;/h1&gt;&lt;h2 id=&quot;下载&quot;&gt;&lt;a href=&quot;#下载&quot;</summary>
      
    
    
    
    <category term="Kibana" scheme="https://aliatry.com/categories/Kibana/"/>
    
    
    <category term="wget" scheme="https://aliatry.com/tags/wget/"/>
    
    <category term="Kibana" scheme="https://aliatry.com/tags/Kibana/"/>
    
  </entry>
  
  <entry>
    <title>阿里云服务器 快速安装ElasticSearch</title>
    <link href="https://aliatry.com/2018/12/14/%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8-%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85ElasticSearch/"/>
    <id>https://aliatry.com/2018/12/14/%E9%98%BF%E9%87%8C%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8-%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85ElasticSearch/</id>
    <published>2018-12-14T02:56:48.000Z</published>
    <updated>2019-10-12T06:14:45.993Z</updated>
    
    <content type="html"><![CDATA[<h2 id="使用wget-下载elasticsearch安装包"><a href="#使用wget-下载elasticsearch安装包" class="headerlink" title="使用wget 下载elasticsearch安装包"></a>使用wget 下载elasticsearch安装包</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;artifacts.elastic.co&#x2F;downloads&#x2F;elasticsearch&#x2F;elasticsearch-5.6.13.tar.gz</span><br></pre></td></tr></table></figure><h2 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf elasticsearch-5.6.13.tar.gz</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="外网访问配置"><a href="#外网访问配置" class="headerlink" title="外网访问配置"></a>外网访问配置</h2><p><code>config</code>目录下面<code>elasticsearch.yml</code><br>修改为 <code>network.host: 0.0.0.0</code></p><h2 id="常见配置问题资料"><a href="#常见配置问题资料" class="headerlink" title="常见配置问题资料"></a><a href="https://www.jianshu.com/p/c5d6ec0f35e0">常见配置问题资料</a></h2><h2 id="此版本配合-spring-boot-对应版本-2-0-7-RELEASE-使用"><a href="#此版本配合-spring-boot-对应版本-2-0-7-RELEASE-使用" class="headerlink" title="此版本配合 spring-boot 对应版本 2.0.7.RELEASE 使用"></a>此版本配合 spring-boot 对应版本 2.0.7.RELEASE 使用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.0.7.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;relativePath&#x2F;&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">&lt;&#x2F;parent&gt;</span><br></pre></td></tr></table></figure><h3 id="spring-boot-使用依赖"><a href="#spring-boot-使用依赖" class="headerlink" title="spring-boot 使用依赖"></a>spring-boot 使用依赖</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-elasticsearch&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure><h2 id="IK中文分词GitHub下载网站"><a href="#IK中文分词GitHub下载网站" class="headerlink" title="IK中文分词GitHub下载网站"></a>IK中文分词<a href="https://github.com/medcl/elasticsearch-analysis-ik/releases">GitHub下载网站</a></h2><h3 id="版本查看"><a href="#版本查看" class="headerlink" title="版本查看"></a><a href="https://github.com/medcl/elasticsearch-analysis-ik/blob/master/README.md">版本查看</a></h3><h3 id="使用wget-下载IK中文分词器"><a href="#使用wget-下载IK中文分词器" class="headerlink" title="使用wget 下载IK中文分词器"></a>使用wget 下载IK中文分词器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;github.com&#x2F;medcl&#x2F;elasticsearch-analysis-ik&#x2F;releases&#x2F;download&#x2F;v5.6.13&#x2F;elasticsearch-analysis-ik-5.6.13.zip</span><br></pre></td></tr></table></figure><p>插件下载到ES根目录下的<code>plugins</code>文件夹中 : <code>./elasticsearch-5.6.13/plugins/</code></p><h3 id="解压-1"><a href="#解压-1" class="headerlink" title="解压"></a>解压</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip elasticsearch-analysis-ik-5.6.13.zip</span><br></pre></td></tr></table></figure><h3 id="删除压缩包"><a href="#删除压缩包" class="headerlink" title="删除压缩包"></a>删除压缩包</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm elasticsearch-analysis-ik-5.6.13.zip</span><br></pre></td></tr></table></figure><h2 id="当我们在使用elasticsearch的时候，如果是以root权限来执行elasticsearch"><a href="#当我们在使用elasticsearch的时候，如果是以root权限来执行elasticsearch" class="headerlink" title="当我们在使用elasticsearch的时候，如果是以root权限来执行elasticsearch"></a>当我们在使用elasticsearch的时候，如果是以root权限来执行elasticsearch</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;elasticsearch</span><br></pre></td></tr></table></figure><!-- more --><h2 id="则会有以下报错"><a href="#则会有以下报错" class="headerlink" title="则会有以下报错"></a>则会有以下报错</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[2018-12-04T10:24:21,751][WARN ][o.e.b.ElasticsearchUncaughtExceptionHandler] [] uncaught exception in thread [main]</span><br><span class="line">org.elasticsearch.bootstrap.StartupException: java.lang.RuntimeException: can not run elasticsearch as root</span><br><span class="line">        at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:125) ~[elasticsearch-6.2.2.jar:6.2.2]</span><br><span class="line">        at org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:112) ~[elasticsearch-6.2.2.jar:6.2.2]</span><br><span class="line">        at org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86) ~[elasticsearch-6.2.2.jar:6.2.2]</span><br><span class="line">        at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124) ~[elasticsearch-cli-6.2.2.jar:6.2.2]</span><br><span class="line">        at org.elasticsearch.cli.Command.main(Command.java:90) ~[elasticsearch-cli-6.2.2.jar:6.2.2]</span><br><span class="line">        at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:92) ~[elasticsearch-6.2.2.jar:6.2.2]</span><br><span class="line">        at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:85) ~[elasticsearch-6.2.2.jar:6.2.2]</span><br><span class="line">Caused by: java.lang.RuntimeException: can not run elasticsearch as root</span><br><span class="line">        at org.elasticsearch.bootstrap.Bootstrap.initializeNatives(Bootstrap.java:105) ~[elasticsearch-6.2.2.jar:6.2.2]</span><br><span class="line">        at org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:172) ~[elasticsearch-6.2.2.jar:6.2.2]</span><br><span class="line">        at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:323) ~[elasticsearch-6.2.2.jar:6.2.2]</span><br><span class="line">        at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:121) ~[elasticsearch-6.2.2.jar:6.2.2]</span><br></pre></td></tr></table></figure><p>这是出于系统安全考虑设置的条件。由于ElasticSearch可以接收用户输入的脚本并且执行，为了系统安全考虑，<br>建议创建一个单独的用户用来运行ElasticSearch</p><h2 id="创建elsearch用户组及elsearch用户"><a href="#创建elsearch用户组及elsearch用户" class="headerlink" title="创建elsearch用户组及elsearch用户"></a>创建elsearch用户组及elsearch用户</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">groupadd elsearch</span><br><span class="line">useradd elsearch -g elsearch -p elasticsearch</span><br></pre></td></tr></table></figure><h2 id="更改elasticsearch文件夹及内部文件的所属用户及组为elsearch-elsearch"><a href="#更改elasticsearch文件夹及内部文件的所属用户及组为elsearch-elsearch" class="headerlink" title="更改elasticsearch文件夹及内部文件的所属用户及组为elsearch:elsearch"></a>更改elasticsearch文件夹及内部文件的所属用户及组为elsearch:elsearch</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown -R elsearch:elsearch &#123;elasticsearch&#125;</span><br></pre></td></tr></table></figure><p>{elasticsearch}为你elasticsearch的目录路径</p><h2 id="切换到elsearch用户再启动"><a href="#切换到elsearch用户再启动" class="headerlink" title="切换到elsearch用户再启动"></a>切换到elsearch用户再启动</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">su elsearch #切换账户</span><br><span class="line">cd elasticsearch&#x2F;bin #进入你的elasticsearch目录下的bin目录</span><br><span class="line">.&#x2F;elasticsearch</span><br></pre></td></tr></table></figure><h2 id="启动后会打印正常启动日志信息如下"><a href="#启动后会打印正常启动日志信息如下" class="headerlink" title="启动后会打印正常启动日志信息如下"></a>启动后会打印正常启动日志信息如下</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[2018-12-04T10:48:10,218][INFO ][o.e.n.Node               ] [] initializing ...</span><br><span class="line">[2018-12-04T10:48:10,387][INFO ][o.e.e.NodeEnvironment    ] [5tOgySS] using [1] data paths, mounts [[&#x2F; (&#x2F;dev&#x2F;vda1)]], net usable_space [34.2gb], net total_space [39.2gb], types [ext4]</span><br><span class="line">[2018-12-04T10:48:10,387][INFO ][o.e.e.NodeEnvironment    ] [5tOgySS] heap size [990.7mb], compressed ordinary object pointers [true]</span><br><span class="line">[2018-12-04T10:48:10,388][INFO ][o.e.n.Node               ] node name [5tOgySS] derived from node ID [5tOgySSsTVyh-aqzPrZrZQ]; set [node.name] to override</span><br><span class="line">[2018-12-04T10:48:10,389][INFO ][o.e.n.Node               ] version[6.2.2], pid[2211], build[10b1edd&#x2F;2018-02-16T19:01:30.685723Z], OS[Linux&#x2F;4.4.0-117-generic&#x2F;amd64], JVM[Oracle Corporation&#x2F;OpenJDK 64-Bit Server VM&#x2F;1.8.0_191&#x2F;25.191-b12]</span><br><span class="line">[2018-12-04T10:48:10,389][INFO ][o.e.n.Node               ] JVM arguments [-Xms1g, -Xmx1g, -XX:+UseConcMarkSweepGC, -XX:CMSInitiatingOccupancyFraction&#x3D;75, -XX:+UseCMSInitiatingOccupancyOnly, -XX:+AlwaysPreTouch, -Xss1m, -Djava.awt.headless&#x3D;true, -Dfile.encoding&#x3D;UTF-8, -Djna.nosys&#x3D;true, -XX:-OmitStackTraceInFastThrow, -Dio.netty.noUnsafe&#x3D;true, -Dio.netty.noKeySetOptimization&#x3D;true, -Dio.netty.recycler.maxCapacityPerThread&#x3D;0, -Dlog4j.shutdownHookEnabled&#x3D;false, -Dlog4j2.disable.jmx&#x3D;true, -Djava.io.tmpdir&#x3D;&#x2F;tmp&#x2F;elasticsearch.UJf6TjBC, -XX:+HeapDumpOnOutOfMemoryError, -XX:+PrintGCDetails, -XX:+PrintGCDateStamps, -XX:+PrintTenuringDistribution, -XX:+PrintGCApplicationStoppedTime, -Xloggc:logs&#x2F;gc.log, -XX:+UseGCLogFileRotation, -XX:NumberOfGCLogFiles&#x3D;32, -XX:GCLogFileSize&#x3D;64m, -Des.path.home&#x3D;&#x2F;usr&#x2F;local&#x2F;lib&#x2F;elasticsearch-6.2.2, -Des.path.conf&#x3D;&#x2F;usr&#x2F;local&#x2F;lib&#x2F;elasticsearch-6.2.2&#x2F;config]</span><br><span class="line">[2018-12-04T10:48:11,432][INFO ][o.e.p.PluginsService     ] [5tOgySS] loaded module [aggs-matrix-stats]</span><br><span class="line">[2018-12-04T10:48:11,432][INFO ][o.e.p.PluginsService     ] [5tOgySS] loaded module [analysis-common]</span><br><span class="line">[2018-12-04T10:48:11,433][INFO ][o.e.p.PluginsService     ] [5tOgySS] loaded module [ingest-common]</span><br><span class="line">[2018-12-04T10:48:11,433][INFO ][o.e.p.PluginsService     ] [5tOgySS] loaded module [lang-expression]</span><br><span class="line">[2018-12-04T10:48:11,433][INFO ][o.e.p.PluginsService     ] [5tOgySS] loaded module [lang-mustache]</span><br><span class="line">[2018-12-04T10:48:11,433][INFO ][o.e.p.PluginsService     ] [5tOgySS] loaded module [lang-painless]</span><br><span class="line">[2018-12-04T10:48:11,433][INFO ][o.e.p.PluginsService     ] [5tOgySS] loaded module [mapper-extras]</span><br><span class="line">[2018-12-04T10:48:11,433][INFO ][o.e.p.PluginsService     ] [5tOgySS] loaded module [parent-join]</span><br><span class="line">[2018-12-04T10:48:11,434][INFO ][o.e.p.PluginsService     ] [5tOgySS] loaded module [percolator]</span><br><span class="line">[2018-12-04T10:48:11,434][INFO ][o.e.p.PluginsService     ] [5tOgySS] loaded module [rank-eval]</span><br><span class="line">[2018-12-04T10:48:11,434][INFO ][o.e.p.PluginsService     ] [5tOgySS] loaded module [reindex]</span><br><span class="line">[2018-12-04T10:48:11,434][INFO ][o.e.p.PluginsService     ] [5tOgySS] loaded module [repository-url]</span><br><span class="line">[2018-12-04T10:48:11,434][INFO ][o.e.p.PluginsService     ] [5tOgySS] loaded module [transport-netty4]</span><br><span class="line">[2018-12-04T10:48:11,434][INFO ][o.e.p.PluginsService     ] [5tOgySS] loaded module [tribe]</span><br><span class="line">[2018-12-04T10:48:11,435][INFO ][o.e.p.PluginsService     ] [5tOgySS] no plugins loaded</span><br><span class="line">[2018-12-04T10:48:14,742][INFO ][o.e.d.DiscoveryModule    ] [5tOgySS] using discovery type [zen]</span><br><span class="line">[2018-12-04T10:48:15,172][INFO ][o.e.n.Node               ] initialized</span><br><span class="line">[2018-12-04T10:48:15,172][INFO ][o.e.n.Node               ] [5tOgySS] starting ...</span><br><span class="line">[2018-12-04T10:48:15,356][INFO ][o.e.t.TransportService   ] [5tOgySS] publish_address &#123;127.0.0.1:9300&#125;, bound_addresses &#123;127.0.0.1:9300&#125;</span><br><span class="line">[2018-12-04T10:48:15,365][WARN ][o.e.b.BootstrapChecks    ] [5tOgySS] max file descriptors [65535] for elasticsearch process is too low, increase to at least [65536]</span><br><span class="line">[2018-12-04T10:48:15,365][WARN ][o.e.b.BootstrapChecks    ] [5tOgySS] max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]</span><br><span class="line">[2018-12-04T10:48:18,413][INFO ][o.e.c.s.MasterService    ] [5tOgySS] zen-disco-elected-as-master ([0] nodes joined), reason: new_master &#123;5tOgySS&#125;&#123;5tOgySSsTVyh-aqzPrZrZQ&#125;&#123;2do4g-5VQhqH_uTYtm9Paw&#125;&#123;127.0.0.1&#125;&#123;127.0.0.1:9300&#125;</span><br><span class="line">[2018-12-04T10:48:18,417][INFO ][o.e.c.s.ClusterApplierService] [5tOgySS] new_master &#123;5tOgySS&#125;&#123;5tOgySSsTVyh-aqzPrZrZQ&#125;&#123;2do4g-5VQhqH_uTYtm9Paw&#125;&#123;127.0.0.1&#125;&#123;127.0.0.1:9300&#125;, reason: apply cluster state (from master [master &#123;5tOgySS&#125;&#123;5tOgySSsTVyh-aqzPrZrZQ&#125;&#123;2do4g-5VQhqH_uTYtm9Paw&#125;&#123;127.0.0.1&#125;&#123;127.0.0.1:9300&#125; committed version [1] source [zen-disco-elected-as-master ([0] nodes joined)]])</span><br><span class="line">[2018-12-04T10:48:18,526][INFO ][o.e.h.n.Netty4HttpServerTransport] [5tOgySS] publish_address &#123;127.0.0.1:9200&#125;, bound_addresses &#123;127.0.0.1:9200&#125;</span><br><span class="line">[2018-12-04T10:48:18,526][INFO ][o.e.n.Node               ] [5tOgySS] started</span><br><span class="line">[2018-12-04T10:48:18,534][INFO ][o.e.g.GatewayService     ] [5tOgySS] recovered [0] indices into cluster_state</span><br></pre></td></tr></table></figure><h2 id="ElasticSearch后台启动命令"><a href="#ElasticSearch后台启动命令" class="headerlink" title="ElasticSearch后台启动命令"></a>ElasticSearch后台启动命令</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;elasticsearch -d</span><br></pre></td></tr></table></figure><h2 id="常见异常"><a href="#常见异常" class="headerlink" title="常见异常"></a>常见异常</h2><h3 id="max-file-descriptors-65535-for-elasticsearchprocess-is-too-low-increase-to-at-least-65536"><a href="#max-file-descriptors-65535-for-elasticsearchprocess-is-too-low-increase-to-at-least-65536" class="headerlink" title="max file descriptors [65535] for elasticsearchprocess is too low, increase to at least [65536]"></a>max file descriptors [65535] for elasticsearchprocess is too low, increase to at least [65536]</h3><p>修改 <code>/etc/security/limits.conf</code> 添加如下内容(建议新增到最下面)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">* - nofile 65536</span><br><span class="line">* - memlock unlimited</span><br></pre></td></tr></table></figure><h3 id="max-virtual-memory-areas-vm-max-map-count-65530-is-too-low-increase-to-at-least-262144"><a href="#max-virtual-memory-areas-vm-max-map-count-65530-is-too-low-increase-to-at-least-262144" class="headerlink" title="max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]"></a>max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]</h3><p>修改 <code>/etc/sysctl.conf</code> 添加如下内容(建议新增到最下面)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vm.max_map_count &#x3D; 262144</span><br></pre></td></tr></table></figure><p>修改完内核参数立即生效</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sysctl -p</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;使用wget-下载elasticsearch安装包&quot;&gt;&lt;a href=&quot;#使用wget-下载elasticsearch安装包&quot; class=&quot;headerlink&quot; title=&quot;使用wget 下载elasticsearch安装包&quot;&gt;&lt;/a&gt;使用wget 下载elasticsearch安装包&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;wget https:&amp;#x2F;&amp;#x2F;artifacts.elastic.co&amp;#x2F;downloads&amp;#x2F;elasticsearch&amp;#x2F;elasticsearch-5.6.13.tar.gz&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;解压&quot;&gt;&lt;a href=&quot;#解压&quot; class=&quot;headerlink&quot; title=&quot;解压&quot;&gt;&lt;/a&gt;解压&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;tar -zxvf elasticsearch-5.6.13.tar.gz&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="linux" scheme="https://aliatry.com/categories/linux/"/>
    
    <category term="elasticsearch" scheme="https://aliatry.com/categories/linux/elasticsearch/"/>
    
    
    <category term="linux" scheme="https://aliatry.com/tags/linux/"/>
    
    <category term="wget" scheme="https://aliatry.com/tags/wget/"/>
    
    <category term="elasticsearch" scheme="https://aliatry.com/tags/elasticsearch/"/>
    
  </entry>
  
</feed>
